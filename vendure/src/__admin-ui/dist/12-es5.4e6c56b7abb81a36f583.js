!function(){function e(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||n(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){var c;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(c=n(e))||t&&e&&"number"==typeof e.length){c&&(e=c);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){c=e[Symbol.iterator]()},n:function(){var e=c.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==c.return||c.return()}finally{if(l)throw o}}}}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var c=[],n=!0,r=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done)&&(c.push(o.value),!t||c.length!==t);n=!0);}catch(l){r=!0,i=l}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return c}(e,t)||n(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){if(e){if("string"==typeof e)return r(e,t);var c=Object.prototype.toString.call(e).slice(8,-1);return"Object"===c&&e.constructor&&(c=e.constructor.name),"Map"===c||"Set"===c?Array.from(e):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?r(e,t):void 0}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var c=0,n=new Array(t);c<t;c++)n[c]=e[c];return n}function i(e,t,c){return t in e?Object.defineProperty(e,t,{value:c,enumerable:!0,configurable:!0,writable:!0}):e[t]=c,e}function o(e,t,c){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,c){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(c):r.value}})(e,t,c||e)}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var c,n=f(e);if(t){var r=f(this).constructor;c=Reflect.construct(n,arguments,r)}else c=n.apply(this,arguments);return s(this,c)}}function s(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var c=0;c<t.length;c++){var n=t[c];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,c){return t&&m(e.prototype,t),c&&m(e,c),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"2VDt":function(n,r,l){"use strict";l.r(r),l.d(r,"AddManualPaymentDialogComponent",(function(){return Cn})),l.d(r,"CancelOrderDialogComponent",(function(){return Rn})),l.d(r,"FulfillOrderDialogComponent",(function(){return On})),l.d(r,"FulfillmentCardComponent",(function(){return In})),l.d(r,"FulfillmentDetailComponent",(function(){return Sn})),l.d(r,"FulfillmentStateLabelComponent",(function(){return Pn})),l.d(r,"LineFulfillmentComponent",(function(){return kn})),l.d(r,"LineRefundsComponent",(function(){return Mn})),l.d(r,"ModificationDetailComponent",(function(){return Wn})),l.d(r,"NODE_HEIGHT",(function(){return $n})),l.d(r,"OrderCustomFieldsCardComponent",(function(){return Fn})),l.d(r,"OrderDetailComponent",(function(){return jn})),l.d(r,"OrderEditResultType",(function(){return Dn})),l.d(r,"OrderEditorComponent",(function(){return An})),l.d(r,"OrderEditsPreviewDialogComponent",(function(){return Un})),l.d(r,"OrderHistoryComponent",(function(){return Nn})),l.d(r,"OrderListComponent",(function(){return En})),l.d(r,"OrderModule",(function(){return rr})),l.d(r,"OrderPaymentCardComponent",(function(){return Yn})),l.d(r,"OrderProcessEdgeComponent",(function(){return qn})),l.d(r,"OrderProcessGraphComponent",(function(){return Vn})),l.d(r,"OrderProcessGraphDialogComponent",(function(){return _n})),l.d(r,"OrderProcessNodeComponent",(function(){return Xn})),l.d(r,"OrderResolver",(function(){return Zn})),l.d(r,"OrderStateSelectDialogComponent",(function(){return xn})),l.d(r,"OrderTableComponent",(function(){return Qn})),l.d(r,"OrderTransitionService",(function(){return wn})),l.d(r,"PaymentDetailComponent",(function(){return Hn})),l.d(r,"PaymentStateLabelComponent",(function(){return Bn})),l.d(r,"RefundOrderDialogComponent",(function(){return Tn})),l.d(r,"RefundStateLabelComponent",(function(){return Gn})),l.d(r,"SettleRefundDialogComponent",(function(){return Ln})),l.d(r,"SimpleItemListComponent",(function(){return zn})),l.d(r,"modifyingOrderBreadcrumb",(function(){return nr})),l.d(r,"orderBreadcrumb",(function(){return cr})),l.d(r,"orderRoutes",(function(){return tr})),l.d(r,"\u02750",(function(){return Jn})),l.d(r,"\u02751",(function(){return Kn})),l.d(r,"\u02752",(function(){return er}));var s=l("EM62"),m=l("nIj0"),b=l("ixhn"),g=l("OxKu"),y=l("sEIs"),v=l("hG4v"),C=l("6Oco"),R=l("ZTXN"),O=l("ROBh"),I=l("g6G6"),S=l("C05f"),P=l("TLy2"),k=l("4e/d"),M=l("uCWR"),W=function(){function e(t,c){p(this,e),this.notifier=t,this.source=c}return h(e,[{key:"call",value:function(e,t){return t.subscribe(new F(e,this.notifier,this.source))}}]),e}(),F=function(e){a(c,e);var t=d(c);function c(e,n,r){var i;return p(this,c),(i=t.call(this,e)).notifier=n,i.source=r,i}return h(c,[{key:"error",value:function(e){if(!this.isStopped){var t=this.errors,n=this.retries,r=this.retriesSubscription;if(n)this.errors=void 0,this.retriesSubscription=void 0;else{t=new R.a;try{n=(0,this.notifier)(t)}catch(i){return o(f(c.prototype),"error",this).call(this,i)}r=Object(M.c)(n,new M.a(this))}this._unsubscribeAndRecycle(),this.errors=t,this.retries=n,this.retriesSubscription=r,t.next(e)}}},{key:"_unsubscribe",value:function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0}},{key:"notifyNext",value:function(){var e=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=e,this.source.subscribe(this)}}]),c}(M.b),x=l("BwBJ"),w=l("J+dc"),_=l("YtkY"),T=l("jIqt"),L=l("7SLS"),D=l("kuMc"),j=l("wqq/"),U=l("Ohay"),A=l("mWib"),N=l("8j5Y"),E=l("jY47"),Y=l("s2Ay"),$=l("2kYt"),X=l("Kej3"),q=l("E5oP");function V(e,t){1&e&&(s.Wc(0),s.sc(1,"translate")),2&e&&s.Xc(s.tc(1,1,"order.add-payment-to-order"))}function Q(e,t){if(1&e){var c=s.jc();s.ic(0,"button",7),s.pc("click",(function(){return s.Lc(c),s.rc().cancel()})),s.Wc(1),s.sc(2,"translate"),s.hc(),s.ic(3,"button",8),s.pc("click",(function(){return s.Lc(c),s.rc().submit()})),s.Wc(4),s.sc(5,"translate"),s.sc(6,"localeCurrency"),s.hc()}if(2&e){var n=s.rc();s.Rb(1),s.Xc(s.tc(2,4,"common.cancel")),s.Rb(2),s.yc("disabled",n.form.invalid||n.form.pristine),s.Rb(1),s.Zc(" ",s.tc(5,6,"order.add-payment")," (",s.uc(6,8,n.outstandingAmount,n.currencyCode),") ")}}function H(e,t){1&e&&(s.Wc(0),s.sc(1,"translate")),2&e&&s.Xc(s.tc(1,1,"order.cancel-order"))}function B(e,t){if(1&e){var c=s.jc();s.ic(0,"input",18),s.pc("ngModelChange",(function(e){s.Lc(c);var t=s.rc().$implicit;return s.rc().lineQuantities[t.id]=e})),s.hc()}if(2&e){var n=s.rc().$implicit,r=s.rc();s.yc("ngModel",r.lineQuantities[n.id])("max",n.quantity)}}function G(e,t){if(1&e&&s.Wc(0),2&e){var c=s.rc().$implicit;s.Xc(c.quantity)}}function z(e,t){if(1&e&&(s.ic(0,"tr",9),s.ic(1,"td",10),s.dc(2,"img",11),s.sc(3,"assetPreview"),s.hc(),s.ic(4,"td",12),s.Wc(5),s.hc(),s.ic(6,"td",13),s.Wc(7),s.hc(),s.ic(8,"td",14),s.Wc(9),s.hc(),s.ic(10,"td",14),s.Wc(11),s.sc(12,"localeCurrency"),s.hc(),s.ic(13,"td",15),s.Uc(14,B,1,2,"input",16),s.Uc(15,G,1,1,"ng-template",null,17,s.Vc),s.hc(),s.hc()),2&e){var c=t.$implicit,n=s.Ic(16),r=s.rc();s.Ub("is-cancelled",0===c.quantity),s.Rb(2),s.yc("src",s.uc(3,9,c.featuredAsset,"tiny"),s.Nc),s.Rb(3),s.Xc(c.productVariant.name),s.Rb(2),s.Xc(c.productVariant.sku),s.Rb(2),s.Xc(c.quantity),s.Rb(2),s.Yc(" ",s.uc(12,12,c.unitPriceWithTax,r.order.currencyCode)," "),s.Rb(3),s.yc("ngIf",c.quantity>0&&!r.order.active)("ngIfElse",n)}}function Z(e,t){1&e&&(s.gc(0),s.Wc(1),s.sc(2,"translate"),s.fc()),2&e&&(s.Rb(1),s.Yc(" ",s.tc(2,1,"order.cancel-selected-items")," "))}function J(e,t){1&e&&(s.gc(0),s.Wc(1),s.sc(2,"translate"),s.fc()),2&e&&(s.Rb(1),s.Yc(" ",s.tc(2,1,"order.cancel-order")," "))}function K(e,t){if(1&e){var c=s.jc();s.ic(0,"button",19),s.pc("click",(function(){return s.Lc(c),s.rc().cancel()})),s.Wc(1),s.sc(2,"translate"),s.hc(),s.ic(3,"button",20),s.pc("click",(function(){return s.Lc(c),s.rc().select()})),s.Uc(4,Z,3,3,"ng-container",21),s.Uc(5,J,3,3,"ng-container",21),s.hc()}if(2&e){var n=s.rc();s.Rb(1),s.Xc(s.tc(2,4,"common.cancel")),s.Rb(2),s.yc("disabled",!n.reason||!n.order.active&&0===n.selectionCount),s.Rb(1),s.yc("ngIf",!n.order.active),s.Rb(1),s.yc("ngIf",n.order.active)}}function ee(e,t){1&e&&(s.Wc(0),s.sc(1,"translate")),2&e&&s.Xc(s.tc(1,1,"order.fulfill-order"))}function te(e,t){if(1&e&&(s.dc(0,"img",17),s.sc(1,"assetPreview")),2&e){var c=s.rc().$implicit;s.yc("src",s.uc(1,1,c.featuredAsset,"tiny"),s.Nc)}}function ce(e,t){if(1&e){var c=s.jc();s.ic(0,"input",18),s.pc("ngModelChange",(function(e){s.Lc(c);var t=s.rc().$implicit;return s.rc().fulfillmentQuantities[t.id].fulfillCount=e})),s.hc()}if(2&e){var n=s.rc().$implicit,r=s.rc();s.yc("disabled",0===r.getUnfulfilledCount(n))("ngModel",r.fulfillmentQuantities[n.id].fulfillCount)("max",r.fulfillmentQuantities[n.id].max)}}function ne(e,t){if(1&e&&(s.ic(0,"tr",9),s.ic(1,"td",10),s.Uc(2,te,2,4,"img",11),s.hc(),s.ic(3,"td",12),s.Wc(4),s.hc(),s.ic(5,"td",13),s.Wc(6),s.hc(),s.ic(7,"td",14),s.Wc(8),s.hc(),s.ic(9,"td",14),s.Wc(10),s.hc(),s.ic(11,"td",15),s.Uc(12,ce,1,3,"input",16),s.hc(),s.hc()),2&e){var c=t.$implicit,n=s.rc();s.Ub("ignore",0===n.getUnfulfilledCount(c)),s.Rb(2),s.yc("ngIf",c.featuredAsset),s.Rb(2),s.Xc(c.productVariant.name),s.Rb(2),s.Xc(c.productVariant.sku),s.Rb(2),s.Xc(n.getUnfulfilledCount(c)),s.Rb(2),s.Xc(c.productVariant.stockOnHand),s.Rb(2),s.yc("ngIf",n.fulfillmentQuantities[c.id])}}function re(e,t){if(1&e){var c=s.jc();s.ic(0,"button",19),s.pc("click",(function(){return s.Lc(c),s.rc().cancel()})),s.Wc(1),s.sc(2,"translate"),s.hc(),s.ic(3,"button",20),s.pc("click",(function(){return s.Lc(c),s.rc().select()})),s.Wc(4),s.sc(5,"translate"),s.hc()}if(2&e){var n=s.rc();s.Rb(1),s.Xc(s.tc(2,3,"common.cancel")),s.Rb(2),s.yc("disabled",!n.canSubmit()),s.Rb(1),s.Yc(" ",s.tc(5,5,"order.create-fulfillment")," ")}}function ie(e,t){if(1&e&&s.dc(0,"vdr-fulfillment-detail",12),2&e){var c=s.rc();s.yc("fulfillmentId",null==c.fulfillment?null:c.fulfillment.id)("order",c.order)}}var oe=function(e){return{state:e}};function ae(e,t){if(1&e){var c=s.jc();s.gc(0),s.ic(1,"button",13),s.pc("click",(function(){s.Lc(c);var e=t.ngIf;return s.rc().transitionState.emit(e)})),s.Wc(2),s.sc(3,"translate"),s.sc(4,"translate"),s.sc(5,"stateI18nToken"),s.hc(),s.fc()}if(2&e){var n=t.ngIf;s.Rb(2),s.Yc(" ",s.uc(3,1,"order.set-fulfillment-state",s.Cc(8,oe,s.tc(4,4,s.tc(5,6,n))))," ")}}function le(e,t){if(1&e&&(s.gc(0),s.dc(1,"clr-icon",17),s.Wc(2),s.sc(3,"translate"),s.sc(4,"translate"),s.sc(5,"stateI18nToken"),s.fc()),2&e){var c=s.rc().$implicit;s.Rb(2),s.Yc(" ",s.uc(3,1,"order.transition-to-state",s.Cc(8,oe,s.tc(4,4,s.tc(5,6,c))))," ")}}function de(e,t){1&e&&(s.dc(0,"clr-icon",18),s.Wc(1),s.sc(2,"translate")),2&e&&(s.Rb(1),s.Yc(" ",s.tc(2,1,"order.cancel-fulfillment")," "))}function se(e,t){if(1&e){var c=s.jc();s.gc(0),s.ic(1,"button",14),s.pc("click",(function(){s.Lc(c);var e=t.$implicit;return s.rc().transitionState.emit(e)})),s.Uc(2,le,6,10,"ng-container",15),s.Uc(3,de,3,3,"ng-template",null,16,s.Vc),s.hc(),s.fc()}if(2&e){var n=t.$implicit,r=s.Ic(4);s.Rb(2),s.yc("ngIf","Cancelled"!==n)("ngIfElse",r)}}function ue(e,t){if(1&e&&(s.ic(0,"vdr-labeled-data",0),s.sc(1,"translate"),s.Wc(2),s.hc()),2&e){var c=s.rc();s.yc("label",s.tc(1,2,"order.tracking-code")),s.Rb(2),s.Yc(" ",null==c.fulfillment?null:c.fulfillment.trackingCode,"\n")}}function fe(e,t){if(1&e&&(s.gc(0),s.ic(1,"vdr-labeled-data",0),s.Wc(2),s.hc(),s.fc()),2&e){var c=t.$implicit;s.Rb(1),s.yc("label",c.key),s.Rb(1),s.Xc(c.value)}}function pe(e,t){1&e&&s.dc(0,"clr-icon",2)}function me(e,t){1&e&&s.dc(0,"clr-icon",9)}function he(e,t){1&e&&s.dc(0,"clr-icon",10)}function be(e,t){1&e&&s.dc(0,"clr-icon",11)}function ge(e,t){1&e&&(s.ic(0,"label",12),s.Wc(1),s.sc(2,"translate"),s.hc()),2&e&&(s.Rb(1),s.Yc(" ",s.tc(2,1,"order.line-fulfillment-all")," "))}var ye=function(e,t){return{total:e,count:t}};function ve(e,t){if(1&e&&(s.ic(0,"label",12),s.Wc(1),s.sc(2,"translate"),s.hc()),2&e){var c=s.rc(2);s.Rb(1),s.Yc(" ",s.uc(2,1,"order.line-fulfillment-partial",s.Dc(4,ye,c.line.quantity,c.fulfilledCount))," ")}}function Ce(e,t){1&e&&(s.ic(0,"label",12),s.Wc(1),s.sc(2,"translate"),s.hc()),2&e&&(s.Rb(1),s.Yc(" ",s.tc(2,1,"order.line-fulfillment-none")," "))}function Re(e,t){if(1&e&&(s.ic(0,"vdr-labeled-data",15),s.sc(1,"translate"),s.Wc(2),s.hc()),2&e){var c=s.rc().$implicit;s.yc("label",s.tc(1,2,"order.tracking-code")),s.Rb(2),s.Yc(" ",c.fulfillment.trackingCode," ")}}var Oe=function(e){return{count:e}};function Ie(e,t){if(1&e&&(s.ic(0,"div",13),s.ic(1,"div",14),s.Wc(2),s.sc(3,"translate"),s.sc(4,"translate"),s.hc(),s.ic(5,"vdr-labeled-data",15),s.sc(6,"translate"),s.Wc(7),s.sc(8,"localeDate"),s.hc(),s.ic(9,"vdr-labeled-data",15),s.sc(10,"translate"),s.Wc(11),s.hc(),s.Uc(12,Re,3,4,"vdr-labeled-data",16),s.hc()),2&e){var c=t.$implicit;s.Rb(2),s.ad(" ",s.tc(3,8,"order.fulfillment")," #",c.fulfillment.id," (",s.uc(4,10,"order.item-count",s.Cc(20,Oe,c.count)),") "),s.Rb(3),s.yc("label",s.tc(6,13,"common.created-at")),s.Rb(2),s.Yc(" ",s.uc(8,15,c.fulfillment.createdAt,"medium")," "),s.Rb(2),s.yc("label",s.tc(10,18,"order.fulfillment-method")),s.Rb(2),s.Yc(" ",c.fulfillment.method," "),s.Rb(1),s.yc("ngIf",c.fulfillment.trackingCode)}}function Se(e,t){if(1&e&&(s.ic(0,"vdr-dropdown",1),s.ic(1,"button",2),s.Uc(2,me,1,0,"clr-icon",3),s.Uc(3,he,1,0,"clr-icon",4),s.Uc(4,be,1,0,"clr-icon",5),s.hc(),s.ic(5,"vdr-dropdown-menu",6),s.Uc(6,ge,3,3,"label",7),s.Uc(7,ve,3,7,"label",7),s.Uc(8,Ce,3,3,"label",7),s.Uc(9,Ie,13,22,"div",8),s.hc(),s.hc()),2&e){var c=s.rc();s.Rb(2),s.yc("ngIf","full"===c.fulfillmentStatus),s.Rb(1),s.yc("ngIf","partial"===c.fulfillmentStatus),s.Rb(1),s.yc("ngIf","none"===c.fulfillmentStatus),s.Rb(2),s.yc("ngIf","full"===c.fulfillmentStatus),s.Rb(1),s.yc("ngIf","partial"===c.fulfillmentStatus),s.Rb(1),s.yc("ngIf","none"===c.fulfillmentStatus),s.Rb(1),s.yc("ngForOf",c.fulfillments)}}function Pe(e,t){if(1&e&&(s.ic(0,"span",1),s.sc(1,"translate"),s.dc(2,"clr-icon",2),s.hc()),2&e){var c=s.rc();s.yc("title",s.uc(1,1,"order.refunded-count",s.Cc(4,Oe,c.getRefundedCount())))}}function ke(e,t){if(1&e&&(s.ic(0,"vdr-labeled-data",0),s.sc(1,"translate"),s.Wc(2),s.hc()),2&e){var c=s.rc();s.yc("label",s.tc(1,2,"order.note")),s.Rb(2),s.Xc(c.modification.note)}}function Me(e,t){if(1&e&&(s.ic(0,"vdr-labeled-data",0),s.sc(1,"translate"),s.Wc(2),s.sc(3,"localeCurrency"),s.hc()),2&e){var c=t.$implicit,n=s.rc(),r=null;s.yc("label",s.tc(1,3,"order.surcharges")),s.Rb(2),s.Zc(" ",null==(r=n.getSurcharge(c.id))?null:r.description," ",s.uc(3,5,null==(r=n.getSurcharge(c.id))?null:r.priceWithTax,n.order.currencyCode),"")}}function We(e,t){if(1&e&&(s.ic(0,"vdr-labeled-data",0),s.sc(1,"translate"),s.dc(2,"vdr-simple-item-list",3),s.hc()),2&e){var c=s.rc();s.yc("label",s.tc(1,2,"order.added-items")),s.Rb(2),s.yc("items",c.getAddedItems())}}function Fe(e,t){if(1&e&&(s.ic(0,"vdr-labeled-data",0),s.sc(1,"translate"),s.dc(2,"vdr-simple-item-list",3),s.hc()),2&e){var c=s.rc();s.yc("label",s.tc(1,2,"order.removed-items")),s.Rb(2),s.yc("items",c.getRemovedItems())}}function xe(e,t){if(1&e&&(s.gc(0),s.dc(1,"vdr-custom-field-control",9),s.fc()),2&e){var c=t.$implicit,n=s.rc(2);s.Rb(1),s.yc("customFieldsFormGroup",n.customFieldForm)("compact",!0)("readonly",c.readonly||!n.editable)("customField",c)}}function we(e,t){if(1&e){var c=s.jc();s.ic(0,"button",10),s.pc("click",(function(){return s.Lc(c),s.rc(2).editable=!0})),s.dc(1,"clr-icon",11),s.Wc(2),s.sc(3,"translate"),s.hc()}2&e&&(s.Rb(2),s.Yc(" ",s.tc(3,1,"common.edit")," "))}function _e(e,t){if(1&e){var c=s.jc();s.ic(0,"button",12),s.pc("click",(function(){return s.Lc(c),s.rc(2).onUpdateClick()})),s.dc(1,"clr-icon",13),s.Wc(2),s.sc(3,"translate"),s.hc()}if(2&e){var n=s.rc(2);s.yc("disabled",n.customFieldForm.pristine||n.customFieldForm.invalid),s.Rb(2),s.Yc(" ",s.tc(3,2,"common.update")," ")}}function Te(e,t){if(1&e&&(s.ic(0,"div",1),s.ic(1,"div",2),s.Wc(2),s.sc(3,"translate"),s.hc(),s.ic(4,"div",3),s.ic(5,"div",4),s.Uc(6,xe,2,4,"ng-container",5),s.hc(),s.hc(),s.ic(7,"div",6),s.Uc(8,we,4,3,"button",7),s.Uc(9,_e,4,4,"button",8),s.hc(),s.hc()),2&e){var c=s.rc();s.Rb(2),s.Yc(" ",s.tc(3,6,"common.custom-fields")," "),s.Rb(3),s.Ub("editable",c.editable),s.Rb(1),s.yc("ngForOf",c.customFieldsConfig),s.Rb(2),s.yc("ngIf",!c.editable),s.Rb(1),s.yc("ngIf",c.editable)}}function Le(e,t){1&e&&(s.Wc(0),s.sc(1,"translate")),2&e&&s.Xc(s.tc(1,1,"order.select-state"))}function De(e,t){if(1&e&&(s.ic(0,"option",4),s.Wc(1),s.sc(2,"translate"),s.sc(3,"stateI18nToken"),s.hc()),2&e){var c=t.$implicit;s.yc("value",c),s.Rb(1),s.Yc(" ",s.tc(2,2,s.tc(3,4,c))," ")}}function je(e,t){if(1&e){var c=s.jc();s.ic(0,"button",7),s.pc("click",(function(){return s.Lc(c),s.rc(2).cancel()})),s.Wc(1),s.sc(2,"translate"),s.hc()}2&e&&(s.Rb(1),s.Yc(" ",s.tc(2,1,"common.cancel")," "))}function Ue(e,t){if(1&e){var c=s.jc();s.Uc(0,je,3,3,"button",5),s.ic(1,"button",6),s.pc("click",(function(){return s.Lc(c),s.rc().select()})),s.Wc(2),s.sc(3,"translate"),s.hc()}if(2&e){var n=s.rc();s.yc("ngIf",n.cancellable),s.Rb(1),s.yc("disabled",!n.selectedState),s.Rb(1),s.Yc(" ",s.uc(3,3,"order.transition-to-state",s.Cc(6,oe,n.selectedState))," ")}}function Ae(e,t){1&e&&(s.Wc(0),s.sc(1,"translate")),2&e&&s.Xc(s.tc(1,1,"order.order-state-diagram"))}function Ne(e,t){1&e&&(s.Wc(0),s.sc(1,"translate")),2&e&&s.Xc(s.tc(1,1,"order.refund-and-cancel-order"))}function Ee(e,t){if(1&e&&(s.ic(0,"div",35),s.Wc(1),s.ic(2,"div",36),s.Wc(3),s.sc(4,"currency"),s.sc(5,"number"),s.hc(),s.hc()),2&e){var c=t.$implicit,n=s.rc(3).$implicit,r=s.rc();s.Rb(1),s.Yc(" ",c.description," "),s.Rb(2),s.Yc(" ",s.uc(4,2,s.uc(5,5,c.amount/100/n.quantity,"1.0-2"),r.order.currencyCode)," ")}}function Ye(e,t){if(1&e&&(s.ic(0,"vdr-dropdown"),s.ic(1,"div",31),s.ic(2,"button",32),s.dc(3,"clr-icon",33),s.hc(),s.hc(),s.ic(4,"vdr-dropdown-menu"),s.Uc(5,Ee,6,8,"div",34),s.hc(),s.hc()),2&e){var c=s.rc().ngIf;s.Rb(5),s.yc("ngForOf",c)}}function $e(e,t){if(1&e&&(s.gc(0),s.Uc(1,Ye,6,1,"vdr-dropdown",25),s.fc()),2&e){var c=t.ngIf;s.Rb(1),s.yc("ngIf",c.length)}}function Xe(e,t){if(1&e){var c=s.jc();s.ic(0,"input",37),s.pc("ngModelChange",(function(e){s.Lc(c);var t=s.rc().$implicit;return s.rc().lineQuantities[t.id].quantity=e}))("input",(function(){s.Lc(c);var e=s.rc().$implicit,t=s.rc();return t.handleZeroQuantity(t.lineQuantities[e.id])})),s.hc()}if(2&e){var n=s.rc().$implicit,r=s.rc();s.yc("ngModel",r.lineQuantities[n.id].quantity)("max",n.quantity)}}function qe(e,t){if(1&e){var c=s.jc();s.ic(0,"input",38),s.pc("ngModelChange",(function(e){s.Lc(c);var t=s.rc().$implicit;return s.rc().lineQuantities[t.id].refund=e})),s.hc()}if(2&e){var n=s.rc().$implicit,r=s.rc();s.yc("disabled",0===r.lineQuantities[n.id].quantity)("ngModel",r.lineQuantities[n.id].refund)}}function Ve(e,t){if(1&e){var c=s.jc();s.ic(0,"input",38),s.pc("ngModelChange",(function(e){s.Lc(c);var t=s.rc().$implicit;return s.rc().lineQuantities[t.id].cancel=e})),s.hc()}if(2&e){var n=s.rc().$implicit,r=s.rc();s.yc("disabled",0===r.lineQuantities[n.id].quantity)("ngModel",r.lineQuantities[n.id].cancel)}}function Qe(e,t){if(1&e&&(s.ic(0,"tr",17),s.ic(1,"td",18),s.dc(2,"img",19),s.sc(3,"assetPreview"),s.hc(),s.ic(4,"td",20),s.Wc(5),s.hc(),s.ic(6,"td",21),s.Wc(7),s.hc(),s.ic(8,"td",22),s.Wc(9),s.dc(10,"vdr-line-refunds",23),s.hc(),s.ic(11,"td",22),s.Wc(12),s.sc(13,"localeCurrency"),s.hc(),s.ic(14,"td",22),s.ic(15,"div",24),s.Wc(16),s.sc(17,"localeCurrency"),s.Uc(18,$e,2,1,"ng-container",25),s.hc(),s.hc(),s.ic(19,"td",26),s.Uc(20,Xe,1,2,"input",27),s.hc(),s.ic(21,"td",28),s.ic(22,"div",29),s.Uc(23,qe,1,2,"input",30),s.hc(),s.hc(),s.ic(24,"td",28),s.ic(25,"div",29),s.Uc(26,Ve,1,2,"input",30),s.hc(),s.hc(),s.hc()),2&e){var c=t.$implicit,n=s.rc();s.Rb(2),s.yc("src",s.uc(3,11,c.featuredAsset,"tiny"),s.Nc),s.Rb(3),s.Xc(c.productVariant.name),s.Rb(2),s.Xc(c.productVariant.sku),s.Rb(2),s.Yc(" ",c.quantity," "),s.Rb(1),s.yc("line",c),s.Rb(2),s.Yc(" ",s.uc(13,14,c.unitPriceWithTax,n.order.currencyCode)," "),s.Rb(4),s.Yc(" ",s.uc(17,17,c.proratedUnitPriceWithTax,n.order.currencyCode)," "),s.Rb(2),s.yc("ngIf",c.discounts),s.Rb(2),s.yc("ngIf",n.lineCanBeRefundedOrCancelled(c)),s.Rb(3),s.yc("ngIf",n.lineCanBeRefundedOrCancelled(c)),s.Rb(3),s.yc("ngIf",n.lineCanBeRefundedOrCancelled(c))}}function He(e,t){if(1&e&&(s.ic(0,"option",39),s.Wc(1),s.sc(2,"localeCurrency"),s.hc()),2&e){var c=t.$implicit,n=s.rc();s.yc("ngValue",c)("disabled","Settled"!==c.state),s.Rb(1),s.ad(" #",c.id," ",c.method,": ",s.uc(2,5,c.amount,n.order.currencyCode)," ")}}var Be=function(e,t){return{min:e,max:t}};function Ge(e,t){if(1&e&&(s.ic(0,"div",40),s.Wc(1),s.sc(2,"translate"),s.sc(3,"currency"),s.sc(4,"localeCurrency"),s.hc()),2&e){var c=s.rc();s.Rb(1),s.Yc(" ",s.uc(2,1,"order.refund-total-error",s.Dc(10,Be,s.uc(3,4,0,c.order.currencyCode),s.uc(4,7,c.selectedPayment.amount,c.order.currencyCode)))," ")}}var ze=function(e){return{amount:e}};function Ze(e,t){if(1&e&&(s.gc(0),s.Wc(1),s.sc(2,"translate"),s.sc(3,"localeCurrency"),s.fc()),2&e){var c=s.rc(2);s.Rb(1),s.Yc(" ",s.uc(2,1,"order.refund-with-amount",s.Cc(7,ze,s.uc(3,4,c.refundTotal,c.order.currencyCode)))," ")}}function Je(e,t){1&e&&(s.Wc(0),s.sc(1,"translate")),2&e&&s.Yc(" ",s.tc(1,1,"order.cancel-selected-items")," ")}function Ke(e,t){if(1&e){var c=s.jc();s.ic(0,"button",41),s.pc("click",(function(){return s.Lc(c),s.rc().cancel()})),s.Wc(1),s.sc(2,"translate"),s.hc(),s.ic(3,"button",42),s.pc("click",(function(){return s.Lc(c),s.rc().select()})),s.Uc(4,Ze,4,9,"ng-container",43),s.Uc(5,Je,2,3,"ng-template",null,44,s.Vc),s.hc()}if(2&e){var n=s.Ic(6),r=s.rc();s.Rb(1),s.Xc(s.tc(2,4,"common.cancel")),s.Rb(2),s.yc("disabled",!r.canSubmit()),s.Rb(1),s.yc("ngIf",r.isRefunding())("ngIfElse",n)}}function et(e,t){1&e&&(s.Wc(0),s.sc(1,"translate")),2&e&&s.Xc(s.tc(1,1,"order.settle-refund"))}function tt(e,t){if(1&e){var c=s.jc();s.ic(0,"button",4),s.pc("click",(function(){return s.Lc(c),s.rc().cancel()})),s.Wc(1),s.sc(2,"translate"),s.hc(),s.ic(3,"button",5),s.pc("click",(function(){return s.Lc(c),s.rc().submit()})),s.Wc(4),s.sc(5,"translate"),s.hc()}if(2&e){var n=s.rc();s.Rb(1),s.Xc(s.tc(2,3,"common.cancel")),s.Rb(2),s.yc("disabled",!n.transactionId),s.Rb(1),s.Yc(" ",s.tc(5,5,"order.settle-refund")," ")}}var ct=function(e){return{method:e}};function nt(e,t){if(1&e){var c=s.jc();s.ic(0,"button",16),s.pc("click",(function(){s.Lc(c);var e=s.rc().ngIf;return s.rc().addManualPayment(e)})),s.Wc(1),s.sc(2,"translate"),s.sc(3,"localeCurrency"),s.hc()}if(2&e){var n=s.rc().ngIf,r=s.rc();s.Rb(1),s.Zc(" ",s.tc(2,2,"order.add-payment-to-order")," (",s.uc(3,4,r.getOutstandingModificationAmount(n),n.currencyCode),") ")}}function rt(e,t){if(1&e){var c=s.jc();s.gc(0),s.ic(1,"button",14),s.pc("click",(function(){return s.Lc(c),s.rc(2).transitionToModifying()})),s.dc(2,"clr-icon",17),s.Wc(3),s.sc(4,"translate"),s.hc(),s.dc(5,"div",13),s.fc()}2&e&&(s.Rb(3),s.Yc(" ",s.tc(4,1,"order.modify-order")," "))}function it(e,t){1&e&&(s.gc(0),s.Wc(1),s.sc(2,"translate"),s.fc()),2&e&&(s.Rb(1),s.Yc(" ",s.tc(2,1,"order.refund-and-cancel-order")," "))}function ot(e,t){1&e&&(s.Wc(0),s.sc(1,"translate")),2&e&&s.Yc(" ",s.tc(1,1,"order.cancel-order")," ")}function at(e,t){if(1&e){var c=s.jc();s.ic(0,"button",14),s.pc("click",(function(){s.Lc(c);var e=s.rc().ngIf;return s.rc().cancelOrRefund(e)})),s.dc(1,"clr-icon",18),s.Uc(2,it,3,3,"ng-container",19),s.Uc(3,ot,2,3,"ng-template",null,20,s.Vc),s.hc()}if(2&e){var n=s.Ic(4),r=s.rc().ngIf,i=s.rc();s.Rb(2),s.yc("ngIf",i.orderHasSettledPayments(r))("ngIfElse",n)}}function lt(e,t){if(1&e){var c=s.jc();s.ic(0,"button",14),s.pc("click",(function(){s.Lc(c);var e=t.$implicit;return s.rc(3).transitionToState(e)})),s.dc(1,"clr-icon",22),s.Wc(2),s.sc(3,"translate"),s.sc(4,"translate"),s.sc(5,"stateI18nToken"),s.hc()}if(2&e){var n=t.$implicit;s.Rb(2),s.Yc(" ",s.uc(3,1,"order.transition-to-state",s.Cc(8,oe,s.tc(4,4,s.tc(5,6,n))))," ")}}function dt(e,t){if(1&e&&(s.gc(0),s.dc(1,"div",13),s.Uc(2,lt,6,10,"button",21),s.sc(3,"async"),s.fc()),2&e){var c=s.rc(2);s.Rb(2),s.yc("ngForOf",s.tc(3,1,c.nextStates$))}}function st(e,t){if(1&e){var c=s.jc();s.ic(0,"vdr-action-bar"),s.ic(1,"vdr-ab-left"),s.ic(2,"div",1),s.dc(3,"vdr-entity-info",2),s.sc(4,"async"),s.ic(5,"vdr-order-state-label",3),s.ic(6,"button",4),s.pc("click",(function(){return s.Lc(c),s.rc().openStateDiagram()})),s.sc(7,"translate"),s.dc(8,"clr-icon",5),s.hc(),s.hc(),s.hc(),s.hc(),s.ic(9,"vdr-ab-right"),s.dc(10,"vdr-action-bar-items",6),s.Uc(11,nt,4,7,"button",7),s.ic(12,"button",8),s.pc("click",(function(){return s.Lc(c),s.rc().fulfillOrder()})),s.Wc(13),s.sc(14,"translate"),s.hc(),s.ic(15,"vdr-dropdown"),s.ic(16,"button",9),s.dc(17,"clr-icon",10),s.hc(),s.ic(18,"vdr-dropdown-menu",11),s.Uc(19,rt,6,3,"ng-container",0),s.Uc(20,at,5,2,"button",12),s.Uc(21,dt,4,3,"ng-container",0),s.sc(22,"async"),s.dc(23,"div",13),s.ic(24,"button",14),s.pc("click",(function(){s.Lc(c);var e=t.ngIf;return s.rc().manuallyTransitionToState(e)})),s.dc(25,"clr-icon",15),s.Wc(26),s.sc(27,"translate"),s.hc(),s.hc(),s.hc(),s.hc(),s.hc()}if(2&e){var n,r=t.ngIf,i=s.rc();s.Rb(3),s.yc("entity",s.tc(4,10,i.entity$)),s.Rb(2),s.yc("state",r.state),s.Rb(1),s.yc("title",s.tc(7,12,"order.order-state-diagram")),s.Rb(5),s.yc("ngIf",i.hasUnsettledModifications(r)),s.Rb(1),s.yc("disabled",!i.canAddFulfillment(r)),s.Rb(1),s.Yc(" ",s.tc(14,14,"order.fulfill-order")," "),s.Rb(6),s.yc("ngIf",r.nextStates.includes("Modifying")),s.Rb(1),s.yc("ngIf",r.nextStates.includes("Cancelled")),s.Rb(1),s.yc("ngIf",null==(n=s.tc(22,16,i.nextStates$))?null:n.length),s.Rb(5),s.Yc(" ",s.tc(27,18,"order.manually-transition-to-state")," ")}}function ut(e,t){if(1&e&&(s.ic(0,"tr"),s.ic(1,"td"),s.Wc(2),s.hc(),s.ic(3,"td"),s.Wc(4),s.sc(5,"percent"),s.hc(),s.ic(6,"td"),s.Wc(7),s.sc(8,"localeCurrency"),s.hc(),s.ic(9,"td"),s.Wc(10),s.sc(11,"localeCurrency"),s.hc(),s.hc()),2&e){var c=t.$implicit,n=s.rc().ngIf;s.Rb(2),s.Xc(c.description),s.Rb(2),s.Xc(s.tc(5,4,c.taxRate/100)),s.Rb(3),s.Xc(s.uc(8,6,c.taxBase,n.currencyCode)),s.Rb(3),s.Xc(s.uc(11,9,c.taxTotal,n.currencyCode))}}function ft(e,t){1&e&&(s.ic(0,"h6"),s.Wc(1),s.sc(2,"translate"),s.hc()),2&e&&(s.Rb(1),s.Yc(" ",s.tc(2,1,"order.shipping-address")," "))}function pt(e,t){1&e&&(s.ic(0,"h6"),s.Wc(1),s.sc(2,"translate"),s.hc()),2&e&&(s.Rb(1),s.Yc(" ",s.tc(2,1,"order.billing-address")," "))}function mt(e,t){if(1&e){var c=s.jc();s.ic(0,"vdr-order-payment-card",38),s.pc("settlePayment",(function(e){return s.Lc(c),s.rc(3).settlePayment(e)}))("settleRefund",(function(e){return s.Lc(c),s.rc(3).settleRefund(e)})),s.hc()}if(2&e){var n=t.$implicit,r=s.rc(2).ngIf;s.yc("currencyCode",r.currencyCode)("payment",n)}}function ht(e,t){if(1&e&&(s.gc(0),s.Uc(1,mt,1,2,"vdr-order-payment-card",37),s.fc()),2&e){var c=s.rc().ngIf;s.Rb(1),s.yc("ngForOf",c.payments)}}function bt(e,t){if(1&e){var c=s.jc();s.gc(0),s.ic(1,"vdr-fulfillment-card",39),s.pc("transitionState",(function(e){s.Lc(c);var n=t.$implicit;return s.rc(2).transitionFulfillment(n.id,e)})),s.hc(),s.fc()}if(2&e){var n=t.$implicit,r=s.rc().ngIf;s.Rb(1),s.yc("fulfillment",n)("order",r)}}function gt(e,t){if(1&e){var c=s.jc();s.ic(0,"div"),s.ic(1,"div",23),s.ic(2,"div",24),s.dc(3,"vdr-order-table",25),s.ic(4,"h4"),s.Wc(5),s.sc(6,"translate"),s.hc(),s.ic(7,"table",26),s.ic(8,"thead"),s.ic(9,"tr"),s.ic(10,"th"),s.Wc(11),s.sc(12,"translate"),s.hc(),s.ic(13,"th"),s.Wc(14),s.sc(15,"translate"),s.hc(),s.ic(16,"th"),s.Wc(17),s.sc(18,"translate"),s.hc(),s.ic(19,"th"),s.Wc(20),s.sc(21,"translate"),s.hc(),s.hc(),s.hc(),s.ic(22,"tbody"),s.Uc(23,ut,12,12,"tr",27),s.hc(),s.hc(),s.ic(24,"vdr-order-history",28),s.pc("addNote",(function(e){return s.Lc(c),s.rc().addNote(e)}))("updateNote",(function(e){return s.Lc(c),s.rc().updateNote(e)}))("deleteNote",(function(e){return s.Lc(c),s.rc().deleteNote(e)})),s.sc(25,"async"),s.hc(),s.hc(),s.ic(26,"div",29),s.ic(27,"vdr-order-custom-fields-card",30),s.pc("updateClick",(function(e){return s.Lc(c),s.rc().updateCustomFields(e)})),s.hc(),s.ic(28,"div",31),s.ic(29,"div",32),s.Wc(30),s.sc(31,"translate"),s.hc(),s.ic(32,"div",33),s.ic(33,"div",34),s.dc(34,"vdr-customer-label",35),s.Uc(35,ft,3,3,"h6",0),s.dc(36,"vdr-formatted-address",36),s.Uc(37,pt,3,3,"h6",0),s.dc(38,"vdr-formatted-address",36),s.hc(),s.hc(),s.hc(),s.Uc(39,ht,2,1,"ng-container",0),s.Uc(40,bt,2,2,"ng-container",27),s.hc(),s.hc(),s.hc()}if(2&e){var n=t.ngIf,r=s.rc();s.Rb(3),s.yc("order",n)("orderLineCustomFields",r.orderLineCustomFields),s.Rb(2),s.Xc(s.tc(6,20,"order.tax-summary")),s.Rb(6),s.Xc(s.tc(12,22,"common.description")),s.Rb(3),s.Xc(s.tc(15,24,"order.tax-rate")),s.Rb(3),s.Xc(s.tc(18,26,"order.tax-base")),s.Rb(3),s.Xc(s.tc(21,28,"order.tax-total")),s.Rb(3),s.yc("ngForOf",n.taxSummary),s.Rb(1),s.yc("order",n)("history",s.tc(25,30,r.history$)),s.Rb(3),s.yc("customFieldsConfig",r.customFields)("customFieldValues",n.customFields),s.Rb(3),s.Yc(" ",s.tc(31,32,"order.customer")," "),s.Rb(4),s.yc("customer",n.customer),s.Rb(1),s.yc("ngIf",r.getOrderAddressLines(n.shippingAddress).length),s.Rb(1),s.yc("address",n.shippingAddress),s.Rb(1),s.yc("ngIf",r.getOrderAddressLines(n.billingAddress).length),s.Rb(1),s.yc("address",n.billingAddress),s.Rb(1),s.yc("ngIf",n.payments&&n.payments.length),s.Rb(1),s.yc("ngForOf",n.fulfillments)}}function yt(e,t){1&e&&(s.Wc(0),s.sc(1,"translate")),2&e&&s.Xc(s.tc(1,1,"order.confirm-modifications"))}function vt(e,t){if(1&e&&(s.ic(0,"option",9),s.Wc(1),s.sc(2,"localeCurrency"),s.hc()),2&e){var c=t.$implicit,n=s.rc(2);s.yc("ngValue",c),s.Rb(1),s.ad(" #",c.id," ",c.method,": ",s.uc(2,4,c.amount,n.order.currencyCode)," ")}}function Ct(e,t){if(1&e){var c=s.jc();s.ic(0,"div"),s.ic(1,"clr-select-container"),s.ic(2,"label"),s.Wc(3),s.sc(4,"translate"),s.hc(),s.ic(5,"select",5),s.pc("ngModelChange",(function(e){return s.Lc(c),s.rc().selectedPayment=e})),s.Uc(6,vt,3,7,"option",6),s.hc(),s.hc(),s.ic(7,"label",7),s.Wc(8),s.sc(9,"translate"),s.hc(),s.ic(10,"textarea",8),s.pc("ngModelChange",(function(e){return s.Lc(c),s.rc().refundNote=e})),s.hc(),s.hc()}if(2&e){var n=s.rc();s.Rb(3),s.Xc(s.tc(4,5,"order.payment-to-refund")),s.Rb(2),s.yc("ngModel",n.selectedPayment),s.Rb(1),s.yc("ngForOf",n.order.payments),s.Rb(2),s.Xc(s.tc(9,7,"order.refund-cancellation-reason")),s.Rb(2),s.yc("ngModel",n.refundNote)}}function Rt(e,t){if(1&e){var c=s.jc();s.ic(0,"button",10),s.pc("click",(function(){return s.Lc(c),s.rc().cancel()})),s.Wc(1),s.sc(2,"translate"),s.hc(),s.ic(3,"button",11),s.pc("click",(function(){return s.Lc(c),s.rc().submit()})),s.Wc(4),s.sc(5,"translate"),s.hc()}if(2&e){var n=s.rc();s.Rb(1),s.Xc(s.tc(2,3,"common.cancel")),s.Rb(2),s.yc("disabled",n.priceDifference<0&&!n.selectedPayment),s.Rb(1),s.Yc(" ",s.tc(5,5,"common.confirm")," ")}}function Ot(e,t){if(1&e){var c=s.jc();s.ic(0,"vdr-action-bar"),s.ic(1,"vdr-ab-left"),s.ic(2,"div",1),s.dc(3,"vdr-entity-info",2),s.sc(4,"async"),s.dc(5,"vdr-order-state-label",3),s.hc(),s.hc(),s.ic(6,"vdr-ab-right"),s.ic(7,"button",4),s.pc("click",(function(){s.Lc(c);var e=t.ngIf;return s.rc().transitionToPriorState(e)})),s.Wc(8),s.sc(9,"translate"),s.hc(),s.hc(),s.hc()}if(2&e){var n=t.ngIf,r=s.rc();s.Rb(3),s.yc("entity",s.tc(4,3,r.entity$)),s.Rb(2),s.yc("state",n.state),s.Rb(3),s.Yc(" ",s.tc(9,5,"order.cancel-modification")," ")}}function It(e,t){1&e&&(s.ic(0,"th"),s.Wc(1),s.sc(2,"translate"),s.hc()),2&e&&(s.Rb(1),s.Xc(s.tc(2,1,"common.custom-fields")))}function St(e,t){if(1&e&&(s.dc(0,"img",41),s.sc(1,"assetPreview")),2&e){var c=s.rc().$implicit;s.yc("src",s.uc(1,1,c.featuredAsset,"tiny"),s.Nc)}}var Pt=function(e){return[e]};function kt(e,t){if(1&e&&(s.gc(0),s.dc(1,"vdr-custom-field-control",44),s.fc()),2&e){var c=t.$implicit,n=s.rc(2).index,r=s.rc(2);s.Rb(1),s.yc("customField",c)("customFieldsFormGroup",r.orderLineCustomFieldsFormArray.get(s.Cc(3,Pt,n)))("compact",!0)}}function Mt(e,t){if(1&e&&(s.ic(0,"td",42),s.Uc(1,kt,2,5,"ng-container",43),s.hc()),2&e){var c=s.rc(3);s.Rb(1),s.yc("ngForOf",c.orderLineCustomFields)}}function Wt(e,t){if(1&e){var c=s.jc();s.ic(0,"tr",29),s.ic(1,"td",30),s.Uc(2,St,2,4,"img",31),s.hc(),s.ic(3,"td",32),s.Wc(4),s.hc(),s.ic(5,"td",33),s.Wc(6),s.hc(),s.ic(7,"td",34),s.Wc(8),s.sc(9,"localeCurrency"),s.ic(10,"div",16),s.sc(11,"translate"),s.Wc(12),s.sc(13,"localeCurrency"),s.hc(),s.hc(),s.ic(14,"td",35),s.ic(15,"input",36),s.pc("input",(function(e){s.Lc(c);var n=t.$implicit;return s.rc(2).updateLineQuantity(n,e.target.value)})),s.hc(),s.dc(16,"vdr-line-refunds",37),s.dc(17,"vdr-line-fulfillment",38),s.hc(),s.Uc(18,Mt,2,1,"td",39),s.ic(19,"td",40),s.Wc(20),s.sc(21,"localeCurrency"),s.ic(22,"div",16),s.sc(23,"translate"),s.Wc(24),s.sc(25,"localeCurrency"),s.hc(),s.hc(),s.hc()}if(2&e){var n=t.$implicit,r=s.rc().ngIf,i=s.rc();s.Ub("is-cancelled",0===n.quantity)("modified",i.isLineModified(n)),s.Rb(2),s.yc("ngIf",n.featuredAsset),s.Rb(2),s.Xc(n.productVariant.name),s.Rb(2),s.Xc(n.productVariant.sku),s.Rb(2),s.Yc(" ",s.uc(9,18,n.unitPriceWithTax,r.currencyCode)," "),s.Rb(2),s.yc("title",s.tc(11,21,"order.net-price")),s.Rb(2),s.Yc(" ",s.uc(13,23,n.unitPrice,r.currencyCode)," "),s.Rb(3),s.yc("value",n.quantity),s.Rb(1),s.yc("line",n),s.Rb(1),s.yc("line",n)("orderState",r.state),s.Rb(1),s.yc("ngIf",i.orderLineCustomFields.length),s.Rb(2),s.Yc(" ",s.uc(21,26,n.linePriceWithTax,r.currencyCode)," "),s.Rb(2),s.yc("title",s.tc(23,29,"order.net-price")),s.Rb(2),s.Yc(" ",s.uc(25,31,n.linePrice,r.currencyCode)," ")}}function Ft(e,t){if(1&e&&(s.dc(0,"img",41),s.sc(1,"assetPreview")),2&e){var c=s.rc().$implicit;s.yc("src",s.uc(1,1,c.productAsset,"tiny"),s.Nc)}}function xt(e,t){if(1&e&&(s.gc(0),s.dc(1,"vdr-custom-field-control",44),s.fc()),2&e){var c=t.$implicit,n=s.rc(2).index,r=s.rc(2);s.Rb(1),s.yc("customField",c)("customFieldsFormGroup",r.addItemCustomFieldsFormArray.get(s.Cc(3,Pt,n)))("compact",!0)}}function wt(e,t){if(1&e&&(s.ic(0,"td",42),s.Uc(1,xt,2,5,"ng-container",43),s.hc()),2&e){var c=s.rc(3);s.Rb(1),s.yc("ngForOf",c.orderLineCustomFields)}}function _t(e,t){if(1&e){var c=s.jc();s.ic(0,"tr",45),s.ic(1,"td",30),s.Uc(2,Ft,2,4,"img",31),s.hc(),s.ic(3,"td",32),s.Wc(4),s.hc(),s.ic(5,"td",33),s.Wc(6),s.hc(),s.ic(7,"td",34),s.Wc(8),s.sc(9,"localeCurrency"),s.ic(10,"div",16),s.sc(11,"translate"),s.Wc(12),s.sc(13,"localeCurrency"),s.hc(),s.hc(),s.ic(14,"td",35),s.ic(15,"input",36),s.pc("input",(function(e){s.Lc(c);var n=t.$implicit;return s.rc(2).updateAddedItemQuantity(n,e.target.value)})),s.hc(),s.ic(16,"button",46),s.pc("click",(function(){s.Lc(c);var e=t.index;return s.rc(2).removeAddedItem(e)})),s.dc(17,"clr-icon",47),s.hc(),s.hc(),s.Uc(18,wt,2,1,"td",39),s.ic(19,"td",40),s.Wc(20),s.sc(21,"currency"),s.ic(22,"div",16),s.sc(23,"translate"),s.Wc(24),s.sc(25,"currency"),s.hc(),s.hc(),s.hc()}if(2&e){var n=t.$implicit,r=s.rc().ngIf,i=s.rc();s.Rb(2),s.yc("ngIf",n.productAsset),s.Rb(2),s.Xc(n.productVariantName),s.Rb(2),s.Xc(n.sku),s.Rb(2),s.Yc(" ",s.uc(9,11,n.priceWithTax,r.currencyCode)," "),s.Rb(2),s.yc("title",s.tc(11,14,"order.net-price")),s.Rb(2),s.Yc(" ",s.uc(13,16,n.price,r.currencyCode)," "),s.Rb(3),s.yc("value",n.quantity),s.Rb(3),s.yc("ngIf",i.orderLineCustomFields.length),s.Rb(2),s.Yc(" ",s.uc(21,19,n.priceWithTax*n.quantity/100,r.currencyCode)," "),s.Rb(2),s.yc("title",s.tc(23,22,"order.net-price")),s.Rb(2),s.Yc(" ",s.uc(25,24,n.price*n.quantity/100,r.currencyCode)," ")}}function Tt(e,t){1&e&&s.dc(0,"td")}function Lt(e,t){if(1&e&&(s.ic(0,"tr",48),s.ic(1,"td",49),s.Wc(2),s.hc(),s.ic(3,"td",33),s.Wc(4),s.hc(),s.dc(5,"td",50),s.dc(6,"td"),s.Uc(7,Tt,1,0,"td",0),s.ic(8,"td",40),s.Wc(9),s.sc(10,"localeCurrency"),s.ic(11,"div",16),s.sc(12,"translate"),s.Wc(13),s.sc(14,"localeCurrency"),s.hc(),s.hc(),s.hc()),2&e){var c=t.$implicit,n=s.rc().ngIf,r=s.rc();s.Rb(2),s.Xc(c.description),s.Rb(2),s.Xc(c.sku),s.Rb(3),s.yc("ngIf",r.orderLineCustomFields.length),s.Rb(2),s.Yc(" ",s.uc(10,6,c.priceWithTax,n.currencyCode)," "),s.Rb(2),s.yc("title",s.tc(12,9,"order.net-price")),s.Rb(2),s.Yc(" ",s.uc(14,11,c.price,n.currencyCode)," ")}}function Dt(e,t){1&e&&s.dc(0,"td")}function jt(e,t){if(1&e&&(s.gc(0),s.Wc(1),s.sc(2,"localeCurrency"),s.ic(3,"div",16),s.sc(4,"translate"),s.Wc(5),s.sc(6,"localeCurrency"),s.hc(),s.fc()),2&e){var c=t.ngIf,n=s.rc(2).ngIf;s.Rb(1),s.Yc(" ",s.uc(2,3,c.priceWithTax,n.currencyCode)," "),s.Rb(2),s.yc("title",s.tc(4,6,"order.net-price")),s.Rb(2),s.Yc(" ",s.uc(6,8,c.price,n.currencyCode)," ")}}function Ut(e,t){if(1&e){var c=s.jc();s.ic(0,"tr",51),s.ic(1,"td",49),s.Wc(2),s.ic(3,"button",46),s.pc("click",(function(){s.Lc(c);var e=t.index;return s.rc(2).removeSurcharge(e)})),s.dc(4,"clr-icon",47),s.hc(),s.hc(),s.ic(5,"td",33),s.Wc(6),s.hc(),s.dc(7,"td",50),s.dc(8,"td"),s.Uc(9,Dt,1,0,"td",0),s.ic(10,"td",40),s.Uc(11,jt,7,11,"ng-container",0),s.hc(),s.hc()}if(2&e){var n=t.$implicit,r=s.rc(2);s.Rb(2),s.Yc(" ",n.description," "),s.Rb(4),s.Xc(n.sku),s.Rb(3),s.yc("ngIf",r.orderLineCustomFields.length),s.Rb(2),s.yc("ngIf",r.getSurchargePrices(n))}}function At(e,t){1&e&&s.dc(0,"td")}function Nt(e,t){if(1&e&&(s.dc(0,"img",58),s.sc(1,"assetPreview")),2&e){var c=t.ngIf;s.yc("src",s.uc(1,1,c,"tiny"),s.Nc)}}function Et(e,t){if(1&e&&(s.ic(0,"div",55),s.Uc(1,Nt,2,4,"img",56),s.ic(2,"div"),s.ic(3,"strong",57),s.Wc(4),s.hc(),s.ic(5,"small"),s.Wc(6),s.hc(),s.ic(7,"div"),s.Wc(8),s.sc(9,"localeCurrency"),s.hc(),s.hc(),s.hc()),2&e){var c=s.rc(2).ngIf,n=s.rc();s.Rb(1),s.yc("ngIf",n.addItemSelectedVariant.productAsset),s.Rb(3),s.Xc(n.addItemSelectedVariant.productVariantName),s.Rb(2),s.Xc(n.addItemSelectedVariant.sku),s.Rb(2),s.Xc(s.uc(9,4,n.getSelectedItemPrice(n.addItemSelectedVariant),c.currencyCode))}}function Yt(e,t){if(1&e&&(s.gc(0),s.dc(1,"vdr-custom-field-control",59),s.fc()),2&e){var c=t.$implicit,n=s.rc(3);s.Rb(1),s.yc("readonly",!n.addItemSelectedVariant)("customField",c)("customFieldsFormGroup",n.addItemCustomFieldsForm)("compact",!0)}}function $t(e,t){if(1&e){var c=s.jc();s.ic(0,"clr-accordion-content"),s.ic(1,"vdr-product-selector",52),s.pc("productSelected",(function(e){return s.Lc(c),s.rc(2).addItemSelectedVariant=e})),s.hc(),s.Uc(2,Et,10,7,"div",53),s.Uc(3,Yt,2,4,"ng-container",43),s.ic(4,"button",54),s.pc("click",(function(){s.Lc(c);var e=s.rc(2);return e.addItemToOrder(e.addItemSelectedVariant)})),s.Wc(5),s.sc(6,"translate"),s.hc(),s.hc()}if(2&e){var n=s.rc(2);s.Rb(2),s.yc("ngIf",n.addItemSelectedVariant),s.Rb(1),s.yc("ngForOf",n.orderLineCustomFields),s.Rb(1),s.yc("disabled",!n.addItemSelectedVariant||n.addItemCustomFieldsForm.invalid),s.Rb(1),s.Yc(" ",s.tc(6,4,"order.add-item-to-order")," ")}}var Xt=function(e){return{rate:e}};function qt(e,t){if(1&e){var c=s.jc();s.ic(0,"clr-accordion-content"),s.ic(1,"form",60),s.pc("submit",(function(){s.Lc(c);var e=s.rc(2);return e.addSurcharge(e.surchargeForm.value)})),s.ic(2,"vdr-form-field",61),s.sc(3,"translate"),s.dc(4,"input",62),s.hc(),s.ic(5,"vdr-form-field",63),s.sc(6,"translate"),s.dc(7,"input",64),s.hc(),s.ic(8,"vdr-form-field",65),s.sc(9,"translate"),s.dc(10,"vdr-currency-input",66),s.hc(),s.ic(11,"vdr-form-field",67),s.sc(12,"translate"),s.dc(13,"input",68),s.hc(),s.ic(14,"vdr-form-field",69),s.sc(15,"translate"),s.ic(16,"vdr-affixed-input",70),s.dc(17,"input",71),s.hc(),s.hc(),s.ic(18,"vdr-form-field",72),s.sc(19,"translate"),s.dc(20,"input",73),s.hc(),s.ic(21,"button",74),s.Wc(22),s.sc(23,"translate"),s.hc(),s.hc(),s.hc()}if(2&e){var n,r=s.rc().ngIf,i=s.rc(),o=null;s.Rb(1),s.yc("formGroup",i.surchargeForm),s.Rb(1),s.yc("label",s.tc(3,10,"common.description")),s.Rb(3),s.yc("label",s.tc(6,12,"order.product-sku")),s.Rb(3),s.yc("label",s.tc(9,14,"common.price")),s.Rb(2),s.yc("currencyCode",r.currencyCode),s.Rb(1),s.yc("label",s.uc(12,16,"catalog.price-includes-tax-at",s.Cc(25,Xt,null==(n=i.surchargeForm.get("taxRate"))?null:n.value))),s.Rb(3),s.yc("label",s.tc(15,19,"order.tax-rate")),s.Rb(4),s.yc("label",s.tc(19,21,"order.tax-description")),s.Rb(3),s.yc("disabled",i.surchargeForm.invalid||i.surchargeForm.pristine||0===(null==(o=i.surchargeForm.get("price"))?null:o.value)),s.Rb(1),s.Yc(" ",s.tc(23,23,"order.add-surcharge")," ")}}function Vt(e,t){if(1&e&&(s.ic(0,"clr-accordion-content"),s.dc(1,"vdr-address-form",75),s.sc(2,"async"),s.hc()),2&e){var c=s.rc(2);s.Rb(1),s.yc("formGroup",c.shippingAddressForm)("availableCountries",s.tc(2,3,c.availableCountries$))("customFields",c.addressCustomFields)}}function Qt(e,t){if(1&e&&(s.ic(0,"clr-accordion-content"),s.dc(1,"vdr-address-form",75),s.sc(2,"async"),s.hc()),2&e){var c=s.rc(2);s.Rb(1),s.yc("formGroup",c.billingAddressForm)("availableCountries",s.tc(2,3,c.availableCountries$))("customFields",c.addressCustomFields)}}function Ht(e,t){if(1&e&&(s.ic(0,"li"),s.Wc(1),s.sc(2,"translate"),s.hc()),2&e){var c=s.rc(2);s.Rb(1),s.Yc(" ",s.uc(2,1,"order.modification-adding-items",s.Cc(4,Oe,null==c.modifyOrderInput.addItems?null:c.modifyOrderInput.addItems.length))," ")}}function Bt(e,t){if(1&e&&(s.ic(0,"li"),s.Wc(1),s.sc(2,"translate"),s.hc()),2&e){var c=s.rc(2);s.Rb(1),s.Yc(" ",s.uc(2,1,"order.modification-adjusting-lines",s.Cc(4,Oe,null==c.modifyOrderInput.adjustOrderLines?null:c.modifyOrderInput.adjustOrderLines.length))," ")}}function Gt(e,t){if(1&e&&(s.ic(0,"li"),s.Wc(1),s.sc(2,"translate"),s.hc()),2&e){var c=s.rc(2);s.Rb(1),s.Yc(" ",s.uc(2,1,"order.modification-adding-surcharges",s.Cc(4,Oe,null==c.modifyOrderInput.surcharges?null:c.modifyOrderInput.surcharges.length))," ")}}function zt(e,t){1&e&&(s.ic(0,"li"),s.Wc(1),s.sc(2,"translate"),s.hc()),2&e&&(s.Rb(1),s.Yc(" ",s.tc(2,1,"order.modification-updating-shipping-address")," "))}function Zt(e,t){1&e&&(s.ic(0,"li"),s.Wc(1),s.sc(2,"translate"),s.hc()),2&e&&(s.Rb(1),s.Yc(" ",s.tc(2,1,"order.modification-updating-billing-address")," "))}function Jt(e,t){if(1&e){var c=s.jc();s.ic(0,"div"),s.ic(1,"div",5),s.ic(2,"div",6),s.ic(3,"table",7),s.ic(4,"thead"),s.ic(5,"tr"),s.dc(6,"th"),s.ic(7,"th"),s.Wc(8),s.sc(9,"translate"),s.hc(),s.ic(10,"th"),s.Wc(11),s.sc(12,"translate"),s.hc(),s.ic(13,"th"),s.Wc(14),s.sc(15,"translate"),s.hc(),s.ic(16,"th"),s.Wc(17),s.sc(18,"translate"),s.hc(),s.Uc(19,It,3,3,"th",0),s.ic(20,"th"),s.Wc(21),s.sc(22,"translate"),s.hc(),s.hc(),s.hc(),s.ic(23,"tbody"),s.Uc(24,Wt,26,34,"tr",8),s.Uc(25,_t,26,27,"tr",9),s.Uc(26,Lt,15,14,"tr",10),s.Uc(27,Ut,12,4,"tr",11),s.ic(28,"tr",12),s.ic(29,"td",13),s.Wc(30),s.sc(31,"translate"),s.hc(),s.ic(32,"td",14),s.Wc(33),s.hc(),s.dc(34,"td",15),s.Uc(35,At,1,0,"td",0),s.ic(36,"td",14),s.Wc(37),s.sc(38,"localeCurrency"),s.ic(39,"div",16),s.sc(40,"translate"),s.Wc(41),s.sc(42,"localeCurrency"),s.hc(),s.hc(),s.hc(),s.hc(),s.hc(),s.ic(43,"h4",17),s.Wc(44),s.sc(45,"translate"),s.hc(),s.ic(46,"clr-accordion"),s.ic(47,"clr-accordion-panel"),s.ic(48,"clr-accordion-title"),s.Wc(49),s.sc(50,"translate"),s.hc(),s.Uc(51,$t,7,6,"clr-accordion-content",18),s.hc(),s.ic(52,"clr-accordion-panel"),s.ic(53,"clr-accordion-title"),s.Wc(54),s.sc(55,"translate"),s.hc(),s.Uc(56,qt,24,27,"clr-accordion-content",18),s.hc(),s.ic(57,"clr-accordion-panel"),s.ic(58,"clr-accordion-title"),s.Wc(59),s.sc(60,"translate"),s.hc(),s.Uc(61,Vt,3,5,"clr-accordion-content",18),s.hc(),s.ic(62,"clr-accordion-panel"),s.ic(63,"clr-accordion-title"),s.Wc(64),s.sc(65,"translate"),s.hc(),s.Uc(66,Qt,3,5,"clr-accordion-content",18),s.hc(),s.hc(),s.hc(),s.ic(67,"div",19),s.ic(68,"div",20),s.ic(69,"div",21),s.Wc(70),s.sc(71,"translate"),s.hc(),s.ic(72,"div",22),s.ic(73,"ul"),s.Uc(74,Ht,3,6,"li",0),s.Uc(75,Bt,3,6,"li",0),s.Uc(76,Gt,3,6,"li",0),s.Uc(77,zt,3,3,"li",0),s.Uc(78,Zt,3,3,"li",0),s.hc(),s.hc(),s.ic(79,"div",22),s.ic(80,"label",23),s.Wc(81),s.sc(82,"translate"),s.hc(),s.ic(83,"textarea",24),s.pc("ngModelChange",(function(e){return s.Lc(c),s.rc().note=e})),s.hc(),s.ic(84,"clr-checkbox-wrapper",25),s.ic(85,"input",26),s.pc("ngModelChange",(function(e){return s.Lc(c),s.rc().recalculateShipping=e})),s.hc(),s.ic(86,"label"),s.Wc(87),s.sc(88,"translate"),s.hc(),s.hc(),s.hc(),s.ic(89,"div",27),s.ic(90,"button",28),s.pc("click",(function(){s.Lc(c);var e=t.ngIf;return s.rc().previewAndModify(e)})),s.Wc(91),s.sc(92,"translate"),s.hc(),s.hc(),s.hc(),s.hc(),s.hc(),s.hc()}if(2&e){var n=t.ngIf,r=s.rc();s.Rb(8),s.Xc(s.tc(9,34,"order.product-name")),s.Rb(3),s.Xc(s.tc(12,36,"order.product-sku")),s.Rb(3),s.Xc(s.tc(15,38,"order.unit-price")),s.Rb(3),s.Xc(s.tc(18,40,"order.quantity")),s.Rb(2),s.yc("ngIf",r.orderLineCustomFields.length),s.Rb(2),s.Xc(s.tc(22,42,"order.total")),s.Rb(3),s.yc("ngForOf",n.lines),s.Rb(1),s.yc("ngForOf",r.addedLines)("ngForTrackBy",r.trackByProductVariantId),s.Rb(1),s.yc("ngForOf",n.surcharges),s.Rb(1),s.yc("ngForOf",r.modifyOrderInput.surcharges),s.Rb(3),s.Xc(s.tc(31,44,"order.shipping")),s.Rb(3),s.Xc(null==n.shippingLines[0]||null==n.shippingLines[0].shippingMethod?null:n.shippingLines[0].shippingMethod.name),s.Rb(2),s.yc("ngIf",r.orderLineCustomFields.length),s.Rb(2),s.Yc(" ",s.uc(38,46,n.shippingWithTax,n.currencyCode)," "),s.Rb(2),s.yc("title",s.tc(40,49,"order.net-price")),s.Rb(2),s.Yc(" ",s.uc(42,51,n.shipping,n.currencyCode)," "),s.Rb(3),s.Xc(s.tc(45,54,"order.modifications")),s.Rb(5),s.Xc(s.tc(50,56,"order.add-item-to-order")),s.Rb(5),s.Xc(s.tc(55,58,"order.add-surcharge")),s.Rb(5),s.Xc(s.tc(60,60,"order.edit-shipping-address")),s.Rb(5),s.Xc(s.tc(65,62,"order.edit-billing-address")),s.Rb(6),s.Yc(" ",s.tc(71,64,"order.modification-summary")," "),s.Rb(4),s.yc("ngIf",null==r.modifyOrderInput.addItems?null:r.modifyOrderInput.addItems.length),s.Rb(1),s.yc("ngIf",null==r.modifyOrderInput.adjustOrderLines?null:r.modifyOrderInput.adjustOrderLines.length),s.Rb(1),s.yc("ngIf",null==r.modifyOrderInput.surcharges?null:r.modifyOrderInput.surcharges.length),s.Rb(1),s.yc("ngIf",r.shippingAddressForm.dirty),s.Rb(1),s.yc("ngIf",r.billingAddressForm.dirty),s.Rb(3),s.Xc(s.tc(82,66,"order.note")),s.Rb(2),s.yc("ngModel",r.note),s.Rb(2),s.yc("ngModel",r.recalculateShipping),s.Rb(2),s.Xc(s.tc(88,68,"order.modification-recalculate-shipping")),s.Rb(3),s.yc("disabled",!r.canPreviewChanges()),s.Rb(1),s.Yc(" ",s.tc(92,70,"order.preview-changes")," ")}}function Kt(e,t){1&e&&(s.ic(0,"span",12),s.Wc(1),s.sc(2,"translate"),s.hc()),2&e&&(s.Rb(1),s.Yc(" ",s.tc(2,1,"order.note-only-visible-to-administrators")," "))}function ec(e,t){1&e&&(s.ic(0,"span",13),s.Wc(1),s.sc(2,"translate"),s.hc()),2&e&&(s.Rb(1),s.Yc(" ",s.tc(2,1,"order.note-visible-to-customer")," "))}function tc(e,t){1&e&&(s.ic(0,"div",11),s.Wc(1),s.sc(2,"translate"),s.hc()),2&e&&(s.Rb(1),s.Yc(" ",s.tc(2,1,"order.history-order-fulfilled")," "))}function cc(e,t){1&e&&(s.ic(0,"div",11),s.Wc(1),s.sc(2,"translate"),s.hc()),2&e&&(s.Rb(1),s.Yc(" ",s.tc(2,1,"order.history-order-cancelled")," "))}var nc=function(e,t){return{from:e,to:t}};function rc(e,t){if(1&e&&(s.Wc(0),s.sc(1,"translate")),2&e){var c=s.rc(2).$implicit;s.Yc(" ",s.uc(1,1,"order.history-order-transition",s.Dc(4,nc,c.data.from,c.data.to))," ")}}function ic(e,t){if(1&e&&(s.gc(0),s.Uc(1,tc,3,3,"div",17),s.Uc(2,cc,3,3,"div",17),s.Uc(3,rc,2,7,"ng-template",18),s.fc()),2&e){var c=s.rc().$implicit;s.Rb(1),s.yc("ngIf","Delivered"===c.data.to),s.Rb(1),s.yc("ngIf","Cancelled"===c.data.to),s.Rb(1),s.yc("ngIf","Cancelled"!==c.data.to&&"Delivered"!==c.data.to)}}function oc(e,t){1&e&&(s.ic(0,"vdr-chip",23),s.Wc(1),s.sc(2,"translate"),s.hc()),2&e&&(s.Rb(1),s.Xc(s.tc(2,1,"order.modification-settled")))}function ac(e,t){1&e&&(s.ic(0,"vdr-chip",24),s.Wc(1),s.sc(2,"translate"),s.hc()),2&e&&(s.Rb(1),s.Xc(s.tc(2,1,"order.modification-not-settled")))}function lc(e,t){if(1&e&&(s.gc(0),s.Wc(1),s.sc(2,"translate"),s.ic(3,"strong"),s.Wc(4),s.sc(5,"localeCurrency"),s.hc(),s.Uc(6,oc,3,3,"vdr-chip",20),s.Uc(7,ac,3,3,"vdr-chip",21),s.ic(8,"vdr-history-entry-detail"),s.dc(9,"vdr-modification-detail",22),s.hc(),s.fc()),2&e){var c=t.ngIf,n=s.rc(3);s.Rb(1),s.Yc(" ",s.tc(2,6,"order.modify-order-price-difference"),": "),s.Rb(3),s.Xc(s.uc(5,8,c.priceChange,n.order.currencyCode)),s.Rb(2),s.yc("ngIf",c.isSettled),s.Rb(1),s.yc("ngIf",!c.isSettled),s.Rb(2),s.yc("order",n.order)("modification",c)}}function dc(e,t){if(1&e&&(s.gc(0),s.ic(1,"div",11),s.Wc(2),s.sc(3,"translate"),s.hc(),s.Uc(4,lc,10,11,"ng-container",19),s.fc()),2&e){var c=s.rc().$implicit,n=s.rc();s.Rb(2),s.Yc(" ",s.tc(3,2,"order.history-order-modified")," "),s.Rb(2),s.yc("ngIf",n.getModification(c.data.modificationId))}}function sc(e,t){if(1&e&&(s.ic(0,"vdr-history-entry-detail"),s.dc(1,"vdr-payment-detail",27),s.hc()),2&e){var c=t.ngIf,n=s.rc(4);s.Rb(1),s.yc("payment",c)("currencyCode",n.order.currencyCode)}}function uc(e,t){if(1&e&&(s.gc(0),s.ic(1,"div",11),s.Wc(2),s.sc(3,"translate"),s.hc(),s.Wc(4),s.sc(5,"translate"),s.Uc(6,sc,2,2,"vdr-history-entry-detail",19),s.fc()),2&e){var c,n=s.rc(2).$implicit,r=s.rc();s.Rb(2),s.Yc(" ",s.tc(3,4,"order.history-payment-settled")," "),s.Rb(2),s.Zc(" ",s.tc(5,6,"order.transaction-id"),": ",null==(c=r.getPayment(n))?null:c.transactionId," "),s.Rb(2),s.yc("ngIf",r.getPayment(n))}}var fc=function(e,t,c){return{from:e,to:t,id:c}};function pc(e,t){if(1&e&&(s.Wc(0),s.sc(1,"translate")),2&e){var c,n=s.rc(2).$implicit,r=s.rc();s.Yc(" ",s.uc(1,1,"order.history-payment-transition",s.Ec(4,fc,n.data.from,n.data.to,null==(c=r.getPayment(n))?null:c.transactionId))," ")}}function mc(e,t){if(1&e&&(s.gc(0),s.Uc(1,uc,7,8,"ng-container",25),s.Uc(2,pc,2,8,"ng-template",null,26,s.Vc),s.fc()),2&e){var c=s.Ic(3),n=s.rc().$implicit;s.Rb(1),s.yc("ngIf","Settled"===n.data.to)("ngIfElse",c)}}function hc(e,t){if(1&e&&(s.gc(0),s.Wc(1),s.sc(2,"translate"),s.fc()),2&e){var c=s.rc().$implicit;s.Rb(1),s.Yc(" ",s.uc(2,1,"order.history-refund-transition",s.Ec(4,fc,c.data.from,c.data.to,c.data.refundId))," ")}}function bc(e,t){if(1&e&&(s.ic(0,"vdr-history-entry-detail"),s.ic(1,"vdr-labeled-data",28),s.sc(2,"translate"),s.Wc(3),s.hc(),s.ic(4,"vdr-labeled-data",28),s.sc(5,"translate"),s.dc(6,"vdr-simple-item-list",29),s.hc(),s.hc()),2&e){var c=t.ngIf,n=s.rc(2).$implicit;s.Rb(1),s.yc("label",s.tc(2,4,"order.cancellation-reason")),s.Rb(2),s.Yc(" ",n.data.reason," "),s.Rb(1),s.yc("label",s.tc(5,6,"order.contents")),s.Rb(2),s.yc("items",c)}}function gc(e,t){if(1&e&&(s.gc(0),s.Wc(1),s.sc(2,"translate"),s.Uc(3,bc,7,8,"vdr-history-entry-detail",19),s.fc()),2&e){var c=s.rc().$implicit,n=s.rc();s.Rb(1),s.Yc(" ",s.uc(2,2,"order.history-items-cancelled",s.Cc(5,Oe,c.data.orderItemIds.length))," "),s.Rb(2),s.yc("ngIf",n.getCancelledItems(c))}}function yc(e,t){if(1&e&&(s.ic(0,"vdr-history-entry-detail"),s.dc(1,"vdr-fulfillment-detail",30),s.hc()),2&e){var c=t.ngIf,n=s.rc(3);s.Rb(1),s.yc("fulfillmentId",c.id)("order",n.order)}}function vc(e,t){if(1&e&&(s.gc(0),s.Wc(1),s.sc(2,"translate"),s.Uc(3,yc,2,2,"vdr-history-entry-detail",19),s.fc()),2&e){var c=s.rc().$implicit,n=s.rc();s.Rb(1),s.Yc(" ",s.tc(2,2,"order.history-fulfillment-created")," "),s.Rb(2),s.yc("ngIf",n.getFulfillment(c))}}function Cc(e,t){if(1&e&&(s.gc(0),s.ic(1,"div",11),s.Wc(2),s.sc(3,"translate"),s.hc(),s.Wc(4),s.sc(5,"translate"),s.fc()),2&e){var c,n=s.rc(2).$implicit,r=s.rc();s.Rb(2),s.Yc(" ",s.tc(3,3,"order.history-fulfillment-delivered")," "),s.Rb(2),s.Zc(" ",s.tc(5,5,"order.tracking-code"),": ",null==(c=r.getFulfillment(n))?null:c.trackingCode," ")}}function Rc(e,t){if(1&e&&(s.gc(0),s.ic(1,"div",11),s.Wc(2),s.sc(3,"translate"),s.hc(),s.Wc(4),s.sc(5,"translate"),s.fc()),2&e){var c,n=s.rc(2).$implicit,r=s.rc();s.Rb(2),s.Yc(" ",s.tc(3,3,"order.history-fulfillment-shipped")," "),s.Rb(2),s.Zc(" ",s.tc(5,5,"order.tracking-code"),": ",null==(c=r.getFulfillment(n))?null:c.trackingCode," ")}}function Oc(e,t){if(1&e&&(s.gc(0),s.Wc(1),s.sc(2,"translate"),s.fc()),2&e){var c=s.rc(2).$implicit;s.Rb(1),s.Yc(" ",s.uc(2,1,"order.history-fulfillment-transition",s.Dc(4,nc,c.data.from,c.data.to))," ")}}function Ic(e,t){if(1&e&&(s.ic(0,"vdr-history-entry-detail"),s.dc(1,"vdr-fulfillment-detail",30),s.hc()),2&e){var c=t.ngIf,n=s.rc(3);s.Rb(1),s.yc("fulfillmentId",c.id)("order",n.order)}}function Sc(e,t){if(1&e&&(s.gc(0),s.Uc(1,Cc,6,7,"ng-container",19),s.Uc(2,Rc,6,7,"ng-container",19),s.Uc(3,Oc,3,7,"ng-container",19),s.Uc(4,Ic,2,2,"vdr-history-entry-detail",19),s.fc()),2&e){var c=s.rc().$implicit,n=s.rc();s.Rb(1),s.yc("ngIf","Delivered"===c.data.to),s.Rb(1),s.yc("ngIf","Shipped"===c.data.to),s.Rb(1),s.yc("ngIf","Delivered"!==c.data.to&&"Shipped"!==c.data.to),s.Rb(1),s.yc("ngIf",n.getFulfillment(c))}}function Pc(e,t){1&e&&(s.ic(0,"span",43),s.Wc(1),s.sc(2,"translate"),s.hc()),2&e&&(s.Rb(1),s.Xc(s.tc(2,1,"common.public")))}function kc(e,t){1&e&&(s.ic(0,"span",44),s.Wc(1),s.sc(2,"translate"),s.hc()),2&e&&(s.Rb(1),s.Xc(s.tc(2,1,"common.private")))}function Mc(e,t){if(1&e){var c=s.jc();s.gc(0),s.ic(1,"div",31),s.ic(2,"div",32),s.Uc(3,Pc,3,3,"span",33),s.Uc(4,kc,3,3,"span",34),s.Wc(5),s.hc(),s.dc(6,"div",35),s.ic(7,"vdr-dropdown"),s.ic(8,"button",36),s.dc(9,"clr-icon",37),s.hc(),s.ic(10,"vdr-dropdown-menu",38),s.ic(11,"button",39),s.pc("click",(function(){s.Lc(c);var e=s.rc().$implicit;return s.rc().updateNote.emit(e)})),s.sc(12,"hasPermission"),s.dc(13,"clr-icon",40),s.Wc(14),s.sc(15,"translate"),s.hc(),s.dc(16,"div",41),s.ic(17,"button",39),s.pc("click",(function(){s.Lc(c);var e=s.rc().$implicit;return s.rc().deleteNote.emit(e)})),s.sc(18,"hasPermission"),s.dc(19,"clr-icon",42),s.Wc(20),s.sc(21,"translate"),s.hc(),s.hc(),s.hc(),s.hc(),s.fc()}if(2&e){var n=s.rc().$implicit;s.Rb(3),s.yc("ngIf",n.isPublic),s.Rb(1),s.yc("ngIf",!n.isPublic),s.Rb(1),s.Yc(" ",n.data.note," "),s.Rb(6),s.yc("disabled",!s.tc(12,7,"UpdateOrder")),s.Rb(3),s.Yc(" ",s.tc(15,9,"common.edit")," "),s.Rb(3),s.yc("disabled",!s.tc(18,11,"UpdateOrder")),s.Rb(3),s.Yc(" ",s.tc(21,13,"common.delete")," ")}}var Wc=function(e){return["/marketing","promotions",e]};function Fc(e,t){if(1&e&&(s.gc(0),s.Wc(1),s.sc(2,"translate"),s.ic(3,"vdr-chip"),s.ic(4,"a",45),s.Wc(5),s.hc(),s.hc(),s.fc()),2&e){var c=s.rc().$implicit;s.Rb(1),s.Yc(" ",s.tc(2,3,"order.history-coupon-code-applied"),": "),s.Rb(3),s.yc("routerLink",s.Cc(5,Wc,c.data.promotionId)),s.Rb(1),s.Xc(c.data.couponCode)}}function xc(e,t){if(1&e&&(s.gc(0),s.Wc(1),s.sc(2,"translate"),s.ic(3,"vdr-chip"),s.ic(4,"span",46),s.Wc(5),s.hc(),s.hc(),s.fc()),2&e){var c=s.rc().$implicit;s.Rb(1),s.Yc(" ",s.tc(2,2,"order.history-coupon-code-removed"),": "),s.Rb(4),s.Xc(c.data.couponCode)}}function wc(e,t){if(1&e){var c=s.jc();s.ic(0,"vdr-timeline-entry",14),s.pc("expandClick",(function(){s.Lc(c);var e=s.rc();return e.expanded=!e.expanded})),s.gc(1,15),s.Uc(2,ic,4,3,"ng-container",16),s.Uc(3,dc,5,4,"ng-container",16),s.Uc(4,mc,4,2,"ng-container",16),s.Uc(5,hc,3,8,"ng-container",16),s.Uc(6,gc,4,7,"ng-container",16),s.Uc(7,vc,4,4,"ng-container",16),s.Uc(8,Sc,5,4,"ng-container",16),s.Uc(9,Mc,22,15,"ng-container",16),s.Uc(10,Fc,6,7,"ng-container",16),s.Uc(11,xc,6,4,"ng-container",16),s.fc(),s.hc()}if(2&e){var n=t.$implicit,r=s.rc();s.yc("displayType",r.getDisplayType(n))("iconShape",r.getTimelineIcon(n))("createdAt",n.createdAt)("name",r.getName(n))("featured",r.isFeatured(n))("collapsed",!r.expanded&&!r.isFeatured(n)),s.Rb(1),s.yc("ngSwitch",n.type),s.Rb(1),s.yc("ngSwitchCase",r.type.ORDER_STATE_TRANSITION),s.Rb(1),s.yc("ngSwitchCase",r.type.ORDER_MODIFIED),s.Rb(1),s.yc("ngSwitchCase",r.type.ORDER_PAYMENT_TRANSITION),s.Rb(1),s.yc("ngSwitchCase",r.type.ORDER_REFUND_TRANSITION),s.Rb(1),s.yc("ngSwitchCase",r.type.ORDER_CANCELLATION),s.Rb(1),s.yc("ngSwitchCase",r.type.ORDER_FULFILLMENT),s.Rb(1),s.yc("ngSwitchCase",r.type.ORDER_FULFILLMENT_TRANSITION),s.Rb(1),s.yc("ngSwitchCase",r.type.ORDER_NOTE),s.Rb(1),s.yc("ngSwitchCase",r.type.ORDER_COUPON_APPLIED),s.Rb(1),s.yc("ngSwitchCase",r.type.ORDER_COUPON_REMOVED)}}function _c(e,t){if(1&e){var c=s.jc();s.ic(0,"button",18),s.pc("click",(function(){s.Lc(c);var e=t.$implicit;return s.rc(2).selectFilterPreset(e.name)})),s.Wc(1),s.sc(2,"translate"),s.hc()}if(2&e){var n=t.$implicit,r=s.rc().ngIf;s.Ub("btn-primary",r===n.name),s.Rb(1),s.Yc(" ",s.tc(2,3,n.label)," ")}}function Tc(e,t){if(1&e){var c=s.jc();s.ic(0,"div",16),s.Uc(1,_c,3,5,"button",17),s.ic(2,"button",18),s.pc("click",(function(){return s.Lc(c),s.rc().selectFilterPreset("custom")})),s.Wc(3),s.sc(4,"translate"),s.dc(5,"clr-icon",19),s.hc(),s.hc()}if(2&e){var n=t.ngIf,r=s.rc();s.Rb(1),s.yc("ngForOf",r.filterPresets),s.Rb(1),s.Ub("btn-primary","custom"===n),s.Rb(1),s.Yc(" ",s.tc(4,4,"order.filter-custom")," ")}}function Lc(e,t){if(1&e&&(s.Wc(0),s.sc(1,"translate"),s.sc(2,"stateI18nToken")),2&e){var c=t.item;s.Xc(s.tc(1,1,s.tc(2,3,c)))}}function Dc(e,t){if(1&e&&(s.ic(0,"span",20),s.Wc(1),s.sc(2,"translate"),s.sc(3,"stateI18nToken"),s.hc(),s.ic(4,"span",21),s.pc("click",(function(){var e=t.item;return(0,t.clear)(e)})),s.Wc(5,"\xd7"),s.hc()),2&e){var c=t.item;s.Rb(1),s.Yc(" ",s.tc(2,1,s.tc(3,3,c)),"")}}var jc=function(e){return["./",e,"modify"]},Uc=function(e){return["./",e]};function Ac(e,t){if(1&e&&(s.ic(0,"td",22),s.Wc(1),s.hc(),s.ic(2,"td",22),s.dc(3,"vdr-customer-label",23),s.hc(),s.ic(4,"td",22),s.dc(5,"vdr-order-state-label",24),s.hc(),s.ic(6,"td",22),s.Wc(7),s.sc(8,"localeCurrency"),s.hc(),s.ic(9,"td",22),s.Wc(10),s.sc(11,"timeAgo"),s.hc(),s.ic(12,"td",22),s.Wc(13),s.sc(14,"localeDate"),s.hc(),s.ic(15,"td",22),s.Wc(16),s.hc(),s.ic(17,"td",25),s.dc(18,"vdr-table-row-action",26),s.sc(19,"translate"),s.hc()),2&e){var c=t.item,n=s.rc();s.Rb(1),s.Xc(c.code),s.Rb(2),s.yc("customer",c.customer),s.Rb(2),s.yc("state",c.state),s.Rb(2),s.Xc(s.uc(8,9,c.total,c.currencyCode)),s.Rb(3),s.Xc(s.tc(11,12,c.updatedAt)),s.Rb(3),s.Xc(s.uc(14,14,c.orderPlacedAt,"medium")),s.Rb(3),s.Xc(n.getShippingNames(c)),s.Rb(2),s.yc("label",s.tc(19,17,"common.open"))("linkTo","Modifying"===c.state?s.Cc(19,jc,c.id):s.Cc(21,Uc,c.id))}}function Nc(e,t){if(1&e&&(s.ic(0,"vdr-labeled-data",10),s.sc(1,"translate"),s.Wc(2),s.hc()),2&e){var c=s.rc().$implicit;s.yc("label",s.tc(1,2,"order.transaction-id")),s.Rb(2),s.Yc(" ",c.transactionId," ")}}function Ec(e,t){if(1&e&&(s.ic(0,"vdr-labeled-data",10),s.sc(1,"translate"),s.Wc(2),s.hc()),2&e){var c=s.rc().$implicit;s.yc("label",s.tc(1,2,"order.refund-reason")),s.Rb(2),s.Yc(" ",c.reason," ")}}function Yc(e,t){if(1&e&&(s.ic(0,"vdr-labeled-data",10),s.sc(1,"translate"),s.dc(2,"vdr-object-tree",12),s.hc()),2&e){var c=s.rc().$implicit;s.yc("label",s.tc(1,2,"order.refund-metadata")),s.Rb(2),s.yc("value",c.metadata)}}function $c(e,t){if(1&e){var c=s.jc();s.ic(0,"div",13),s.ic(1,"button",14),s.pc("click",(function(){s.Lc(c);var e=s.rc().$implicit;return s.rc().settleRefund.emit(e)})),s.Wc(2),s.sc(3,"translate"),s.hc(),s.hc()}2&e&&(s.Rb(2),s.Yc(" ",s.tc(3,1,"order.settle-refund")," "))}function Xc(e,t){if(1&e&&(s.gc(0),s.ic(1,"div",1),s.dc(2,"clr-icon",8),s.Wc(3),s.sc(4,"translate"),s.dc(5,"div",9),s.dc(6,"vdr-refund-state-label",3),s.hc(),s.ic(7,"div",4),s.ic(8,"vdr-labeled-data",10),s.sc(9,"translate"),s.Wc(10),s.sc(11,"localeDate"),s.hc(),s.ic(12,"vdr-labeled-data",10),s.sc(13,"translate"),s.Wc(14),s.sc(15,"localeCurrency"),s.hc(),s.Uc(16,Nc,3,4,"vdr-labeled-data",11),s.Uc(17,Ec,3,4,"vdr-labeled-data",11),s.Uc(18,Yc,3,4,"vdr-labeled-data",11),s.hc(),s.Uc(19,$c,4,3,"div",7),s.fc()),2&e){var c=t.$implicit,n=s.rc();s.Rb(3),s.Zc(" ",s.tc(4,11,"order.refund")," #",c.id," "),s.Rb(3),s.yc("state",c.state),s.Rb(2),s.yc("label",s.tc(9,13,"common.created-at")),s.Rb(2),s.Yc(" ",s.uc(11,15,c.createdAt,"medium")," "),s.Rb(2),s.yc("label",s.tc(13,18,"order.refund-total")),s.Rb(2),s.Yc(" ",s.uc(15,20,c.total,n.currencyCode)," "),s.Rb(2),s.yc("ngIf",c.transactionId),s.Rb(1),s.yc("ngIf",c.reason),s.Rb(1),s.yc("ngIf",n.refundHasMetadata(c)),s.Rb(1),s.yc("ngIf","Pending"===c.state)}}function qc(e,t){if(1&e){var c=s.jc();s.ic(0,"div",13),s.ic(1,"button",14),s.pc("click",(function(){s.Lc(c);var e=s.rc();return e.settlePayment.emit(e.payment)})),s.Wc(2),s.sc(3,"translate"),s.hc(),s.hc()}2&e&&(s.Rb(2),s.Yc(" ",s.tc(3,1,"order.settle-payment")," "))}function Vc(e,t){if(1&e&&(s.ic(0,"div",3),s.dc(1,"div",4),s.dc(2,"clr-icon",5),s.ic(3,"div",6),s.Wc(4),s.sc(5,"translate"),s.sc(6,"stateI18nToken"),s.hc(),s.hc()),2&e){var c=s.rc();s.Rb(4),s.Yc(" ",s.tc(5,1,s.tc(6,3,c.cancelledState))," ")}}function Qc(e,t){if(1&e){var c=s.jc();s.gc(0),s.ic(1,"vdr-order-process-node",1),s.pc("mouseenter",(function(){s.Lc(c);var e=t.$implicit;return s.rc().onMouseOver(e.name)}))("mouseleave",(function(){return s.Lc(c),s.rc().onMouseOut()})),s.sc(2,"async"),s.hc(),s.fc()}if(2&e){var n=t.$implicit,r=t.index,i=s.rc();s.Rb(1),s.yc("node",n)("index",r)("active",s.tc(2,3,i.activeState$)===n.name)}}function Hc(e,t){if(1&e&&(s.gc(0),s.dc(1,"vdr-order-process-edge",2),s.fc()),2&e){var c=t.$implicit;s.Rb(1),s.yc("from",c.from)("to",c.to)("index",c.index)}}function Bc(e,t){if(1&e){var c=s.jc();s.gc(0),s.ic(1,"th",12),s.ic(2,"button",13),s.pc("click",(function(){return s.Lc(c),s.rc().toggleOrderLineCustomFields()})),s.sc(3,"translate"),s.Wc(4),s.sc(5,"customFieldLabel"),s.hc(),s.hc(),s.fc()}if(2&e){var n=t.$implicit;s.Rb(2),s.yc("title",s.tc(3,2,"common.hide-custom-fields")),s.Rb(2),s.Yc(" ",s.tc(5,4,n)," ")}}function Gc(e,t){if(1&e){var c=s.jc();s.gc(0),s.ic(1,"th"),s.ic(2,"button",13),s.pc("click",(function(){return s.Lc(c),s.rc().toggleOrderLineCustomFields()})),s.sc(3,"translate"),s.dc(4,"clr-icon",14),s.hc(),s.hc(),s.fc()}2&e&&(s.Rb(2),s.yc("title",s.tc(3,1,"common.display-custom-fields")))}function zc(e,t){if(1&e&&(s.dc(0,"img",25),s.sc(1,"assetPreview")),2&e){var c=s.rc().$implicit;s.yc("src",s.uc(1,1,c.featuredAsset,"tiny"),s.Nc)}}function Zc(e,t){if(1&e&&(s.ic(0,"span",30),s.Wc(1),s.sc(2,"localeDate"),s.hc()),2&e){var c=s.rc().$implicit,n=s.rc().$implicit;s.yc("title",n.customFields[c.name]),s.Rb(1),s.Xc(s.uc(2,2,n.customFields[c.name],"short"))}}function Jc(e,t){1&e&&s.dc(0,"clr-icon",32)}function Kc(e,t){1&e&&s.dc(0,"clr-icon",33)}function en(e,t){if(1&e&&(s.Uc(0,Jc,1,0,"ng-template",31),s.Uc(1,Kc,1,0,"ng-template",31)),2&e){var c=s.rc().$implicit,n=s.rc().$implicit;s.yc("ngIf",!0===n.customFields[c.name]),s.Rb(1),s.yc("ngIf",!1===n.customFields[c.name])}}function tn(e,t){if(1&e&&s.Wc(0),2&e){var c=s.rc().$implicit,n=s.rc().$implicit;s.Yc(" ",n.customFields[c.name]," ")}}function cn(e,t){if(1&e&&(s.gc(0),s.ic(1,"td",26),s.gc(2,27),s.Uc(3,Zc,3,5,"ng-template",28),s.Uc(4,en,2,2,"ng-template",28),s.Uc(5,tn,1,1,"ng-template",29),s.fc(),s.hc(),s.fc()),2&e){var c=t.$implicit;s.Rb(2),s.yc("ngSwitch",c.type),s.Rb(1),s.yc("ngSwitchCase","datetime"),s.Rb(1),s.yc("ngSwitchCase","boolean")}}function nn(e,t){1&e&&(s.gc(0),s.ic(1,"td",26),s.dc(2,"clr-icon",14),s.hc(),s.fc())}function rn(e,t){if(1&e&&(s.ic(0,"div",36),s.ic(1,"a",37),s.Wc(2),s.hc(),s.ic(3,"div",38),s.Wc(4),s.sc(5,"localeCurrency"),s.hc(),s.hc()),2&e){var c=t.$implicit,n=s.rc(4);s.Rb(1),s.yc("routerLink",n.getPromotionLink(c)),s.Rb(1),s.Xc(c.description),s.Rb(2),s.Yc(" ",s.uc(5,3,c.amount,n.order.currencyCode)," ")}}function on(e,t){if(1&e&&(s.ic(0,"vdr-dropdown"),s.ic(1,"div",34),s.Wc(2),s.sc(3,"translate"),s.hc(),s.ic(4,"vdr-dropdown-menu"),s.Uc(5,rn,6,6,"div",35),s.hc(),s.hc()),2&e){var c=s.rc().ngIf;s.Rb(2),s.Yc(" ",s.tc(3,2,"order.promotions-applied")," "),s.Rb(3),s.yc("ngForOf",c)}}function an(e,t){if(1&e&&(s.gc(0),s.Uc(1,on,6,4,"vdr-dropdown",2),s.fc()),2&e){var c=t.ngIf;s.Rb(1),s.yc("ngIf",c.length)}}function ln(e,t){if(1&e&&(s.ic(0,"tr",15),s.ic(1,"td",16),s.Uc(2,zc,2,4,"img",17),s.hc(),s.ic(3,"td",18),s.Wc(4),s.hc(),s.ic(5,"td",19),s.Wc(6),s.hc(),s.ic(7,"td",20),s.Wc(8),s.sc(9,"localeCurrency"),s.ic(10,"div",9),s.sc(11,"translate"),s.Wc(12),s.sc(13,"localeCurrency"),s.hc(),s.hc(),s.ic(14,"td",21),s.Wc(15),s.dc(16,"vdr-line-refunds",22),s.dc(17,"vdr-line-fulfillment",23),s.hc(),s.Uc(18,cn,6,3,"ng-container",1),s.Uc(19,nn,3,0,"ng-container",2),s.ic(20,"td",24),s.Wc(21),s.sc(22,"localeCurrency"),s.ic(23,"div",9),s.sc(24,"translate"),s.Wc(25),s.sc(26,"localeCurrency"),s.hc(),s.Uc(27,an,2,1,"ng-container",2),s.hc(),s.hc()),2&e){var c=t.$implicit,n=s.rc();s.Ub("is-cancelled",0===c.quantity),s.Rb(2),s.yc("ngIf",c.featuredAsset),s.Rb(2),s.Xc(c.productVariant.name),s.Rb(2),s.Xc(c.productVariant.sku),s.Rb(2),s.Yc(" ",s.uc(9,18,c.unitPriceWithTax,n.order.currencyCode)," "),s.Rb(2),s.yc("title",s.tc(11,21,"order.net-price")),s.Rb(2),s.Yc(" ",s.uc(13,23,c.unitPrice,n.order.currencyCode)," "),s.Rb(3),s.Yc(" ",c.quantity," "),s.Rb(1),s.yc("line",c),s.Rb(1),s.yc("line",c)("orderState",n.order.state),s.Rb(1),s.yc("ngForOf",n.visibleOrderLineCustomFields),s.Rb(1),s.yc("ngIf",n.showElided),s.Rb(2),s.Yc(" ",s.uc(22,26,c.linePriceWithTax,n.order.currencyCode)," "),s.Rb(2),s.yc("title",s.tc(24,29,"order.net-price")),s.Rb(2),s.Yc(" ",s.uc(26,31,c.linePrice,n.order.currencyCode)," "),s.Rb(2),s.yc("ngIf",n.getLineDiscounts(c))}}function dn(e,t){1&e&&(s.gc(0),s.dc(1,"td"),s.fc())}function sn(e,t){if(1&e&&(s.ic(0,"tr",39),s.ic(1,"td",40),s.Wc(2),s.hc(),s.ic(3,"td",19),s.Wc(4),s.hc(),s.dc(5,"td",41),s.dc(6,"td"),s.Uc(7,dn,2,0,"ng-container",2),s.ic(8,"td",24),s.Wc(9),s.sc(10,"localeCurrency"),s.ic(11,"div",9),s.sc(12,"translate"),s.Wc(13),s.sc(14,"localeCurrency"),s.hc(),s.hc(),s.hc()),2&e){var c=t.$implicit,n=s.rc();s.Rb(2),s.Xc(c.description),s.Rb(2),s.Xc(c.sku),s.Rb(2),s.Sb("colspan",1+n.visibleOrderLineCustomFields.length),s.Rb(1),s.yc("ngIf",n.showElided),s.Rb(2),s.Yc(" ",s.uc(10,7,c.priceWithTax,n.order.currencyCode)," "),s.Rb(2),s.yc("title",s.tc(12,10,"order.net-price")),s.Rb(2),s.Yc(" ",s.uc(14,12,c.price,n.order.currencyCode)," ")}}function un(e,t){if(1&e&&(s.ic(0,"vdr-chip"),s.Wc(1),s.hc()),2&e){var c=t.ngIf;s.Rb(1),s.Xc(c)}}function fn(e,t){1&e&&(s.gc(0),s.dc(1,"td"),s.fc())}function pn(e,t){if(1&e&&(s.ic(0,"tr",42),s.ic(1,"td",7),s.ic(2,"a",43),s.Wc(3),s.hc(),s.Uc(4,un,2,1,"vdr-chip",2),s.hc(),s.Uc(5,fn,2,0,"ng-container",2),s.ic(6,"td",8),s.Wc(7),s.sc(8,"localeCurrency"),s.hc(),s.hc()),2&e){var c=t.$implicit,n=s.rc();s.Rb(1),s.Sb("colspan",5+n.visibleOrderLineCustomFields.length),s.Rb(1),s.yc("routerLink",n.getPromotionLink(c)),s.Rb(1),s.Xc(c.description),s.Rb(1),s.yc("ngIf",n.getCouponCodeForAdjustment(n.order,c)),s.Rb(1),s.yc("ngIf",n.showElided),s.Rb(2),s.Yc(" ",s.uc(8,6,c.amount,n.order.currencyCode)," ")}}function mn(e,t){1&e&&(s.gc(0),s.dc(1,"td"),s.fc())}function hn(e,t){1&e&&(s.gc(0),s.dc(1,"td"),s.fc())}function bn(e,t){1&e&&(s.gc(0),s.dc(1,"td"),s.fc())}function gn(e,t){1&e&&s.dc(0,"clr-icon",2)}function yn(e,t){1&e&&s.dc(0,"clr-icon",2)}function vn(e,t){if(1&e&&(s.ic(0,"li",2),s.ic(1,"div",3),s.Wc(2),s.hc(),s.dc(3,"clr-icon",4),s.Wc(4),s.hc()),2&e){var c=t.$implicit;s.yc("title",c.name),s.Rb(2),s.Xc(c.quantity),s.Rb(2),s.Yc(" ",c.name," ")}}var Cn=function(){function e(t){p(this,e),this.dataService=t,this.form=new m.i({method:new m.f("",m.C.required),transactionId:new m.f("",m.C.required)})}return h(e,[{key:"ngOnInit",value:function(){this.paymentMethods$=this.dataService.settings.getPaymentMethods(999).mapSingle((function(e){return e.paymentMethods.items}))}},{key:"submit",value:function(){var e=this.form.value;this.resolveWith({method:e.method,transactionId:e.transactionId})}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();Cn.\u0275fac=function(e){return new(e||Cn)(s.cc(b.L))},Cn.\u0275cmp=s.Wb({type:Cn,selectors:[["vdr-add-manual-payment-dialog"]],decls:10,vars:11,consts:[["vdrDialogTitle",""],[3,"formGroup"],["for","method",3,"label"],["bindLabel","code","autofocus","","bindValue","code","formControlName","method",3,"items","addTag"],["for","transactionId",3,"label"],["id","transactionId","type","text","formControlName","transactionId"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(s.Uc(0,V,2,3,"ng-template",0),s.ic(1,"form",1),s.ic(2,"vdr-form-field",2),s.sc(3,"translate"),s.dc(4,"ng-select",3),s.sc(5,"async"),s.hc(),s.ic(6,"vdr-form-field",4),s.sc(7,"translate"),s.dc(8,"input",5),s.hc(),s.hc(),s.Uc(9,Q,7,11,"ng-template",6)),2&e&&(s.Rb(1),s.yc("formGroup",t.form),s.Rb(1),s.yc("label",s.tc(3,5,"order.payment-method")),s.Rb(2),s.yc("items",s.tc(5,7,t.paymentMethods$))("addTag",!0),s.Rb(2),s.yc("label",s.tc(7,9,"order.transaction-id")))},directives:[b.R,m.E,m.q,m.j,b.eb,E.a,m.p,m.h,b.fb,m.b,b.Q],pipes:[Y.d,$.b,b.Ab],styles:[".ng-select[_ngcontent-%COMP%]{min-width:100%}"],changeDetection:0}),Cn.ctorParameters=function(){return[{type:b.L}]};var Rn=function(){function e(t){var c=this;p(this,e),this.i18nService=t,this.lineQuantities={},this.reasons=[Object(g.a)("order.cancel-reason-customer-request"),Object(g.a)("order.cancel-reason-not-available")],this.reasons=this.reasons.map((function(e){return c.i18nService.translate(e)}))}return h(e,[{key:"ngOnInit",value:function(){this.lineQuantities=this.order.lines.reduce((function(e,t){return Object.assign(Object.assign({},e),i({},t.id,0))}),{})}},{key:"select",value:function(){this.resolveWith({orderId:this.order.id,lines:this.getLineInputs(),reason:this.reason})}},{key:"cancel",value:function(){this.resolveWith()}},{key:"getLineInputs",value:function(){if(!this.order.active)return Object.entries(this.lineQuantities).map((function(e){var t=c(e,2);return{orderLineId:t[0],quantity:t[1]}})).filter((function(e){return 0<e.quantity}))}},{key:"selectionCount",get:function(){return Object.values(this.lineQuantities).reduce((function(e,t){return e+t}),0)}}]),e}();Rn.\u0275fac=function(e){return new(e||Rn)(s.cc(b.ob))},Rn.\u0275cmp=s.Wb({type:Rn,selectors:[["vdr-cancel-order-dialog"]],decls:29,vars:22,consts:[["vdrDialogTitle",""],[1,"fulfillment-wrapper"],[1,"order-lines"],[1,"table"],["class","order-line",3,"is-cancelled",4,"ngFor","ngForOf"],[1,"cancellation-details"],[1,"clr-control-label"],["bindLabel","name","autofocus","","bindValue","id",3,"items","addTag","ngModel","ngModelChange"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[1,"align-middle","fulfil"],["type","number","min","0",3,"ngModel","max","ngModelChange",4,"ngIf","ngIfElse"],["nonEditable",""],["type","number","min","0",3,"ngModel","max","ngModelChange"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf"]],template:function(e,t){1&e&&(s.Uc(0,H,2,3,"ng-template",0),s.ic(1,"div",1),s.ic(2,"div",2),s.ic(3,"table",3),s.ic(4,"thead"),s.ic(5,"tr"),s.dc(6,"th"),s.ic(7,"th"),s.Wc(8),s.sc(9,"translate"),s.hc(),s.ic(10,"th"),s.Wc(11),s.sc(12,"translate"),s.hc(),s.ic(13,"th"),s.Wc(14),s.sc(15,"translate"),s.hc(),s.ic(16,"th"),s.Wc(17),s.sc(18,"translate"),s.hc(),s.ic(19,"th"),s.Wc(20),s.sc(21,"translate"),s.hc(),s.hc(),s.hc(),s.Uc(22,z,17,15,"tr",4),s.hc(),s.hc(),s.ic(23,"div",5),s.ic(24,"label",6),s.Wc(25),s.sc(26,"translate"),s.hc(),s.ic(27,"ng-select",7),s.pc("ngModelChange",(function(e){return t.reason=e})),s.hc(),s.hc(),s.hc(),s.Uc(28,K,6,6,"ng-template",8)),2&e&&(s.Rb(8),s.Xc(s.tc(9,10,"order.product-name")),s.Rb(3),s.Xc(s.tc(12,12,"order.product-sku")),s.Rb(3),s.Xc(s.tc(15,14,"order.quantity")),s.Rb(3),s.Xc(s.tc(18,16,"order.unit-price")),s.Rb(3),s.Xc(s.tc(21,18,"order.cancel")),s.Rb(2),s.yc("ngForOf",t.order.lines),s.Rb(3),s.Xc(s.tc(26,20,"order.cancellation-reason")),s.Rb(2),s.yc("items",t.reasons)("addTag",!0)("ngModel",t.reason))},directives:[b.R,$.n,X.u,E.a,m.p,m.s,b.Q,$.o,b.fb,m.v,m.b],pipes:[Y.d,b.r,b.Ab],styles:["[_nghost-%COMP%]{display:flex;height:100%;min-height:64vh}.fulfillment-wrapper[_ngcontent-%COMP%]{flex:1}@media screen and (min-width:768px){.fulfillment-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}}@media screen and (min-width:768px){.fulfillment-wrapper[_ngcontent-%COMP%]   .cancellation-details[_ngcontent-%COMP%]{margin-left:24px;margin-top:0;width:250px}}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-lines[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-lines[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.fulfillment-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}.fulfillment-wrapper[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200);text-decoration:line-through}"],changeDetection:0}),Rn.ctorParameters=function(){return[{type:b.ob}]};var On=function(){function e(t,c){p(this,e),this.dataService=t,this.changeDetector=c,this.fulfillmentHandlerControl=new m.f,this.fulfillmentQuantities={}}return h(e,[{key:"ngOnInit",value:function(){var e=this;this.dataService.settings.getGlobalSettings().single$.subscribe((function(t){var c=t.globalSettings;e.fulfillmentQuantities=e.order.lines.reduce((function(t,n){var r=e.getFulfillableCount(n,c.trackInventory);return Object.assign(Object.assign({},t),i({},n.id,{fulfillCount:r,max:r}))}),{}),e.changeDetector.markForCheck()})),this.dataService.shippingMethod.getShippingMethodOperations().mapSingle((function(e){return e.fulfillmentHandlers})).subscribe((function(t){e.fulfillmentHandlerDef=t.find((function(t){var c,n;return t.code===(null===(n=null===(c=e.order.shippingLines[0])||void 0===c?void 0:c.shippingMethod)||void 0===n?void 0:n.fulfillmentHandlerCode)}))||t[0],e.fulfillmentHandler=Object(b.Xb)(e.fulfillmentHandlerDef),e.fulfillmentHandlerControl.patchValue(e.fulfillmentHandler),e.changeDetector.markForCheck()}))}},{key:"getFulfillableCount",value:function(e,t){var c=e.productVariant,n=c.trackInventory,r=c.stockOnHand,i=n===b.ib.INHERIT?t:n===b.ib.TRUE,o=this.getUnfulfilledCount(e);return i?Math.min(o,r):o}},{key:"getUnfulfilledCount",value:function(e){var t=e.items.reduce((function(e,t){return e+(t.fulfillment?1:0)}),0);return e.quantity-t}},{key:"canSubmit",value:function(){var e,t=Object.values(this.fulfillmentQuantities).reduce((function(e,t){return e+t.fulfillCount}),0);return(0===(null===(e=this.fulfillmentHandlerDef)||void 0===e?void 0:e.args.length)||this.fulfillmentHandlerControl.valid&&this.fulfillmentHandlerControl.touched)&&0<t}},{key:"select",value:function(){var e=Object.entries(this.fulfillmentQuantities).map((function(e){var t=c(e,2);return{orderLineId:t[0],quantity:t[1].fulfillCount}}));this.resolveWith({lines:e,handler:Object(b.jc)(this.fulfillmentHandler,this.fulfillmentHandlerControl.value)})}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();On.\u0275fac=function(e){return new(e||On)(s.cc(b.L),s.cc(s.k))},On.\u0275cmp=s.Wb({type:On,selectors:[["vdr-fulfill-order-dialog"]],decls:34,vars:29,consts:[["vdrDialogTitle",""],[1,"fulfillment-wrapper"],[1,"order-table"],[1,"table"],["class","order-line",3,"ignore",4,"ngFor","ngForOf"],[1,"shipping-details"],[3,"address"],[3,"operationDefinition","operation","formControl","removable"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[1,"align-middle","fulfil"],["type","number","min","0",3,"disabled","ngModel","max","ngModelChange",4,"ngIf"],[3,"src"],["type","number","min","0",3,"disabled","ngModel","max","ngModelChange"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(s.Uc(0,ee,2,3,"ng-template",0),s.ic(1,"div",1),s.ic(2,"div",2),s.ic(3,"table",3),s.ic(4,"thead"),s.ic(5,"tr"),s.dc(6,"th"),s.ic(7,"th"),s.Wc(8),s.sc(9,"translate"),s.hc(),s.ic(10,"th"),s.Wc(11),s.sc(12,"translate"),s.hc(),s.ic(13,"th"),s.Wc(14),s.sc(15,"translate"),s.hc(),s.ic(16,"th"),s.Wc(17),s.sc(18,"translate"),s.hc(),s.ic(19,"th"),s.Wc(20),s.sc(21,"translate"),s.hc(),s.hc(),s.hc(),s.Uc(22,ne,13,8,"tr",4),s.hc(),s.hc(),s.ic(23,"div",5),s.dc(24,"vdr-formatted-address",6),s.ic(25,"h6"),s.Wc(26),s.sc(27,"translate"),s.hc(),s.Wc(28),s.ic(29,"strong"),s.Wc(30),s.sc(31,"localeCurrency"),s.hc(),s.dc(32,"vdr-configurable-input",7),s.hc(),s.hc(),s.Uc(33,re,6,7,"ng-template",8)),2&e&&(s.Rb(8),s.Xc(s.tc(9,14,"order.product-name")),s.Rb(3),s.Xc(s.tc(12,16,"order.product-sku")),s.Rb(3),s.Xc(s.tc(15,18,"order.unfulfilled")),s.Rb(3),s.Xc(s.tc(18,20,"catalog.stock-on-hand")),s.Rb(3),s.Xc(s.tc(21,22,"order.fulfill")),s.Rb(2),s.yc("ngForOf",t.order.lines),s.Rb(2),s.yc("address",t.order.shippingAddress),s.Rb(2),s.Xc(s.tc(27,24,"order.shipping-method")),s.Rb(2),s.Yc(" ",null==t.order.shippingLines[0]||null==t.order.shippingLines[0].shippingMethod?null:t.order.shippingLines[0].shippingMethod.name," "),s.Rb(2),s.Xc(s.uc(31,26,t.order.shipping,t.order.currencyCode)),s.Rb(2),s.yc("operationDefinition",t.fulfillmentHandlerDef)("operation",t.fulfillmentHandler)("formControl",t.fulfillmentHandlerControl)("removable",!1))},directives:[b.R,$.n,b.hb,b.D,m.p,m.g,b.Q,$.o,b.fb,m.v,m.b,m.s],pipes:[Y.d,b.Ab,b.r],styles:["[_nghost-%COMP%]{display:flex;height:100%;min-height:64vh}.fulfillment-wrapper[_ngcontent-%COMP%]{flex:1}@media screen and (min-width:768px){.fulfillment-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}}.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]{margin-top:24px}@media screen and (min-width:768px){.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]{margin-left:24px;margin-top:0;width:250px}}.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]   clr-input-container[_ngcontent-%COMP%]{margin-top:24px}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.fulfillment-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}"],changeDetection:0}),On.ctorParameters=function(){return[{type:b.L},{type:s.k}]};var In=function(){function e(){p(this,e),this.transitionState=new s.u}return h(e,[{key:"nextSuggestedState",value:function(){var e;if(this.fulfillment){var t=this.fulfillment.nextStates,c=function(e){return t.includes(e)?e:t[0]};switch(null===(e=this.fulfillment)||void 0===e?void 0:e.state){case"Pending":return c("Shipped");case"Shipped":return c("Delivered");default:return t.find((function(e){return"Cancelled"!==e}))}}}},{key:"nextOtherStates",value:function(){if(!this.fulfillment)return[];var e=this.nextSuggestedState();return this.fulfillment.nextStates.filter((function(t){return t!==e}))}}]),e}();In.\u0275fac=function(e){return new(e||In)},In.\u0275cmp=s.Wb({type:In,selectors:[["vdr-fulfillment-card"]],inputs:{fulfillment:"fulfillment",order:"order"},outputs:{transitionState:"transitionState"},decls:16,vars:7,consts:[[1,"card"],[1,"card-header","fulfillment-header"],[1,"fulfillment-state"],[3,"state"],[1,"card-block"],[3,"fulfillmentId","order",4,"ngIf"],[1,"card-footer"],[4,"ngIf"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],[4,"ngFor","ngForOf"],[3,"fulfillmentId","order"],[1,"btn","btn-sm","btn-primary",3,"click"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],[4,"ngIf","ngIfElse"],["cancel",""],["shape","step-forward-2"],["shape","error-standard",1,"is-error"]],template:function(e,t){1&e&&(s.ic(0,"div",0),s.ic(1,"div",1),s.ic(2,"div"),s.Wc(3),s.sc(4,"translate"),s.hc(),s.ic(5,"div",2),s.dc(6,"vdr-fulfillment-state-label",3),s.hc(),s.hc(),s.ic(7,"div",4),s.Uc(8,ie,1,2,"vdr-fulfillment-detail",5),s.hc(),s.ic(9,"div",6),s.Uc(10,ae,6,10,"ng-container",7),s.ic(11,"vdr-dropdown"),s.ic(12,"button",8),s.dc(13,"clr-icon",9),s.hc(),s.ic(14,"vdr-dropdown-menu",10),s.Uc(15,se,5,2,"ng-container",11),s.hc(),s.hc(),s.hc(),s.hc()),2&e&&(s.Rb(3),s.Xc(s.tc(4,5,"order.fulfillment")),s.Rb(3),s.yc("state",null==t.fulfillment?null:t.fulfillment.state),s.Rb(2),s.yc("ngIf",!!t.fulfillment),s.Rb(2),s.yc("ngIf",t.nextSuggestedState()),s.Rb(5),s.yc("ngForOf",t.nextOtherStates()))},directives:function(){return[Pn,$.o,b.T,b.W,X.o,b.V,$.n,Sn,b.U]},pipes:function(){return[Y.d,b.Qb]},styles:[".fulfillment-header[_ngcontent-%COMP%]{align-items:center;display:flex;justify-content:space-between}.card-footer[_ngcontent-%COMP%]{align-items:center;display:flex;justify-content:flex-end}"],changeDetection:0}),In.propDecorators={fulfillment:[{type:s.D}],order:[{type:s.D}],transitionState:[{type:s.O}]};var Sn=function(){function e(){p(this,e)}return h(e,[{key:"getCustomFields",value:function(){var e=this.fulfillment.customFields;return e?Object.entries(e).filter((function(e){return"__typename"!==c(e,1)[0]})).map((function(e){var t,n,r=c(e,2);return{key:r[0],value:null!==(n=null===(t=r[1])||void 0===t?void 0:t.toString())&&void 0!==n?n:"-"}})):[]}},{key:"fulfillment",get:function(){var e=this;return this.order.fulfillments&&this.order.fulfillments.find((function(t){return t.id===e.fulfillmentId}))}},{key:"items",get:function(){var e,n,r=new Map,i=null===(e=this.fulfillment)||void 0===e?void 0:e.orderItems.map((function(e){return e.id})),o=t(this.order.lines);try{for(o.s();!(n=o.n()).done;){var a,l=n.value,d=t(l.items);try{for(d.s();!(a=d.n()).done;){var s=a.value;if(null==i?void 0:i.includes(s.id)){var u=r.get(l.productVariant.name);null!=u?r.set(l.productVariant.name,u+1):r.set(l.productVariant.name,1)}}}catch(f){d.e(f)}finally{d.f()}}}catch(f){o.e(f)}finally{o.f()}return Array.from(r.entries()).map((function(e){var t=c(e,2);return{name:t[0],quantity:t[1]}}))}}]),e}();Sn.\u0275fac=function(e){return new(e||Sn)},Sn.\u0275cmp=s.Wb({type:Sn,selectors:[["vdr-fulfillment-detail"]],inputs:{fulfillmentId:"fulfillmentId",order:"order"},decls:12,vars:17,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"items"],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&(s.ic(0,"vdr-labeled-data",0),s.sc(1,"translate"),s.Wc(2),s.sc(3,"localeDate"),s.hc(),s.ic(4,"vdr-labeled-data",0),s.sc(5,"translate"),s.Wc(6),s.hc(),s.Uc(7,ue,3,4,"vdr-labeled-data",1),s.ic(8,"vdr-labeled-data",0),s.sc(9,"translate"),s.dc(10,"vdr-simple-item-list",2),s.hc(),s.Uc(11,fe,3,2,"ng-container",3)),2&e&&(s.yc("label",s.tc(1,8,"common.created-at")),s.Rb(2),s.Yc(" ",s.uc(3,10,null==t.fulfillment?null:t.fulfillment.createdAt,"medium"),"\n"),s.Rb(2),s.yc("label",s.tc(5,13,"order.fulfillment-method")),s.Rb(2),s.Yc(" ",null==t.fulfillment?null:t.fulfillment.method,"\n"),s.Rb(1),s.yc("ngIf",null==t.fulfillment?null:t.fulfillment.trackingCode),s.Rb(1),s.yc("label",s.tc(9,15,"order.contents")),s.Rb(2),s.yc("items",t.items),s.Rb(1),s.yc("ngForOf",t.getCustomFields()))},directives:function(){return[b.vb,$.o,zn,$.n]},pipes:function(){return[Y.d,b.Bb]},styles:[""],changeDetection:0}),Sn.propDecorators={fulfillmentId:[{type:s.D}],order:[{type:s.D}]};var Pn=function(){function e(){p(this,e)}return h(e,[{key:"chipColorType",get:function(){switch(this.state){case"Pending":case"Shipped":return"warning";case"Delivered":return"success";case"Cancelled":return"error"}}}]),e}();Pn.\u0275fac=function(e){return new(e||Pn)},Pn.\u0275cmp=s.Wb({type:Pn,selectors:[["vdr-fulfillment-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(e,t){1&e&&(s.ic(0,"vdr-chip",0),s.sc(1,"translate"),s.Uc(2,pe,1,0,"clr-icon",1),s.Wc(3),s.sc(4,"translate"),s.sc(5,"stateI18nToken"),s.hc()),2&e&&(s.yc("title",s.tc(1,4,"order.payment-state"))("colorType",t.chipColorType),s.Rb(2),s.yc("ngIf","Delivered"===t.state),s.Rb(1),s.Yc(" ",s.tc(4,6,s.tc(5,8,t.state)),"\n"))},directives:[b.C,$.o,X.o],pipes:[Y.d,b.Qb],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0}),Pn.propDecorators={state:[{type:s.D}]};var kn=function(){function n(){p(this,n),this.fulfilledCount=0,this.fulfillments=[]}return h(n,[{key:"ngOnChanges",value:function(e){this.line&&(this.fulfilledCount=this.getDeliveredCount(this.line),this.fulfillmentStatus=this.getFulfillmentStatus(this.fulfilledCount,this.line.items.length),this.fulfillments=this.getFulfillments(this.line))}},{key:"getDeliveredCount",value:function(e){return e.items.reduce((function(e,t){return e+(t.fulfillment?1:0)}),0)}},{key:"getFulfillmentStatus",value:function(e,t){return e===t?"full":0<e&&e<t?"partial":"none"}},{key:"getFulfillments",value:function(n){var r,i={},o=t(n.items);try{for(o.s();!(r=o.n()).done;){var a=r.value;a.fulfillment&&(void 0===i[a.fulfillment.id]?i[a.fulfillment.id]=1:i[a.fulfillment.id]++)}}catch(d){o.e(d)}finally{o.f()}var l=n.items.reduce((function(t,c){return c.fulfillment?[].concat(e(t),[c.fulfillment]):t}),[]);return Object.entries(i).map((function(e){var t=c(e,2),n=t[0];return{count:t[1],fulfillment:l.find((function(e){return e.id===n}))}}))}}]),n}();kn.\u0275fac=function(e){return new(e||kn)},kn.\u0275cmp=s.Wb({type:kn,selectors:[["vdr-line-fulfillment"]],inputs:{line:"line",orderState:"orderState"},features:[s.Pb],decls:1,vars:1,consts:[["class","search-settings-menu",4,"ngIf"],[1,"search-settings-menu"],["type","button","vdrDropdownTrigger","",1,"icon-button"],["class","item-fulfilled","shape","check-circle",4,"ngIf"],["class","item-partially-fulfilled","shape","check-circle",4,"ngIf"],["class","item-not-fulfilled","shape","exclamation-circle",4,"ngIf"],["vdrPosition","bottom-right"],["class","dropdown-header",4,"ngIf"],["class","fulfillment-detail",4,"ngFor","ngForOf"],["shape","check-circle",1,"item-fulfilled"],["shape","check-circle",1,"item-partially-fulfilled"],["shape","exclamation-circle",1,"item-not-fulfilled"],[1,"dropdown-header"],[1,"fulfillment-detail"],[1,"fulfillment-title"],[3,"label"],[3,"label",4,"ngIf"]],template:function(e,t){1&e&&s.Uc(0,Se,10,7,"vdr-dropdown",0),2&e&&s.yc("ngIf",t.fulfilledCount||"PartiallyDelivered"===t.orderState)},directives:[$.o,b.T,b.W,b.V,$.n,X.o,X.u,b.vb],pipes:[Y.d,b.Bb],styles:[".item-fulfilled[_ngcontent-%COMP%]{color:var(--color-success-500)}.item-partially-fulfilled[_ngcontent-%COMP%]{color:var(--color-warning-500)}.item-not-fulfilled[_ngcontent-%COMP%]{color:var(--color-error-500)}.fulfillment-detail[_ngcontent-%COMP%]{margin:6px 12px}.fulfillment-detail[_ngcontent-%COMP%]:not(:last-of-type){border-bottom:1px dashed var(--color-component-border-200)}"],changeDetection:0}),kn.propDecorators={line:[{type:s.D}],orderState:[{type:s.D}]};var Mn=function(){function e(){p(this,e)}return h(e,[{key:"getRefundedCount",value:function(){return this.line.items.filter((function(e){return null!=e.refundId&&!e.cancelled})).length}}]),e}();Mn.\u0275fac=function(e){return new(e||Mn)},Mn.\u0275cmp=s.Wb({type:Mn,selectors:[["vdr-line-refunds"]],inputs:{line:"line"},decls:1,vars:1,consts:[[3,"title",4,"ngIf"],[3,"title"],["shape","redo","dir","down",1,"is-solid"]],template:function(e,t){1&e&&s.Uc(0,Pe,3,6,"span",0),2&e&&s.yc("ngIf",t.getRefundedCount())},directives:[$.o,X.o,q.b],pipes:[Y.d],styles:["[_nghost-%COMP%]{color:var(--color-error-500)}"],changeDetection:0}),Mn.propDecorators={line:[{type:s.D}]};var Wn=function(){function n(){p(this,n),this.addedItems=new Map,this.removedItems=new Map}return h(n,[{key:"ngOnChanges",value:function(){var e=this.getModifiedLines(),t=e.added,c=e.removed;this.addedItems=t,this.removedItems=c}},{key:"getSurcharge",value:function(e){return this.order.surcharges.find((function(t){return t.id===e}))}},{key:"getAddedItems",value:function(){return e(this.addedItems.entries()).map((function(e){var t=c(e,2),n=t[0],r=t[1];return{name:n.productVariant.name,quantity:r}}))}},{key:"getRemovedItems",value:function(){return e(this.removedItems.entries()).map((function(e){var t=c(e,2),n=t[0],r=t[1];return{name:n.productVariant.name,quantity:r}}))}},{key:"getModifiedLines",value:function(){var e,c,n,r=new Map,i=new Map,o=t(this.modification.orderItems||[]);try{for(o.s();!(n=o.n()).done;){var a=n.value,l=this.getOrderLineAndItem(a.id);if(l){var d=l.line;if(l.item.cancelled){var s=null!==(e=i.get(d))&&void 0!==e?e:0;i.set(d,s+1)}else{var u=null!==(c=r.get(d))&&void 0!==c?c:0;r.set(d,u+1)}}}}catch(f){o.e(f)}finally{o.f()}return{added:r,removed:i}}},{key:"getOrderLineAndItem",value:function(e){var c,n=t(this.order.lines);try{for(n.s();!(c=n.n()).done;){var r=c.value,i=r.items.find((function(t){return t.id===e}));if(i)return{line:r,item:i}}}catch(o){n.e(o)}finally{n.f()}}}]),n}();Wn.\u0275fac=function(e){return new(e||Wn)},Wn.\u0275cmp=s.Wb({type:Wn,selectors:[["vdr-modification-detail"]],inputs:{order:"order",modification:"modification"},features:[s.Pb],decls:7,vars:8,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"label",4,"ngFor","ngForOf"],[3,"items"]],template:function(e,t){1&e&&(s.ic(0,"vdr-labeled-data",0),s.sc(1,"translate"),s.Wc(2),s.hc(),s.Uc(3,ke,3,4,"vdr-labeled-data",1),s.Uc(4,Me,4,8,"vdr-labeled-data",2),s.Uc(5,We,3,4,"vdr-labeled-data",1),s.Uc(6,Fe,3,4,"vdr-labeled-data",1)),2&e&&(s.yc("label",s.tc(1,6,"common.ID")),s.Rb(2),s.Xc(t.modification.id),s.Rb(1),s.yc("ngIf",t.modification.note),s.Rb(1),s.yc("ngForOf",t.modification.surcharges),s.Rb(1),s.yc("ngIf",t.getAddedItems().length),s.Rb(1),s.yc("ngIf",t.getRemovedItems().length))},directives:function(){return[b.vb,$.o,$.n,zn]},pipes:function(){return[Y.d,b.Ab]},styles:[""],changeDetection:0}),Wn.propDecorators={order:[{type:s.D}],modification:[{type:s.D}]};var Fn=function(){function e(t){p(this,e),this.formBuilder=t,this.customFieldsConfig=[],this.customFieldValues={},this.updateClick=new s.u,this.editable=!1}return h(e,[{key:"ngOnInit",value:function(){this.customFieldForm=this.formBuilder.group({});var e,c=t(this.customFieldsConfig);try{for(c.s();!(e=c.n()).done;){var n=e.value;this.customFieldForm.addControl(n.name,this.formBuilder.control(this.customFieldValues[n.name]))}}catch(r){c.e(r)}finally{c.f()}}},{key:"onUpdateClick",value:function(){this.updateClick.emit(this.customFieldForm.value),this.customFieldForm.markAsPristine(),this.editable=!1}}]),e}();Fn.\u0275fac=function(e){return new(e||Fn)(s.cc(m.e))},Fn.\u0275cmp=s.Wb({type:Fn,selectors:[["vdr-order-custom-fields-card"]],inputs:{customFieldsConfig:"customFieldsConfig",customFieldValues:"customFieldValues"},outputs:{updateClick:"updateClick"},decls:1,vars:1,consts:[["class","card",4,"ngIf"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"card-text","custom-field-form"],[4,"ngFor","ngForOf"],[1,"card-footer"],["class","btn btn-sm btn-secondary",3,"click",4,"ngIf"],["class","btn btn-sm btn-primary",3,"disabled","click",4,"ngIf"],["entityName","Order",3,"customFieldsFormGroup","compact","readonly","customField"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","pencil"],[1,"btn","btn-sm","btn-primary",3,"disabled","click"],["shape","check"]],template:function(e,t){1&e&&s.Uc(0,Te,10,8,"div",0),2&e&&s.yc("ngIf",t.customFieldsConfig.length)},directives:[$.o,$.n,b.H,X.o],pipes:[Y.d],styles:["vdr-custom-field-control[_ngcontent-%COMP%]{display:block;margin-bottom:6px}.custom-field-form[_ngcontent-%COMP%]     .clr-control-label{color:var(--color-grey-400)}.custom-field-form.editable[_ngcontent-%COMP%]     .clr-control-label{color:inherit}"],changeDetection:0}),Fn.ctorParameters=function(){return[{type:m.e}]},Fn.propDecorators={customFieldsConfig:[{type:s.D}],customFieldValues:[{type:s.D}],updateClick:[{type:s.O}]};var xn=function(){function e(){p(this,e),this.nextStates=[],this.message="",this.selectedState=""}return h(e,[{key:"select",value:function(){this.selectedState&&this.resolveWith(this.selectedState)}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();xn.\u0275fac=function(e){return new(e||xn)},xn.\u0275cmp=s.Wb({type:xn,selectors:[["vdr-order-state-select-dialog"]],decls:8,vars:5,consts:[["vdrDialogTitle",""],["clrSelect","","name","state",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["vdrDialogButtons",""],[3,"value"],["type","submit","class","btn btn-secondary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],["type","submit",1,"btn","btn-secondary",3,"click"]],template:function(e,t){1&e&&(s.Uc(0,Le,2,3,"ng-template",0),s.ic(1,"p"),s.Wc(2),s.sc(3,"translate"),s.hc(),s.ic(4,"clr-select-container"),s.ic(5,"select",1),s.pc("ngModelChange",(function(e){return t.selectedState=e})),s.Uc(6,De,4,6,"option",2),s.hc(),s.hc(),s.Uc(7,Ue,4,8,"ng-template",3)),2&e&&(s.Rb(2),s.Xc(s.tc(3,3,t.message)),s.Rb(3),s.yc("ngModel",t.selectedState),s.Rb(1),s.yc("ngForOf",t.nextStates))},directives:[b.R,X.B,b.fb,m.A,X.A,m.p,m.s,$.n,b.Q,m.u,m.D,$.o],pipes:[Y.d,b.Qb],styles:[""],changeDetection:0});var wn=function(){function e(t,c,n,r){p(this,e),this.dataService=t,this.modalService=c,this.notificationService=n,this.i18nService=r}return h(e,[{key:"transitionToPreModifyingState",value:function(e,t){var c=this;return this.getPreModifyingState(e).pipe(Object(P.a)((function(n){var r={orderId:e,nextStates:t,message:c.i18nService.translate(Object(g.a)("order.unable-to-transition-to-state-try-another"),{state:n}),cancellable:!1,retry:10};return n?c.transitionToStateOrThrow(e,n).pipe(Object(k.a)((function(e){return c.manuallyTransitionToState(r)}))):c.manuallyTransitionToState(r)})))}},{key:"manuallyTransitionToState",value:function(e){var t,c=this;return this.modalService.fromComponent(xn,{locals:{nextStates:e.nextStates,cancellable:e.cancellable,message:e.message},closable:!1,size:"md"}).pipe(Object(P.a)((function(t){if(t)return c.transitionToStateOrThrow(e.orderId,t);if(e.cancellable)return C.a;throw new Error("An order state must be selected")})),(t=function(t){return t.pipe(Object(x.a)(2e3),Object(w.a)(e.retry))},function(e){return e.lift(new W(t,e))}))}},{key:"getPreModifyingState",value:function(e){return this.dataService.order.getOrderHistory(e,{filter:{type:{eq:b.nb.ORDER_STATE_TRANSITION}},sort:{createdAt:b.Ob.DESC}}).mapSingle((function(e){return e.order})).pipe(Object(_.a)((function(e){var t=null==e?void 0:e.history.items.find((function(e){return"Modifying"===e.data.to}));return t?t.data.from:void 0})))}},{key:"transitionToStateOrThrow",value:function(e,t){var c=this;return this.dataService.order.transitionToState(e,t).pipe(Object(_.a)((function(e){var t=e.transitionOrderToState;switch(null==t?void 0:t.__typename){case"Order":return null==t?void 0:t.state;case"OrderStateTransitionError":throw c.notificationService.error(null==t?void 0:t.transitionError),new Error(null==t?void 0:t.transitionError)}})))}}]),e}();wn.\u0275fac=function(e){return new(e||wn)(s.mc(b.L),s.mc(b.Db),s.mc(b.Eb),s.mc(b.ob))},wn.\u0275prov=Object(s.Yb)({factory:function(){return new wn(Object(s.mc)(b.L),Object(s.mc)(b.Db),Object(s.mc)(b.Eb),Object(s.mc)(b.ob))},token:wn,providedIn:"root"}),wn.ctorParameters=function(){return[{type:b.L},{type:b.Db},{type:b.Eb},{type:b.ob}]};var _n=function(){function e(t){p(this,e),this.serverConfigService=t,this.states=[]}return h(e,[{key:"ngOnInit",value:function(){this.states=this.serverConfigService.getOrderProcessStates()}}]),e}();_n.\u0275fac=function(e){return new(e||_n)(s.cc(b.Mb))},_n.\u0275cmp=s.Wb({type:_n,selectors:[["vdr-order-process-graph-dialog"]],decls:2,vars:2,consts:[["vdrDialogTitle",""],[3,"states","initialState"]],template:function(e,t){1&e&&(s.Uc(0,Ae,2,3,"ng-template",0),s.dc(1,"vdr-order-process-graph",1)),2&e&&(s.Rb(1),s.yc("states",t.states)("initialState",t.activeState))},directives:function(){return[b.R,Vn]},pipes:function(){return[Y.d]},styles:[""],changeDetection:0}),_n.ctorParameters=function(){return[{type:b.Mb}]};var Tn=function(){function e(t){var c=this;p(this,e),this.i18nService=t,this.lineQuantities={},this.refundShipping=!1,this.adjustment=0,this.reasons=[Object(g.a)("order.refund-reason-customer-request"),Object(g.a)("order.refund-reason-not-available")],this.reasons=this.reasons.map((function(e){return c.i18nService.translate(e)}))}return h(e,[{key:"lineCanBeRefundedOrCancelled",value:function(e){return 0<e.items.filter((function(e){return null==e.refundId&&!e.cancelled})).length}},{key:"ngOnInit",value:function(){this.lineQuantities=this.order.lines.reduce((function(e,t){return Object.assign(Object.assign({},e),i({},t.id,{quantity:0,refund:!1,cancel:!1}))}),{}),this.settledPayments=(this.order.payments||[]).filter((function(e){return"Settled"===e.state})),this.settledPayments.length&&(this.selectedPayment=this.settledPayments[0])}},{key:"handleZeroQuantity",value:function(e){0===(null==e?void 0:e.quantity)&&(e.cancel=!1,e.refund=!1)}},{key:"isRefunding",value:function(){return Object.values(this.lineQuantities).reduce((function(e,t){return e||0<t.quantity&&t.refund}),!1)}},{key:"isCancelling",value:function(){return Object.values(this.lineQuantities).reduce((function(e,t){return e||0<t.quantity&&t.cancel}),!1)}},{key:"canSubmit",value:function(){return this.isRefunding()?!!(this.selectedPayment&&this.reason&&0<this.refundTotal&&this.refundTotal<=this.selectedPayment.amount):!!this.isCancelling()&&!!this.reason}},{key:"select",value:function(){var e=this.selectedPayment;if(e){var t=this.getOrderLineInput((function(e){return e.refund})),c=this.getOrderLineInput((function(e){return e.cancel}));this.resolveWith({refund:{lines:t,reason:this.reason,shipping:this.refundShipping?this.order.shipping:0,adjustment:this.adjustment,paymentId:e.id},cancel:{lines:c,orderId:this.order.id,reason:this.reason}})}}},{key:"cancel",value:function(){this.resolveWith()}},{key:"getOrderLineInput",value:function(e){return Object.entries(this.lineQuantities).filter((function(t){var n=c(t,2),r=(n[0],n[1]);return 0<r.quantity&&e(r)})).map((function(e){var t=c(e,2);return{orderLineId:t[0],quantity:t[1].quantity}}))}},{key:"refundTotal",get:function(){var e=this;return this.order.lines.reduce((function(t,c){var n=e.lineQuantities[c.id],r=n.refund&&n.quantity||0;return t+c.proratedUnitPriceWithTax*r}),0)+(this.refundShipping?this.order.shippingWithTax:0)+this.adjustment}}]),e}();Tn.\u0275fac=function(e){return new(e||Tn)(s.cc(b.ob))},Tn.\u0275cmp=s.Wb({type:Tn,selectors:[["vdr-refund-order-dialog"]],decls:68,vars:73,consts:[["vdrDialogTitle",""],[1,"refund-wrapper"],[1,"order-table"],[1,"table"],["class","order-line",4,"ngFor","ngForOf"],[1,"refund-details","mt4"],[1,"clr-control-label"],["bindLabel","name","autofocus","","bindValue","id",3,"disabled","items","placeholder","addTag","ngModel","ngModelChange"],["clrSelect","","name","options",3,"ngModel","disabled","ngModelChange"],[3,"ngValue","disabled",4,"ngFor","ngForOf"],["type","checkbox","clrCheckbox","",3,"ngModel","disabled","ngModelChange"],["clrInput","",3,"disabled","currencyCode","ngModel","ngModelChange"],[1,"totals"],[1,"order-total"],[1,"refund-total"],["class","refund-total-error",4,"ngIf"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[3,"line"],[1,"prorated-wrapper"],[4,"ngIf"],[1,"align-middle","fulfil"],["type","number","min","0",3,"ngModel","max","ngModelChange","input",4,"ngIf"],[1,"align-middle"],[1,"cancel-checkbox-wrapper"],["type","checkbox","clrCheckbox","",3,"disabled","ngModel","ngModelChange",4,"ngIf"],["vdrDropdownTrigger","",1,"promotions-label"],[1,"icon-button"],["shape","info"],["class","line-promotion",4,"ngFor","ngForOf"],[1,"line-promotion"],[1,"promotion-amount"],["type","number","min","0",3,"ngModel","max","ngModelChange","input"],["type","checkbox","clrCheckbox","",3,"disabled","ngModel","ngModelChange"],[3,"ngValue","disabled"],[1,"refund-total-error"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf","ngIfElse"],["cancelling",""]],template:function(e,t){1&e&&(s.Uc(0,Ne,2,3,"ng-template",0),s.ic(1,"div",1),s.ic(2,"div",2),s.ic(3,"table",3),s.ic(4,"thead"),s.ic(5,"tr"),s.dc(6,"th"),s.ic(7,"th"),s.Wc(8),s.sc(9,"translate"),s.hc(),s.ic(10,"th"),s.Wc(11),s.sc(12,"translate"),s.hc(),s.ic(13,"th"),s.Wc(14),s.sc(15,"translate"),s.hc(),s.ic(16,"th"),s.Wc(17),s.sc(18,"translate"),s.hc(),s.ic(19,"th"),s.Wc(20),s.sc(21,"translate"),s.hc(),s.ic(22,"th"),s.Wc(23),s.sc(24,"translate"),s.hc(),s.ic(25,"th"),s.Wc(26),s.sc(27,"translate"),s.hc(),s.ic(28,"th"),s.Wc(29),s.sc(30,"translate"),s.hc(),s.hc(),s.hc(),s.Uc(31,Qe,27,20,"tr",4),s.hc(),s.hc(),s.ic(32,"div",5),s.ic(33,"div"),s.ic(34,"label",6),s.Wc(35),s.sc(36,"translate"),s.hc(),s.ic(37,"ng-select",7),s.pc("ngModelChange",(function(e){return t.reason=e})),s.sc(38,"translate"),s.hc(),s.hc(),s.ic(39,"div"),s.ic(40,"clr-select-container"),s.ic(41,"label"),s.Wc(42),s.sc(43,"translate"),s.hc(),s.ic(44,"select",8),s.pc("ngModelChange",(function(e){return t.selectedPayment=e})),s.Uc(45,He,3,8,"option",9),s.hc(),s.hc(),s.ic(46,"clr-checkbox-wrapper"),s.ic(47,"input",10),s.pc("ngModelChange",(function(e){return t.refundShipping=e})),s.hc(),s.ic(48,"label"),s.Wc(49),s.sc(50,"translate"),s.sc(51,"localeCurrency"),s.hc(),s.hc(),s.ic(52,"clr-input-container"),s.ic(53,"label"),s.Wc(54),s.sc(55,"translate"),s.hc(),s.ic(56,"vdr-currency-input",11),s.pc("ngModelChange",(function(e){return t.adjustment=e})),s.hc(),s.hc(),s.ic(57,"div",12),s.ic(58,"div",13),s.Wc(59),s.sc(60,"translate"),s.sc(61,"localeCurrency"),s.hc(),s.ic(62,"div",14),s.Wc(63),s.sc(64,"translate"),s.sc(65,"localeCurrency"),s.hc(),s.Uc(66,Ge,5,13,"div",15),s.hc(),s.hc(),s.hc(),s.hc(),s.Uc(67,Ke,7,6,"ng-template",16)),2&e&&(s.Rb(8),s.Xc(s.tc(9,34,"order.product-name")),s.Rb(3),s.Xc(s.tc(12,36,"order.product-sku")),s.Rb(3),s.Xc(s.tc(15,38,"order.quantity")),s.Rb(3),s.Xc(s.tc(18,40,"order.unit-price")),s.Rb(3),s.Xc(s.tc(21,42,"order.prorated-unit-price")),s.Rb(3),s.Xc(s.tc(24,44,"order.quantity")),s.Rb(3),s.Xc(s.tc(27,46,"order.refund")),s.Rb(3),s.Xc(s.tc(30,48,"order.cancel")),s.Rb(2),s.yc("ngForOf",t.order.lines),s.Rb(4),s.Xc(s.tc(36,50,"order.refund-cancellation-reason")),s.Rb(2),s.yc("disabled",!t.isRefunding()&&!t.isCancelling())("items",t.reasons)("placeholder",s.tc(38,52,"order.refund-cancellation-reason-required"))("addTag",!0)("ngModel",t.reason),s.Rb(5),s.Xc(s.tc(43,54,"order.payment-to-refund")),s.Rb(2),s.yc("ngModel",t.selectedPayment)("disabled",!t.isRefunding()),s.Rb(1),s.yc("ngForOf",t.settledPayments),s.Rb(2),s.yc("ngModel",t.refundShipping)("disabled",!t.isRefunding()),s.Rb(2),s.Zc(" ",s.tc(50,56,"order.refund-shipping")," (",s.uc(51,58,t.order.shipping,t.order.currencyCode),") "),s.Rb(5),s.Xc(s.tc(55,61,"order.refund-adjustment")),s.Rb(2),s.yc("disabled",!t.isRefunding())("currencyCode",t.order.currencyCode)("ngModel",t.adjustment),s.Rb(1),s.Ub("disabled",!t.isRefunding()),s.Rb(2),s.Zc(" ",s.tc(60,63,"order.payment-amount"),": ",s.uc(61,65,t.selectedPayment.amount,t.order.currencyCode)," "),s.Rb(4),s.Zc(" ",s.tc(64,68,"order.refund-total"),": ",s.uc(65,70,t.refundTotal,t.order.currencyCode)," "),s.Rb(3),s.yc("ngIf",t.refundTotal<0||t.selectedPayment.amount<t.refundTotal))},directives:[b.R,$.n,X.u,E.a,m.p,m.s,X.B,b.fb,m.A,X.A,X.k,m.a,X.i,X.t,b.G,X.s,$.o,b.Q,Mn,b.T,b.W,X.o,b.V,m.v,m.b,m.u,m.D],pipes:[Y.d,b.Ab,b.r,$.d,$.f],styles:["[_nghost-%COMP%]{display:flex;height:100%;min-height:64vh}.refund-wrapper[_ngcontent-%COMP%]{flex:1;flex-direction:column}.refund-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.refund-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.refund-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}.cancel-checkbox-wrapper[_ngcontent-%COMP%]{align-items:center;display:flex;justify-content:center}clr-checkbox-wrapper[_ngcontent-%COMP%]{display:block;margin-bottom:12px;margin-top:12px}.refund-details[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.totals[_ngcontent-%COMP%]{margin-top:48px}.totals[_ngcontent-%COMP%]   .refund-total[_ngcontent-%COMP%]{font-size:18px}.totals[_ngcontent-%COMP%]   .refund-total-error[_ngcontent-%COMP%]{color:var(--color-error-500)}.totals.disabled[_ngcontent-%COMP%]{color:var(--color-grey-300)}.prorated-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center}.line-promotion[_ngcontent-%COMP%]{display:flex;font-size:12px;justify-content:space-between;padding:3px 6px}.line-promotion[_ngcontent-%COMP%]   .promotion-amount[_ngcontent-%COMP%]{margin-left:12px}"],changeDetection:0}),Tn.ctorParameters=function(){return[{type:b.ob}]};var Ln=function(){function e(){p(this,e),this.transactionId=""}return h(e,[{key:"submit",value:function(){this.resolveWith(this.transactionId)}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();Ln.\u0275fac=function(e){return new(e||Ln)},Ln.\u0275cmp=s.Wb({type:Ln,selectors:[["vdr-settle-refund-dialog"]],decls:10,vars:10,consts:[["vdrDialogTitle",""],[1,"instruction"],["clrInput","","name","transactionId",3,"ngModel","ngModelChange"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(s.Uc(0,et,2,3,"ng-template",0),s.ic(1,"p",1),s.Wc(2),s.sc(3,"translate"),s.hc(),s.ic(4,"clr-input-container"),s.ic(5,"label"),s.Wc(6),s.sc(7,"translate"),s.hc(),s.ic(8,"input",2),s.pc("ngModelChange",(function(e){return t.transactionId=e})),s.hc(),s.hc(),s.Uc(9,tt,6,7,"ng-template",3)),2&e&&(s.Rb(2),s.Yc(" ",s.uc(3,3,"order.settle-refund-manual-instructions",s.Cc(8,ct,t.refund.method)),"\n"),s.Rb(4),s.Xc(s.tc(7,6,"order.transaction-id")),s.Rb(2),s.yc("ngModel",t.transactionId))},directives:[b.R,X.t,X.u,b.fb,m.b,X.s,m.p,m.s,b.Q],pipes:[Y.d],styles:["[_nghost-%COMP%]{padding-bottom:32px}.instruction[_ngcontent-%COMP%]{margin-bottom:24px;margin-top:0}"],changeDetection:0});var Dn,jn=function(t){a(n,t);var c=d(n);function n(e,t,r,i,o,a,l,d){var s;return p(this,n),(s=c.call(this,t,e,r,o)).changeDetector=i,s.dataService=o,s.notificationService=a,s.modalService=l,s.orderTransitionService=d,s.detailForm=new m.i({}),s.fetchHistory=new R.a,s.defaultStates=["AddingItems","ArrangingPayment","PaymentAuthorized","PaymentSettled","PartiallyShipped","Shipped","PartiallyDelivered","Delivered","Cancelled","Modifying","ArrangingAdditionalPayment"],s}return h(n,[{key:"ngOnInit",value:function(){var e=this;this.init(),this.entity$.pipe(Object(w.a)(1)).subscribe((function(t){"Modifying"===t.state&&e.router.navigate(["./","modify"],{relativeTo:e.route})})),this.customFields=this.getCustomFieldConfig("Order"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.history$=this.fetchHistory.pipe(Object(T.a)(null),Object(P.a)((function(){return e.dataService.order.getOrderHistory(e.id,{sort:{createdAt:b.Ob.DESC}}).mapStream((function(e){var t;return null===(t=e.order)||void 0===t?void 0:t.history.items}))}))),this.nextStates$=this.entity$.pipe(Object(_.a)((function(t){return e.defaultStates.includes(t.state)?t.nextStates.filter((function(t){return!e.defaultStates.includes(t)})):t.nextStates})))}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"openStateDiagram",value:function(){var e=this;this.entity$.pipe(Object(w.a)(1),Object(P.a)((function(t){return e.modalService.fromComponent(_n,{closable:!0,locals:{activeState:t.state}})}))).subscribe()}},{key:"transitionToState",value:function(e){var t=this;this.dataService.order.transitionToState(this.id,e).subscribe((function(c){var n=c.transitionOrderToState;switch(null==n?void 0:n.__typename){case"Order":t.notificationService.success(Object(g.a)("order.transitioned-to-state-success"),{state:e}),t.fetchHistory.next();break;case"OrderStateTransitionError":t.notificationService.error(n.transitionError)}}))}},{key:"manuallyTransitionToState",value:function(e){this.orderTransitionService.manuallyTransitionToState({orderId:e.id,nextStates:e.nextStates,cancellable:!0,message:Object(g.a)("order.manually-transition-to-state-message"),retry:0}).subscribe()}},{key:"transitionToModifying",value:function(){var e=this;this.dataService.order.transitionToState(this.id,"Modifying").subscribe((function(t){var c=t.transitionOrderToState;switch(null==c?void 0:c.__typename){case"Order":e.router.navigate(["./modify"],{relativeTo:e.route});break;case"OrderStateTransitionError":e.notificationService.error(c.transitionError)}}))}},{key:"updateCustomFields",value:function(e){var t=this;this.dataService.order.updateOrderCustomFields({id:this.id,customFields:e}).subscribe((function(){t.notificationService.success(Object(g.a)("common.notify-update-success"),{entity:"Order"})}))}},{key:"getOrderAddressLines",value:function(e){return e?Object.values(e).filter((function(e){return"OrderAddress"!==e})).filter((function(e){return!!e})):[]}},{key:"settlePayment",value:function(e){var t=this;this.dataService.order.settlePayment(e.id).subscribe((function(e){var c=e.settlePayment;switch(c.__typename){case"Payment":"Settled"===c.state?t.notificationService.success(Object(g.a)("order.settle-payment-success")):t.notificationService.error(Object(g.a)("order.settle-payment-error")),t.dataService.order.getOrder(t.id).single$.subscribe(),t.fetchHistory.next();break;case"OrderStateTransitionError":case"PaymentStateTransitionError":case"SettlePaymentError":t.notificationService.error(c.message)}}))}},{key:"canAddFulfillment",value:function(t){return!t.lines.reduce((function(t,c){return[].concat(e(t),e(c.items))}),[]).every((function(e){return!!e.fulfillment}))&&!this.hasUnsettledModifications(t)&&(t.nextStates.includes("Shipped")||t.nextStates.includes("PartiallyShipped")||t.nextStates.includes("Delivered"))}},{key:"hasUnsettledModifications",value:function(e){return 0<e.modifications.filter((function(e){return!e.isSettled})).length}},{key:"getOutstandingModificationAmount",value:function(e){return Object(v.summate)(e.modifications.filter((function(e){return!e.isSettled})),"priceChange")}},{key:"addManualPayment",value:function(e){var t=this;this.modalService.fromComponent(Cn,{closable:!0,locals:{outstandingAmount:this.getOutstandingModificationAmount(e),currencyCode:e.currencyCode}}).pipe(Object(P.a)((function(e){return e?t.dataService.order.addManualPaymentToOrder({orderId:t.id,transactionId:e.transactionId,method:e.method,metadata:e.metadata||{}}):C.a})),Object(P.a)((function(c){var n=c.addManualPaymentToOrder;switch(n.__typename){case"Order":return t.notificationService.success(Object(g.a)("order.add-payment-to-order-success")),t.orderTransitionService.transitionToPreModifyingState(e.id,e.nextStates);case"ManualPaymentStateError":return t.notificationService.error(n.message),C.a;default:return C.a}}))).subscribe((function(e){e&&t.refetchOrder({result:e})}))}},{key:"fulfillOrder",value:function(){var e=this;this.entity$.pipe(Object(w.a)(1),Object(P.a)((function(t){return e.modalService.fromComponent(On,{size:"xl",locals:{order:t}})})),Object(P.a)((function(t){return t?e.dataService.order.createFulfillment(t):Object(O.a)(void 0)})),Object(P.a)((function(t){return e.refetchOrder(t).pipe(Object(L.a)(t))}))).subscribe((function(t){if(t)switch(t.addFulfillmentToOrder.__typename){case"Fulfillment":e.notificationService.success(Object(g.a)("order.create-fulfillment-success"));break;case"EmptyOrderLineSelectionError":case"InsufficientStockOnHandError":case"ItemsAlreadyFulfilledError":e.notificationService.error(t.addFulfillmentToOrder.message)}}))}},{key:"transitionFulfillment",value:function(e,t){var c=this;this.dataService.order.transitionFulfillmentToState(e,t).pipe(Object(P.a)((function(e){return c.refetchOrder(e)}))).subscribe((function(){c.notificationService.success(Object(g.a)("order.successfully-updated-fulfillment"))}))}},{key:"cancelOrRefund",value:function(e){var t=this.orderHasSettledPayments(e);"PaymentAuthorized"!==e.state&&!0!==e.active&&t?this.refundOrder(e):this.cancelOrder(e)}},{key:"settleRefund",value:function(e){var t=this;this.modalService.fromComponent(Ln,{size:"md",locals:{refund:e}}).pipe(Object(P.a)((function(c){return c?t.dataService.order.settleRefund({transactionId:c,id:e.id},t.id):Object(O.a)(void 0)}))).subscribe((function(e){e&&t.notificationService.success(Object(g.a)("order.settle-refund-success"))}))}},{key:"addNote",value:function(e){var t=this,c=e.note,n=e.isPublic;this.dataService.order.addNoteToOrder({id:this.id,note:c,isPublic:n}).pipe(Object(P.a)((function(e){return t.refetchOrder(e)}))).subscribe((function(e){t.notificationService.success(Object(g.a)("common.notify-create-success"),{entity:"Note"})}))}},{key:"updateNote",value:function(e){var t=this;this.modalService.fromComponent(b.Z,{closable:!0,locals:{displayPrivacyControls:!0,note:e.data.note,noteIsPrivate:!e.isPublic}}).pipe(Object(P.a)((function(c){return c?t.dataService.order.updateOrderNote({noteId:e.id,isPublic:!c.isPrivate,note:c.note}):C.a}))).subscribe((function(e){t.fetchHistory.next(),t.notificationService.success(Object(g.a)("common.notify-update-success"),{entity:"Note"})}))}},{key:"deleteNote",value:function(e){var t=this;return this.modalService.dialog({title:Object(g.a)("common.confirm-delete-note"),body:e.data.note,buttons:[{type:"secondary",label:Object(g.a)("common.cancel")},{type:"danger",label:Object(g.a)("common.delete"),returnValue:!0}]}).pipe(Object(P.a)((function(c){return c?t.dataService.order.deleteOrderNote(e.id):C.a}))).subscribe((function(){t.fetchHistory.next(),t.notificationService.success(Object(g.a)("common.notify-delete-success"),{entity:"Note"})}))}},{key:"orderHasSettledPayments",value:function(e){var t;return!!(null===(t=e.payments)||void 0===t?void 0:t.find((function(e){return"Settled"===e.state})))}},{key:"cancelOrder",value:function(e){var t=this;this.modalService.fromComponent(Rn,{size:"xl",locals:{order:e}}).pipe(Object(P.a)((function(e){return e?t.dataService.order.cancelOrder(e):Object(O.a)(void 0)})),Object(P.a)((function(e){return t.refetchOrder(e)}))).subscribe((function(e){e&&t.notificationService.success(Object(g.a)("order.cancelled-order-success"))}))}},{key:"refundOrder",value:function(e){var t=this;this.modalService.fromComponent(Tn,{size:"xl",locals:{order:e}}).pipe(Object(P.a)((function(e){var c;if(!e)return Object(O.a)(void 0);var n=[];return e.refund.lines.length&&n.push(t.dataService.order.refundOrder(e.refund).pipe(Object(_.a)((function(e){return e.refundOrder})))),(null===(c=e.cancel.lines)||void 0===c?void 0:c.length)&&n.push(t.dataService.order.cancelOrder(e.cancel).pipe(Object(_.a)((function(e){return e.cancelOrder})))),Object(I.a).apply(void 0,n)}))).subscribe((function(e){if(e)switch(e.__typename){case"Order":t.refetchOrder(e).subscribe(),t.notificationService.success(Object(g.a)("order.cancelled-order-success"));break;case"Refund":t.refetchOrder(e).subscribe(),t.notificationService.success(Object(g.a)("order.refund-order-success"));break;case"QuantityTooGreatError":case"MultipleOrderError":case"OrderStateTransitionError":case"CancelActiveOrderError":case"EmptyOrderLineSelectionError":case"AlreadyRefundedError":case"NothingToRefundError":case"PaymentOrderMismatchError":case"RefundOrderStateError":case"RefundStateTransitionError":t.notificationService.error(e.message)}}))}},{key:"refetchOrder",value:function(e){return this.fetchHistory.next(),e?this.dataService.order.getOrder(this.id).single$:Object(O.a)(void 0)}},{key:"setFormValues",value:function(e){}}]),n}(b.v);jn.\u0275fac=function(e){return new(e||jn)(s.cc(y.e),s.cc(y.a),s.cc(b.Mb),s.cc(s.k),s.cc(b.L),s.cc(b.Eb),s.cc(b.Db),s.cc(wn))},jn.\u0275cmp=s.Wb({type:jn,selectors:[["vdr-order-detail"]],features:[s.Ob],decls:4,vars:6,consts:[[4,"ngIf"],[1,"flex","clr-align-items-center"],[3,"entity"],[3,"state"],[1,"icon-button",3,"title","click"],["shape","list"],["locationId","order-detail"],["class","btn btn-primary",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","class","btn","vdrDropdownItem","",3,"click",4,"ngIf"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],["shape","step-forward-2",1,"is-warning"],[1,"btn","btn-primary",3,"click"],["shape","pencil"],["shape","error-standard",1,"is-error"],[4,"ngIf","ngIfElse"],["cancelOnly",""],["type","button","class","btn","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["shape","step-forward-2"],[1,"clr-row"],[1,"clr-col-lg-8"],[3,"order","orderLineCustomFields"],[1,"table"],[4,"ngFor","ngForOf"],[3,"order","history","addNote","updateNote","deleteNote"],[1,"clr-col-lg-4","order-cards"],[3,"customFieldsConfig","customFieldValues","updateClick"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"card-text"],[3,"customer"],[3,"address"],[3,"currencyCode","payment","settlePayment","settleRefund",4,"ngFor","ngForOf"],[3,"currencyCode","payment","settlePayment","settleRefund"],[3,"fulfillment","order","transitionState"]],template:function(e,t){1&e&&(s.Uc(0,st,28,20,"vdr-action-bar",0),s.sc(1,"async"),s.Uc(2,gt,41,34,"div",0),s.sc(3,"async")),2&e&&(s.yc("ngIf",s.tc(1,2,t.entity$)),s.Rb(2),s.yc("ngIf",s.tc(3,4,t.entity$)))},directives:function(){return[$.o,b.c,b.e,b.bb,b.Gb,X.o,b.f,b.d,b.T,b.W,b.V,b.U,$.n,Qn,Nn,Fn,b.J,b.hb,Yn,In]},pipes:function(){return[$.b,Y.d,b.Ab,b.Qb,$.v]},styles:[".shipping-address[_ngcontent-%COMP%]{line-height:1.3em;list-style-type:none}.order-cards[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{color:var(--color-text-200);margin-top:6px}"],changeDetection:0}),jn.ctorParameters=function(){return[{type:y.e},{type:y.a},{type:b.Mb},{type:s.k},{type:b.L},{type:b.Eb},{type:b.Db},{type:wn}]},function(e){e[e.Refund=0]="Refund",e[e.Payment=1]="Payment",e[e.PriceUnchanged=2]="PriceUnchanged",e[e.Cancel=3]="Cancel"}(Dn||(Dn={}));var Un=function(){function e(){p(this,e)}return h(e,[{key:"ngOnInit",value:function(){this.refundNote=this.modifyOrderInput.note||""}},{key:"cancel",value:function(){this.resolveWith({result:Dn.Cancel})}},{key:"submit",value:function(){0<this.priceDifference?this.resolveWith({result:Dn.Payment}):this.priceDifference<0?this.resolveWith({result:Dn.Refund,refundPaymentId:this.selectedPayment.id,refundNote:this.refundNote}):this.resolveWith({result:Dn.PriceUnchanged})}},{key:"priceDifference",get:function(){return this.order.totalWithTax-this.originalTotalWithTax}}]),e}();Un.\u0275fac=function(e){return new(e||Un)},Un.\u0275cmp=s.Wb({type:Un,selectors:[["vdr-order-edits-preview-dialog"]],decls:10,vars:10,consts:[["vdrDialogTitle",""],[3,"order","orderLineCustomFields"],[1,"h4"],[4,"ngIf"],["vdrDialogButtons",""],["clrSelect","","name","options",3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"clr-control-label"],["name","refundNote","clrTextarea","","required","",3,"ngModel","ngModelChange"],[3,"ngValue"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(s.Uc(0,yt,2,3,"ng-template",0),s.dc(1,"vdr-order-table",1),s.ic(2,"h4",2),s.Wc(3),s.sc(4,"translate"),s.ic(5,"strong"),s.Wc(6),s.sc(7,"localeCurrency"),s.hc(),s.hc(),s.Uc(8,Ct,11,9,"div",3),s.Uc(9,Rt,6,7,"ng-template",4)),2&e&&(s.Rb(1),s.yc("order",t.order)("orderLineCustomFields",t.orderLineCustomFields),s.Rb(2),s.Yc(" ",s.tc(4,5,"order.modify-order-price-difference"),": "),s.Rb(3),s.Xc(s.uc(7,7,t.priceDifference,t.order.currencyCode)),s.Rb(2),s.yc("ngIf",t.priceDifference<0))},directives:function(){return[b.R,Qn,$.o,b.Q,X.B,X.u,b.fb,m.A,X.A,m.p,m.s,$.n,m.b,X.H,m.z,m.u,m.D]},pipes:function(){return[Y.d,b.Ab]},styles:[""],changeDetection:0});var An=function(e){a(r,e);var n=d(r);function r(e,t,c,i,o,a,l,d){var s;return p(this,r),(s=n.call(this,t,e,c,o)).changeDetector=i,s.dataService=o,s.notificationService=a,s.modalService=l,s.orderTransitionService=d,s.detailForm=new m.i({}),s.modifyOrderInput={dryRun:!0,orderId:"",addItems:[],adjustOrderLines:[],surcharges:[],note:"",updateShippingAddress:{},updateBillingAddress:{}},s.note="",s.recalculateShipping=!0,s.addedVariants=new Map,s}return h(r,[{key:"ngOnInit",value:function(){var e=this;this.init(),this.addressCustomFields=this.getCustomFieldConfig("Address"),this.modifyOrderInput.orderId=this.route.snapshot.paramMap.get("id"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.entity$.pipe(Object(D.a)(this.destroy$)).subscribe((function(c){var n,r,i,o,a,l,d,s,u,f,p,h,b,g,y,v,C,R;e.surchargeForm=new m.i({description:new m.f("",m.C.required),sku:new m.f(""),price:new m.f(0,m.C.required),priceIncludesTax:new m.f(!0),taxRate:new m.f(0),taxDescription:new m.f("")}),e.shippingAddressForm=new m.i({fullName:new m.f(null===(n=c.shippingAddress)||void 0===n?void 0:n.fullName),company:new m.f(null===(r=c.shippingAddress)||void 0===r?void 0:r.company),streetLine1:new m.f(null===(i=c.shippingAddress)||void 0===i?void 0:i.streetLine1),streetLine2:new m.f(null===(o=c.shippingAddress)||void 0===o?void 0:o.streetLine2),city:new m.f(null===(a=c.shippingAddress)||void 0===a?void 0:a.city),province:new m.f(null===(l=c.shippingAddress)||void 0===l?void 0:l.province),postalCode:new m.f(null===(d=c.shippingAddress)||void 0===d?void 0:d.postalCode),countryCode:new m.f(null===(s=c.shippingAddress)||void 0===s?void 0:s.countryCode),phoneNumber:new m.f(null===(u=c.shippingAddress)||void 0===u?void 0:u.phoneNumber)}),e.billingAddressForm=new m.i({fullName:new m.f(null===(f=c.billingAddress)||void 0===f?void 0:f.fullName),company:new m.f(null===(p=c.billingAddress)||void 0===p?void 0:p.company),streetLine1:new m.f(null===(h=c.billingAddress)||void 0===h?void 0:h.streetLine1),streetLine2:new m.f(null===(b=c.billingAddress)||void 0===b?void 0:b.streetLine2),city:new m.f(null===(g=c.billingAddress)||void 0===g?void 0:g.city),province:new m.f(null===(y=c.billingAddress)||void 0===y?void 0:y.province),postalCode:new m.f(null===(v=c.billingAddress)||void 0===v?void 0:v.postalCode),countryCode:new m.f(null===(C=c.billingAddress)||void 0===C?void 0:C.countryCode),phoneNumber:new m.f(null===(R=c.billingAddress)||void 0===R?void 0:R.phoneNumber)}),e.orderLineCustomFieldsFormArray=new m.c([]);var O,I=t(c.lines);try{var S=function(){var c,n=O.value,r=new m.i({}),i=t(e.orderLineCustomFields);try{for(i.s();!(c=i.n()).done;){var o=c.value.name;r.addControl(o,new m.f(n.customFields[o]))}}catch(a){i.e(a)}finally{i.f()}r.valueChanges.pipe(Object(D.a)(e.destroy$)).subscribe((function(t){var c=e.modifyOrderInput.adjustOrderLines.find((function(e){return e.orderLineId===n.id}));c||(c={orderLineId:n.id,quantity:n.quantity},e.modifyOrderInput.adjustOrderLines.push(c)),e.orderLineCustomFields.length&&(c.customFields=t)})),e.orderLineCustomFieldsFormArray.push(r)};for(I.s();!(O=I.n()).done;)S()}catch(P){I.e(P)}finally{I.f()}})),this.addItemCustomFieldsFormArray=new m.c([]),this.addItemCustomFieldsForm=new m.i({});var c,n=t(this.orderLineCustomFields);try{for(n.s();!(c=n.n()).done;){var r=c.value;this.addItemCustomFieldsForm.addControl(r.name,new m.f)}}catch(i){n.e(i)}finally{n.f()}this.availableCountries$=this.dataService.settings.getAvailableCountries().mapSingle((function(e){return e.countries.items})).pipe(Object(j.a)(1)),this.dataService.order.getOrderHistory(this.id,{take:1,sort:{createdAt:b.Ob.DESC},filter:{type:{eq:b.nb.ORDER_STATE_TRANSITION}}}).single$.subscribe((function(t){var c=t.order;e.previousState=null==c?void 0:c.history.items[0].data.from}))}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"transitionToPriorState",value:function(e){var t=this;this.orderTransitionService.transitionToPreModifyingState(e.id,e.nextStates).subscribe((function(e){t.router.navigate([".."],{relativeTo:t.route})}))}},{key:"canPreviewChanges",value:function(){var e=this.modifyOrderInput,t=e.addItems,c=e.adjustOrderLines,n=e.surcharges;return(!!(null==t?void 0:t.length)||!!(null==n?void 0:n.length)||!!(null==c?void 0:c.length)||this.shippingAddressForm.dirty&&this.shippingAddressForm.valid||this.billingAddressForm.dirty&&this.billingAddressForm.valid)&&""!==this.note}},{key:"isLineModified",value:function(e){var t;return!!(null===(t=this.modifyOrderInput.adjustOrderLines)||void 0===t?void 0:t.find((function(t){return t.orderLineId===e.id&&t.quantity!==e.quantity})))}},{key:"updateLineQuantity",value:function(e,t){var c=this.modifyOrderInput.adjustOrderLines,n=null==c?void 0:c.find((function(t){return t.orderLineId===e.id}));n&&+t===e.quantity&&(null==c||c.splice(null==c?void 0:c.indexOf(n),1)),n||(n={orderLineId:e.id,quantity:+t},null==c||c.push(n)),n.quantity=+t}},{key:"updateAddedItemQuantity",value:function(e,t){var c,n=null===(c=this.modifyOrderInput.addItems)||void 0===c?void 0:c.find((function(t){return t.productVariantId===e.productVariantId}));n&&(n.quantity=+t)}},{key:"trackByProductVariantId",value:function(e,t){return t.productVariantId}},{key:"getSelectedItemPrice",value:function(e){switch(null==e?void 0:e.priceWithTax.__typename){case"SinglePrice":return e.priceWithTax.value;default:return 0}}},{key:"addItemToOrder",value:function(e){var t,n,r=this;if(e){var i=this.orderLineCustomFields.length?this.addItemCustomFieldsForm.value:void 0,o=null===(t=this.modifyOrderInput.addItems)||void 0===t?void 0:t.find((function(t){return r.isMatchingAddItemRow(t,e,i)}));if(o?o.quantity++:(o={productVariantId:e.productVariantId,quantity:1},i&&(o.customFields=i),null===(n=this.modifyOrderInput.addItems)||void 0===n||n.push(o)),i){for(var a=new m.i({}),l=0,d=Object.entries(i);l<d.length;l++){var s=c(d[l],2),u=s[0],f=s[1];a.addControl(u,new m.f(f))}this.addItemCustomFieldsFormArray.push(a),a.valueChanges.pipe(Object(D.a)(this.destroy$)).subscribe((function(e){o&&(o.customFields=e)}))}this.addItemCustomFieldsForm.reset({}),this.addItemSelectedVariant=void 0,this.addedVariants.set(e.productVariantId,e)}}},{key:"isMatchingAddItemRow",value:function(e,t,c){return e.productVariantId===t.productVariantId&&JSON.stringify(e.customFields)===JSON.stringify(c)}},{key:"removeAddedItem",value:function(e){this.modifyOrderInput.addItems.splice(e,1),-1<e&&this.addItemCustomFieldsFormArray.removeAt(e)}},{key:"getSurchargePrices",value:function(e){var t=e.priceIncludesTax?e.price:Math.round(e.price*((100+(e.taxRate||0))/100));return{price:e.priceIncludesTax?Math.round(e.price/((100+(e.taxRate||0))/100)):e.price,priceWithTax:t}}},{key:"addSurcharge",value:function(e){var t;null===(t=this.modifyOrderInput.surcharges)||void 0===t||t.push(e),this.surchargeForm.reset({price:0,priceIncludesTax:!0,taxRate:0})}},{key:"removeSurcharge",value:function(e){var t;null===(t=this.modifyOrderInput.surcharges)||void 0===t||t.splice(e,1)}},{key:"previewAndModify",value:function(e){var t=this,c=Object.assign(Object.assign({},this.modifyOrderInput),{dryRun:!0,note:this.note,options:{recalculateShipping:this.recalculateShipping}}),n=e.totalWithTax;this.dataService.order.modifyOrder(c).pipe(Object(P.a)((function(e){var r=e.modifyOrder;switch(r.__typename){case"Order":return t.modalService.fromComponent(Un,{size:"xl",closable:!1,locals:{originalTotalWithTax:n,order:r,orderLineCustomFields:t.orderLineCustomFields,modifyOrderInput:c}});case"InsufficientStockError":case"NegativeQuantityError":case"NoChangesSpecifiedError":case"OrderLimitError":case"OrderModificationStateError":case"PaymentMethodMissingError":case"RefundPaymentIdMissingError":return t.notificationService.error(r.message),Object(O.a)(!1);case null:case void 0:return Object(O.a)(!1);default:Object(v.assertNever)(r)}})),Object(P.a)((function(r){if(r&&r.result!==Dn.Cancel){var i=Object.assign(Object.assign({},c),{dryRun:!1});return r.result===Dn.Refund&&(i.refund={paymentId:r.refundPaymentId,reason:r.refundNote}),t.dataService.order.modifyOrder(i).pipe(Object(P.a)((function(c){var r=c.modifyOrder;if("Order"===r.__typename){var i=0<r.totalWithTax-n?"ArrangingAdditionalPayment":t.previousState;return t.dataService.order.transitionToState(e.id,i).pipe(Object(L.a)(!0))}return t.notificationService.error(r.message),C.a})))}return t.dataService.order.getOrder(t.id).mapSingle((function(){return!1}))}))).subscribe((function(e){e&&t.router.navigate(["../"],{relativeTo:t.route})}))}},{key:"setFormValues",value:function(e,t){}},{key:"addedLines",get:function(){var e=this,t=function(e){return"SinglePrice"===e.__typename?e.value:0};return(this.modifyOrderInput.addItems||[]).map((function(c){var n=e.addedVariants.get(c.productVariantId);if(n)return Object.assign(Object.assign({},n),{price:t(n.price),priceWithTax:t(n.priceWithTax),quantity:c.quantity})})).filter(v.notNullOrUndefined)}}]),r}(b.v);An.\u0275fac=function(e){return new(e||An)(s.cc(y.e),s.cc(y.a),s.cc(b.Mb),s.cc(s.k),s.cc(b.L),s.cc(b.Eb),s.cc(b.Db),s.cc(wn))},An.\u0275cmp=s.Wb({type:An,selectors:[["vdr-order-editor"]],features:[s.Ob],decls:4,vars:6,consts:[[4,"ngIf"],[1,"flex","clr-align-items-center"],[3,"entity"],[3,"state"],[1,"btn","btn-secondary",3,"click"],[1,"clr-row"],[1,"clr-col-lg-8"],[1,"order-table","table"],["class","order-line",3,"is-cancelled","modified",4,"ngFor","ngForOf"],["class","modified",4,"ngFor","ngForOf","ngForTrackBy"],["class","surcharge",4,"ngFor","ngForOf"],["class","surcharge modified",4,"ngFor","ngForOf"],[1,"shipping"],[1,"left","clr-align-middle"],[1,"clr-align-middle"],["colspan","3"],[1,"net-price",3,"title"],[1,"mb2"],[4,"clrIfExpanded"],[1,"clr-col-lg-4","order-cards"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"clr-control-label"],["name","note","clrTextarea","","required","",3,"ngModel","ngModelChange"],[1,""],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],[1,"card-footer"],[1,"btn","btn-primary",3,"disabled","click"],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","unit-price"],[1,"align-middle","quantity"],["type","number","min","0",3,"value","input"],[3,"line"],[3,"line","orderState"],["class","order-line-custom-field align-middle",4,"ngIf"],[1,"align-middle","total"],[3,"src"],[1,"order-line-custom-field","align-middle"],[4,"ngFor","ngForOf"],["entityName","OrderLine",3,"customField","customFieldsFormGroup","compact"],[1,"modified"],[1,"icon-button",3,"click"],["shape","trash"],[1,"surcharge"],["colspan","2",1,"align-middle","name","left"],[1,"align-middle"],[1,"surcharge","modified"],[1,"mb4",3,"productSelected"],["class","flex mb4",4,"ngIf"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"flex","mb4"],["class","mr4",3,"src",4,"ngIf"],[1,"mr4"],[1,"mr4",3,"src"],["entityName","OrderLine",3,"readonly","customField","customFieldsFormGroup","compact"],[3,"formGroup","submit"],["for","description",3,"label"],["id","description","type","text","formControlName","description"],["for","sku",3,"label"],["id","sku","type","text","formControlName","sku"],["for","price",3,"label"],["id","price","formControlName","price",3,"currencyCode"],["for","priceIncludesTax",3,"label"],["id","priceIncludesTax","type","checkbox","clrCheckbox","","formControlName","priceIncludesTax"],["for","taxRate",3,"label"],["suffix","%"],["id","taxRate","type","number","min","0","max","100","formControlName","taxRate"],["for","taxDescription",3,"label"],["id","taxDescription","type","text","formControlName","taxDescription"],[1,"btn","btn-secondary",3,"disabled"],[3,"formGroup","availableCountries","customFields"]],template:function(e,t){1&e&&(s.Uc(0,Ot,10,7,"vdr-action-bar",0),s.sc(1,"async"),s.Uc(2,Jt,93,72,"div",0),s.sc(3,"async")),2&e&&(s.yc("ngIf",s.tc(1,2,t.entity$)),s.Rb(2),s.yc("ngIf",s.tc(3,4,t.entity$)))},directives:[$.o,b.c,b.e,b.bb,b.Gb,b.f,$.n,X.l,X.b,X.O,X.d,X.N,X.e,X.Q,X.q,X.u,b.fb,m.b,X.H,m.z,m.p,m.s,X.k,m.a,X.i,Mn,kn,b.H,X.o,X.c,b.Jb,m.E,m.q,m.j,b.eb,m.h,b.G,b.i,m.v,b.g],pipes:[$.b,Y.d,b.Ab,b.r,$.d],styles:[".order-table[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200);text-decoration:line-through}.order-table[_ngcontent-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%], .order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px}.order-table[_ngcontent-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);cursor:pointer;font-size:11px;margin-top:6px;text-decoration:underline dotted var(--color-text-200);text-transform:lowercase}.order-table[_ngcontent-%COMP%]   .line-promotion[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:6px 12px}.order-table[_ngcontent-%COMP%]   .line-promotion[_ngcontent-%COMP%]   .promotion-amount[_ngcontent-%COMP%]{margin-left:12px}.order-table[_ngcontent-%COMP%]   tr.modified[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-warning-100)}"],changeDetection:0}),An.ctorParameters=function(){return[{type:y.e},{type:y.a},{type:b.Mb},{type:s.k},{type:b.L},{type:b.Eb},{type:b.Db},{type:wn}]};var Nn=function(){function e(){p(this,e),this.addNote=new s.u,this.updateNote=new s.u,this.deleteNote=new s.u,this.note="",this.noteIsPrivate=!0,this.expanded=!1,this.type=b.nb}return h(e,[{key:"getDisplayType",value:function(e){if(e.type===b.nb.ORDER_STATE_TRANSITION){if("Delivered"===e.data.to)return"success";if("Cancelled"===e.data.to)return"error"}return e.type===b.nb.ORDER_FULFILLMENT_TRANSITION&&"Delivered"===e.data.to?"success":e.type===b.nb.ORDER_PAYMENT_TRANSITION&&"Declined"===e.data.to||e.type===b.nb.ORDER_CANCELLATION?"error":e.type===b.nb.ORDER_REFUND_TRANSITION?"warning":"default"}},{key:"getTimelineIcon",value:function(e){if(e.type===b.nb.ORDER_STATE_TRANSITION){if("Delivered"===e.data.to)return["success-standard","is-solid"];if("Cancelled"===e.data.to)return"ban"}if(e.type===b.nb.ORDER_PAYMENT_TRANSITION&&"Settled"===e.data.to)return"credit-card";if(e.type===b.nb.ORDER_NOTE)return"note";if(e.type===b.nb.ORDER_MODIFIED)return"pencil";if(e.type===b.nb.ORDER_FULFILLMENT_TRANSITION){if("Shipped"===e.data.to)return"truck";if("Delivered"===e.data.to)return"truck"}}},{key:"isFeatured",value:function(e){switch(e.type){case b.nb.ORDER_STATE_TRANSITION:return"Delivered"===e.data.to||"Cancelled"===e.data.to||"Settled"===e.data.to;case b.nb.ORDER_PAYMENT_TRANSITION:return"Settled"===e.data.to;case b.nb.ORDER_FULFILLMENT_TRANSITION:return"Delivered"===e.data.to||"Shipped"===e.data.to;case b.nb.ORDER_NOTE:case b.nb.ORDER_MODIFIED:return!0;default:return!1}}},{key:"getFulfillment",value:function(e){if((e.type===b.nb.ORDER_FULFILLMENT||e.type===b.nb.ORDER_FULFILLMENT_TRANSITION)&&this.order.fulfillments)return this.order.fulfillments.find((function(t){return t.id===e.data.fulfillmentId}))}},{key:"getPayment",value:function(e){if(e.type===b.nb.ORDER_PAYMENT_TRANSITION&&this.order.payments)return this.order.payments.find((function(t){return t.id===e.data.paymentId}))}},{key:"getCancelledItems",value:function(e){var n,r=new Map,i=e.data.orderItemIds,o=t(this.order.lines);try{for(o.s();!(n=o.n()).done;){var a,l=n.value,d=t(l.items);try{for(d.s();!(a=d.n()).done;){var s=a.value;if(i.includes(s.id)){var u=r.get(l.productVariant.name);null!=u?r.set(l.productVariant.name,u+1):r.set(l.productVariant.name,1)}}}catch(f){d.e(f)}finally{d.f()}}}catch(f){o.e(f)}finally{o.f()}return Array.from(r.entries()).map((function(e){var t=c(e,2);return{name:t[0],quantity:t[1]}}))}},{key:"getModification",value:function(e){return this.order.modifications.find((function(t){return t.id===e}))}},{key:"getName",value:function(e){var t=e.administrator;if(t)return"".concat(t.firstName," ").concat(t.lastName);var c=this.order.customer;return c?"".concat(c.firstName," ").concat(c.lastName):""}},{key:"addNoteToOrder",value:function(){this.addNote.emit({note:this.note,isPublic:!this.noteIsPrivate}),this.note="",this.noteIsPrivate=!0}}]),e}();Nn.\u0275fac=function(e){return new(e||Nn)},Nn.\u0275cmp=s.Wb({type:Nn,selectors:[["vdr-order-history"]],inputs:{order:"order",history:"history"},outputs:{addNote:"addNote",updateNote:"updateNote",deleteNote:"deleteNote"},decls:23,vars:24,consts:[[1,"entry-list"],["iconShape","note","displayType","muted",3,"featured"],[1,"note-entry"],["name","note",1,"note",3,"ngModel","ngModelChange"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"visibility-select"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],["class","private",4,"ngIf"],["class","public",4,"ngIf"],[3,"displayType","iconShape","createdAt","name","featured","collapsed","expandClick",4,"ngFor","ngForOf"],[3,"isLast","createdAt","featured"],[1,"title"],[1,"private"],[1,"public"],[3,"displayType","iconShape","createdAt","name","featured","collapsed","expandClick"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","title",4,"ngIf"],[3,"ngIf"],[4,"ngIf"],["colorType","success",4,"ngIf"],["colorType","error",4,"ngIf"],[3,"order","modification"],["colorType","success"],["colorType","error"],[4,"ngIf","ngIfElse"],["regularPaymentTransition",""],[3,"payment","currencyCode"],[3,"label"],[3,"items"],[3,"fulfillmentId","order"],[1,"flex"],[1,"note-text"],["class","note-visibility public",4,"ngIf"],["class","note-visibility private",4,"ngIf"],[1,"flex-spacer"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["vdrDropdownItem","",1,"button",3,"disabled","click"],["shape","edit"],[1,"dropdown-divider"],["shape","trash",1,"is-danger"],[1,"note-visibility","public"],[1,"note-visibility","private"],[3,"routerLink"],[1,"cancelled-coupon-code"]],template:function(e,t){1&e&&(s.ic(0,"h4"),s.Wc(1),s.sc(2,"translate"),s.hc(),s.ic(3,"div",0),s.ic(4,"vdr-timeline-entry",1),s.ic(5,"div",2),s.ic(6,"textarea",3),s.pc("ngModelChange",(function(e){return t.note=e})),s.hc(),s.ic(7,"button",4),s.pc("click",(function(){return t.addNoteToOrder()})),s.Wc(8),s.sc(9,"translate"),s.hc(),s.hc(),s.ic(10,"div",5),s.ic(11,"clr-checkbox-wrapper"),s.ic(12,"input",6),s.pc("ngModelChange",(function(e){return t.noteIsPrivate=e})),s.hc(),s.ic(13,"label"),s.Wc(14),s.sc(15,"translate"),s.hc(),s.hc(),s.Uc(16,Kt,3,3,"span",7),s.Uc(17,ec,3,3,"span",8),s.hc(),s.hc(),s.Uc(18,wc,12,17,"vdr-timeline-entry",9),s.ic(19,"vdr-timeline-entry",10),s.ic(20,"div",11),s.Wc(21),s.sc(22,"translate"),s.hc(),s.hc(),s.hc()),2&e&&(s.Rb(1),s.Xc(s.tc(2,16,"order.order-history")),s.Rb(2),s.Ub("expanded",t.expanded),s.Rb(1),s.yc("featured",!0),s.Rb(2),s.yc("ngModel",t.note),s.Rb(1),s.yc("disabled",!t.note),s.Rb(1),s.Yc(" ",s.tc(9,18,"common.add-note")," "),s.Rb(4),s.yc("ngModel",t.noteIsPrivate),s.Rb(2),s.Xc(s.tc(15,20,"order.note-is-private")),s.Rb(2),s.yc("ngIf",t.noteIsPrivate),s.Rb(1),s.yc("ngIf",!t.noteIsPrivate),s.Rb(1),s.yc("ngForOf",t.history),s.Rb(1),s.yc("isLast",!0)("createdAt",t.order.createdAt)("featured",!0),s.Rb(2),s.Yc(" ",s.tc(22,22,"order.history-order-created")," "))},directives:function(){return[b.Ub,b.fb,m.b,m.p,m.s,X.k,m.a,X.i,X.u,$.o,$.n,$.q,$.r,b.mb,Wn,b.C,Hn,b.vb,zn,Sn,b.T,b.W,X.o,b.V,b.U,y.h]},pipes:function(){return[Y.d,b.Ab,b.jb]},styles:["[_nghost-%COMP%]{display:block;margin-top:48px}.entry-list[_ngcontent-%COMP%]{margin-left:24px;margin-right:12px;margin-top:24px}.note-entry[_ngcontent-%COMP%]{align-items:center;display:flex}.note-entry[_ngcontent-%COMP%]   .note[_ngcontent-%COMP%]{flex:1}.note-entry[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0}.visibility-select[_ngcontent-%COMP%]{align-items:baseline;display:flex;justify-content:space-between}.visibility-select[_ngcontent-%COMP%]   .public[_ngcontent-%COMP%]{color:var(--color-warning-500)}.visibility-select[_ngcontent-%COMP%]   .private[_ngcontent-%COMP%]{color:var(--color-success-500)}textarea.note[_ngcontent-%COMP%]{border-radius:3px;flex:1;height:36px;margin-right:6px}.note-text[_ngcontent-%COMP%]{color:var(--color-grey-800);white-space:pre-wrap}.cancelled-coupon-code[_ngcontent-%COMP%]{text-decoration:line-through}.note-visibility[_ngcontent-%COMP%]{text-transform:lowercase}.note-visibility.public[_ngcontent-%COMP%]{color:var(--color-warning-500)}.note-visibility.private[_ngcontent-%COMP%]{color:var(--color-success-500)}"],changeDetection:0}),Nn.propDecorators={order:[{type:s.D}],history:[{type:s.D}],addNote:[{type:s.O}],updateNote:[{type:s.O}],deleteNote:[{type:s.O}]};var En=function(e){a(c,e);var t=d(c);function c(e,n,r,i,a){var l,d;p(this,c),(d=t.call(this,i,a)).serverConfigService=e,d.dataService=n,d.localStorageService=r,d.searchTerm=new m.f(""),d.orderStates=d.serverConfigService.getOrderProcessStates().map((function(e){return e.name})),d.filterPresets=[{name:"open",label:Object(g.a)("order.filter-preset-open"),config:{active:!1,states:d.orderStates.filter((function(e){return"Delivered"!==e&&"Cancelled"!==e&&"Shipped"!==e}))}},{name:"shipped",label:Object(g.a)("order.filter-preset-shipped"),config:{active:!1,states:["Shipped"]}},{name:"completed",label:Object(g.a)("order.filter-preset-completed"),config:{active:!1,states:["Delivered","Cancelled"]}},{name:"active",label:Object(g.a)("order.filter-preset-active"),config:{active:!0}}],o((l=u(d),f(c.prototype)),"setQueryFn",l).call(l,(function(e,t){return d.dataService.order.getOrders({take:e,skip:t}).refetchOnChannelChange()}),(function(e){return e.orders}),(function(e,t){return d.createQueryOptions(e,t,d.searchTerm.value,d.route.snapshot.queryParamMap.get("filter")||"open")}));var s=d.localStorageService.get("orderListLastCustomFilters");return s&&d.setQueryParam(s,{replaceUrl:!0}),d}return h(c,[{key:"ngOnInit",value:function(){var e,t=this;o(f(c.prototype),"ngOnInit",this).call(this),this.activePreset$=this.route.queryParamMap.pipe(Object(_.a)((function(e){return e.get("filter")||"open"})),Object(U.a)()),Object(I.a)(this.searchTerm.valueChanges.pipe(Object(A.a)(250)),this.route.queryParamMap).pipe(Object(D.a)(this.destroy$)).subscribe((function(e){t.refresh()}));var n=this.route.snapshot.queryParamMap;this.customFilterForm=new m.i({states:new m.f(null!==(e=n.getAll("states"))&&void 0!==e?e:[]),placedAtStart:new m.f(n.get("placedAtStart")),placedAtEnd:new m.f(n.get("placedAtEnd"))})}},{key:"selectFilterPreset",value:function(e){var t,c=null!==(t=this.localStorageService.get("orderListLastCustomFilters"))&&void 0!==t?t:{},n="custom"===e?c:{states:void 0,placedAtStart:void 0,placedAtEnd:void 0};this.setQueryParam(Object.assign({filter:e,page:1},n),{replaceUrl:!0})}},{key:"applyCustomFilters",value:function(){var e=this.customFilterForm.value,t={states:e.states,placedAtStart:e.placedAtStart,placedAtEnd:e.placedAtEnd};this.setQueryParam(Object.assign({filter:"custom"},t)),this.customFilterForm.markAsPristine(),this.localStorageService.set("orderListLastCustomFilters",t)}},{key:"createQueryOptions",value:function(e,t,c,n){var r,i=this.filterPresets.find((function(e){return e.name===n})),o={};if(i)null!=i.config.active&&(o.active={eq:i.config.active}),i.config.states&&(o.state={in:i.config.states});else if("custom"===n){var a=this.route.snapshot.queryParamMap,l=null!==(r=a.getAll("states"))&&void 0!==r?r:[],d=a.get("placedAtStart"),s=a.get("placedAtEnd");l.length&&(o.state={in:l}),d&&s?o.orderPlacedAt={between:{start:d,end:s}}:d?o.orderPlacedAt={after:d}:s&&(o.orderPlacedAt={before:s})}return{options:{skip:e,take:t,filter:Object.assign(Object.assign({},null!=o?o:{}),{code:{contains:c}}),sort:{updatedAt:b.Ob.DESC}}}}},{key:"getShippingNames",value:function(e){return e.shippingLines.length?e.shippingLines.map((function(e){return e.shippingMethod.name})).join(", "):""}}]),c}(b.x);En.\u0275fac=function(e){return new(e||En)(s.cc(b.Mb),s.cc(b.L),s.cc(b.yb),s.cc(y.e),s.cc(y.a))},En.\u0275cmp=s.Wb({type:En,selectors:[["vdr-order-list"]],features:[s.Ob],decls:60,vars:63,consts:[[1,"search-form"],["class","btn-group btn-outline-primary",4,"ngIf"],["type","text","name","searchTerm",1,"search-input",3,"formControl","placeholder"],[1,"custom-filters"],[3,"formGroup"],[1,"flex","align-center"],["appendTo","body","formControlName","states",3,"items","addTag","multiple","placeholder","clearable","searchable"],["ng-option-tmp",""],["ng-label-tmp",""],[1,"btn","btn-secondary",3,"disabled","click"],["shape","filter"],[1,"flex"],["formControlName","placedAtStart"],["formControlName","placedAtEnd"],["locationId","order-list"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"btn-group","btn-outline-primary"],["class","btn",3,"btn-primary","click",4,"ngFor","ngForOf"],[1,"btn",3,"click"],["shape","angle down"],[1,"ng-value-label"],["aria-hidden","true",1,"ng-value-icon","right",3,"click"],[1,"left","align-middle"],[3,"customer"],[3,"state"],[1,"right","align-middle"],["iconShape","shopping-cart",3,"label","linkTo"]],template:function(e,t){1&e&&(s.ic(0,"vdr-action-bar"),s.ic(1,"vdr-ab-left"),s.ic(2,"div",0),s.Uc(3,Tc,6,6,"div",1),s.sc(4,"async"),s.dc(5,"input",2),s.sc(6,"translate"),s.hc(),s.ic(7,"div",3),s.sc(8,"async"),s.ic(9,"form",4),s.ic(10,"div",5),s.ic(11,"ng-select",6),s.sc(12,"translate"),s.Uc(13,Lc,3,5,"ng-template",7),s.Uc(14,Dc,6,5,"ng-template",8),s.hc(),s.ic(15,"button",9),s.pc("click",(function(){return t.applyCustomFilters()})),s.Wc(16),s.sc(17,"translate"),s.dc(18,"clr-icon",10),s.hc(),s.hc(),s.ic(19,"div",11),s.ic(20,"div"),s.ic(21,"label"),s.Wc(22),s.sc(23,"translate"),s.hc(),s.dc(24,"vdr-datetime-picker",12),s.hc(),s.ic(25,"div"),s.ic(26,"label"),s.Wc(27),s.sc(28,"translate"),s.hc(),s.dc(29,"vdr-datetime-picker",13),s.hc(),s.hc(),s.hc(),s.hc(),s.hc(),s.ic(30,"vdr-ab-right"),s.dc(31,"vdr-action-bar-items",14),s.hc(),s.hc(),s.ic(32,"vdr-data-table",15),s.pc("pageChange",(function(e){return t.setPageNumber(e)}))("itemsPerPageChange",(function(e){return t.setItemsPerPage(e)})),s.sc(33,"async"),s.sc(34,"async"),s.sc(35,"async"),s.sc(36,"async"),s.ic(37,"vdr-dt-column"),s.Wc(38),s.sc(39,"translate"),s.hc(),s.ic(40,"vdr-dt-column"),s.Wc(41),s.sc(42,"translate"),s.hc(),s.ic(43,"vdr-dt-column"),s.Wc(44),s.sc(45,"translate"),s.hc(),s.ic(46,"vdr-dt-column"),s.Wc(47),s.sc(48,"translate"),s.hc(),s.ic(49,"vdr-dt-column"),s.Wc(50),s.sc(51,"translate"),s.hc(),s.ic(52,"vdr-dt-column"),s.Wc(53),s.sc(54,"translate"),s.hc(),s.ic(55,"vdr-dt-column"),s.Wc(56),s.sc(57,"translate"),s.hc(),s.dc(58,"vdr-dt-column"),s.Uc(59,Ac,20,23,"ng-template"),s.hc()),2&e&&(s.Rb(3),s.yc("ngIf",s.tc(4,27,t.activePreset$)),s.Rb(2),s.yc("formControl",t.searchTerm)("placeholder",s.tc(6,29,"order.search-by-order-code")),s.Rb(2),s.Ub("expanded","custom"===s.tc(8,31,t.activePreset$)),s.Rb(2),s.yc("formGroup",t.customFilterForm),s.Rb(2),s.yc("items",t.orderStates)("addTag",!1)("multiple",!0)("placeholder",s.tc(12,33,"state.all-orders"))("clearable",!0)("searchable",!1),s.Rb(4),s.yc("disabled",t.customFilterForm.pristine),s.Rb(1),s.Yc(" ",s.tc(17,35,"order.apply-filters")," "),s.Rb(6),s.Xc(s.tc(23,37,"order.placed-at-start")),s.Rb(5),s.Xc(s.tc(28,39,"order.placed-at-end")),s.Rb(5),s.yc("items",s.tc(33,41,t.items$))("itemsPerPage",s.tc(34,43,t.itemsPerPage$))("totalItems",s.tc(35,45,t.totalItems$))("currentPage",s.tc(36,47,t.currentPage$)),s.Rb(6),s.Xc(s.tc(39,49,"common.code")),s.Rb(3),s.Xc(s.tc(42,51,"order.customer")),s.Rb(3),s.Xc(s.tc(45,53,"order.state")),s.Rb(3),s.Xc(s.tc(48,55,"order.total")),s.Rb(3),s.Xc(s.tc(51,57,"common.updated-at")),s.Rb(3),s.Xc(s.tc(54,59,"order.placed-at")),s.Rb(3),s.Xc(s.tc(57,61,"order.shipping")))},directives:[b.c,b.e,$.o,b.fb,m.b,m.p,m.g,m.E,m.q,m.j,E.a,m.h,E.d,E.e,X.o,X.u,b.O,b.f,b.d,b.N,b.M,$.n,b.J,b.Gb,b.Sb],pipes:[$.b,Y.d,b.Qb,b.Ab,b.Tb,b.Bb],styles:[".search-form[_ngcontent-%COMP%]{align-items:baseline;display:flex;flex-direction:column;margin-bottom:6px;width:100%}@media screen and (min-width:768px){.search-form[_ngcontent-%COMP%]{flex-direction:row}}.search-input[_ngcontent-%COMP%]{margin-left:6px;margin-top:6px;min-width:300px}.custom-filters[_ngcontent-%COMP%]{max-height:0;overflow:hidden;padding-bottom:6px}.custom-filters.expanded[_ngcontent-%COMP%]{max-height:none}.custom-filters[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]{align-items:center;display:flex;flex-direction:column}.custom-filters[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%}ng-select[_ngcontent-%COMP%]{flex:1;min-width:200px}ng-select[_ngcontent-%COMP%], ng-select[_ngcontent-%COMP%]     .ng-select-container{height:36px}"],changeDetection:0}),En.ctorParameters=function(){return[{type:b.Mb},{type:b.L},{type:b.yb},{type:y.e},{type:y.a}]};var Yn=function(){function e(){p(this,e),this.settlePayment=new s.u,this.settleRefund=new s.u}return h(e,[{key:"refundHasMetadata",value:function(e){return!!e&&Object.keys(e).length<0}}]),e}();Yn.\u0275fac=function(e){return new(e||Yn)},Yn.\u0275cmp=s.Wb({type:Yn,selectors:[["vdr-order-payment-card"]],inputs:{payment:"payment",currencyCode:"currencyCode"},outputs:{settlePayment:"settlePayment",settleRefund:"settleRefund"},decls:11,vars:9,consts:[[1,"card"],[1,"card-header","payment-header"],[1,"payment-state"],[3,"state"],[1,"card-block"],[3,"payment","currencyCode"],[4,"ngFor","ngForOf"],["class","card-footer",4,"ngIf"],["shape","redo","dir","down",1,"refund-icon"],[1,"clr-flex-fill"],[3,"label"],[3,"label",4,"ngIf"],[3,"value"],[1,"card-footer"],[1,"btn","btn-sm","btn-primary",3,"click"]],template:function(e,t){1&e&&(s.ic(0,"div",0),s.ic(1,"div",1),s.ic(2,"div"),s.Wc(3),s.sc(4,"translate"),s.hc(),s.ic(5,"div",2),s.dc(6,"vdr-payment-state-label",3),s.hc(),s.hc(),s.ic(7,"div",4),s.dc(8,"vdr-payment-detail",5),s.hc(),s.Uc(9,Xc,20,23,"ng-container",6),s.Uc(10,qc,4,3,"div",7),s.hc()),2&e&&(s.Rb(3),s.Zc("",s.tc(4,7,"order.payment")," #",t.payment.transactionId,""),s.Rb(3),s.yc("state",t.payment.state),s.Rb(2),s.yc("payment",t.payment)("currencyCode",t.currencyCode),s.Rb(1),s.yc("ngForOf",t.payment.refunds),s.Rb(1),s.yc("ngIf","Authorized"===t.payment.state))},directives:function(){return[Bn,Hn,$.n,$.o,X.o,q.b,Gn,b.vb,b.Fb]},pipes:function(){return[Y.d,b.Bb,b.Ab]},styles:[".payment-header[_ngcontent-%COMP%]{align-items:center;display:flex;justify-content:space-between}.refund-icon[_ngcontent-%COMP%]{color:var(--color-grey-400);margin-right:6px}"],changeDetection:0}),Yn.propDecorators={payment:[{type:s.D}],currencyCode:[{type:s.D}],settlePayment:[{type:s.O}],settleRefund:[{type:s.O}]};var $n=72,Xn=function(){function e(t){p(this,e),this.elementRef=t,this.active$=new S.a(!1),this.activeTarget$=new S.a(!1),this.isCancellable=!1,this.cancelledState="Cancelled"}return h(e,[{key:"ngOnChanges",value:function(e){this.isCancellable=!!this.node.to.find((function(e){return"Cancelled"===e.name})),e.active&&this.active$.next(this.active)}},{key:"getPos",value:function(){var e,t,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"top";this.elementRef.nativeElement.getBoundingClientRect();var n=null!==(t=null===(e=this.elementRef.nativeElement.querySelector(".node"))||void 0===e?void 0:e.getBoundingClientRect().height)&&void 0!==t?t:0;return{x:10,y:this.index*$n+("bottom"===c?n:0)}}},{key:"getStyle",value:function(){var e=this.getPos();return{"top.px":e.y,"left.px":e.x}}}]),e}();Xn.\u0275fac=function(e){return new(e||Xn)(s.cc(s.s))},Xn.\u0275cmp=s.Wb({type:Xn,selectors:[["vdr-order-process-node"]],inputs:{node:"node",index:"index",active:"active"},features:[s.Pb],decls:8,vars:15,consts:[[1,"node-wrapper",3,"ngStyle"],[1,"node"],["class","cancelled-wrapper",4,"ngIf"],[1,"cancelled-wrapper"],[1,"cancelled-edge"],["shape","dot-circle"],[1,"cancelled-node"]],template:function(e,t){1&e&&(s.ic(0,"div",0),s.sc(1,"async"),s.ic(2,"div",1),s.sc(3,"async"),s.Wc(4),s.sc(5,"translate"),s.sc(6,"stateI18nToken"),s.hc(),s.Uc(7,Vc,7,5,"div",2),s.hc()),2&e&&(s.Ub("active",s.tc(1,7,t.active$)),s.yc("ngStyle",t.getStyle()),s.Rb(2),s.Ub("active-target",s.tc(3,9,t.activeTarget$)),s.Rb(2),s.Yc(" ",s.tc(5,11,s.tc(6,13,t.node.name))," "),s.Rb(3),s.yc("ngIf",t.isCancellable))},directives:[$.p,$.o,X.o],pipes:[$.b,Y.d,b.Qb],styles:["[_nghost-%COMP%]{display:block}.node-wrapper[_ngcontent-%COMP%]{align-items:center;display:flex;position:absolute;z-index:1}.node[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);border:2px solid var(--color-component-border-200);border-radius:3px;cursor:default;display:inline-block;opacity:.7;padding:3px 6px;transition:opacity .2s,background-color .2s,color .2s;z-index:1}.node.active-target[_ngcontent-%COMP%]{border-color:var(--color-primary-500);opacity:.9}.cancelled-wrapper[_ngcontent-%COMP%]{align-items:center;color:var(--color-grey-300);display:flex;opacity:.7;transition:color .2s,opacity .2s}.cancelled-edge[_ngcontent-%COMP%]{background-color:var(--color-component-bg-300);height:2px;transition:background-color .2s;width:48px}clr-icon[_ngcontent-%COMP%]{margin-left:-1px}.cancelled-node[_ngcontent-%COMP%]{margin-left:6px}.active[_ngcontent-%COMP%]   .cancelled-wrapper[_ngcontent-%COMP%]{opacity:1}.active[_ngcontent-%COMP%]   .node[_ngcontent-%COMP%]{background-color:var(--color-primary-600);border-color:var(--color-primary-600);color:var(--color-primary-100);opacity:1}.active[_ngcontent-%COMP%]   .cancelled-wrapper[_ngcontent-%COMP%]{color:var(--color-error-500)}.active[_ngcontent-%COMP%]   .cancelled-edge[_ngcontent-%COMP%]{background-color:var(--color-error-500)}"],changeDetection:0}),Xn.ctorParameters=function(){return[{type:s.s}]},Xn.propDecorators={node:[{type:s.D}],index:[{type:s.D}],active:[{type:s.D}]};var qn=function(){function e(){p(this,e)}return h(e,[{key:"ngOnInit",value:function(){var e=this;this.active$=this.from.active$.asObservable().pipe(Object(N.a)((function(t){return e.to.activeTarget$.next(t)})))}},{key:"getStyle",value:function(){var e=this.from.index<this.to.index?"down":"up",t=this.from.getPos("down"===e?"bottom":"top"),c=this.to.getPos("down"===e?"top":"bottom"),n=Math.abs(t.x-c.x),r=Math.abs(t.y-c.y),i=Math.sqrt(Math.pow(n,2)+Math.pow(r,2));return Object.assign({"top.px":t.y,"left.px":t.x+("down"===e?10:40)+12*this.index,"height.px":i,"width.px":1},"up"===e?{transform:"rotateZ(180deg)","transform-origin":"top"}:{})}}]),e}();qn.\u0275fac=function(e){return new(e||qn)},qn.\u0275cmp=s.Wb({type:qn,selectors:[["vdr-order-process-edge"]],inputs:{from:"from",to:"to",index:"index"},decls:3,vars:7,consts:[[1,"edge",3,"ngStyle"],["shape","arrow","flip","vertical",1,"arrow"]],template:function(e,t){1&e&&(s.ic(0,"div",0),s.sc(1,"async"),s.dc(2,"clr-icon",1),s.hc()),2&e&&(s.Ub("active",s.tc(1,5,t.active$)),s.yc("ngStyle",t.getStyle()),s.Sb("data-from",t.from.node.name)("data-to",t.to.node.name))},directives:[$.p,X.o],pipes:[$.b],styles:[".edge[_ngcontent-%COMP%]{background-color:var(--color-component-bg-300);border:1px solid var(--color-component-border-200);opacity:.3;position:absolute;transition:border .2s,opacity .2s,background-color .2s}.edge.active[_ngcontent-%COMP%]{background-color:var(--color-primary-500);border-color:var(--color-primary-500);opacity:1}.edge.active[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{color:var(--color-primary-500)}.edge[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{bottom:-4px;color:var(--color-grey-300);left:-8px;position:absolute}"],changeDetection:0}),qn.propDecorators={from:[{type:s.D}],to:[{type:s.D}],index:[{type:s.D}]};var Vn=function(){function n(e){p(this,n),this.changeDetector=e,this.setActiveState$=new S.a(void 0),this.nodes=[],this.edges=[]}return h(n,[{key:"ngOnInit",value:function(){this.setActiveState$.next(this.initialState),this.activeState$=this.setActiveState$.pipe(Object(A.a)(150))}},{key:"ngOnChanges",value:function(e){this.populateNodes()}},{key:"ngAfterViewInit",value:function(){var e=this;setTimeout((function(){return e.populateEdges()}))}},{key:"onMouseOver",value:function(e){this.setActiveState$.next(e)}},{key:"onMouseOut",value:function(){this.setActiveState$.next(this.initialState)}},{key:"getNodeFor",value:function(e){if(this.nodeComponents)return this.nodeComponents.find((function(t){return t.node.name===e}))}},{key:"populateNodes",value:function(){var n,r,i,o=this,a=new Map,l=t(this.states);try{for(l.s();!(i=l.n()).done;){var d=i.value;a.set(d.name,{name:d.name,to:[]})}}catch(p){l.e(p)}finally{l.f()}var s,u=t(a.entries());try{var f=function(){var e,i=c(s.value,2),l=i[0],d=i[1],u=t(null!==(r=null===(n=o.states.find((function(e){return e.name===l})))||void 0===n?void 0:n.to)&&void 0!==r?r:[]);try{for(u.s();!(e=u.n()).done;){var f=e.value,m=a.get(f);m&&d.to.push(m)}}catch(p){u.e(p)}finally{u.f()}};for(u.s();!(s=u.n()).done;)f()}catch(p){u.e(p)}finally{u.f()}this.nodes=e(a.values()).filter((function(e){return"Cancelled"!==e.name}))}},{key:"populateEdges",value:function(){var c,n=t(this.nodes);try{for(n.s();!(c=n.n()).done;){var r,i=c.value,o=this.getNodeFor(i.name),a=0,l=t(i.to);try{for(l.s();!(r=l.n()).done;){var d=r.value,s=this.getNodeFor(d.name);o&&s&&o!==s&&(this.edges.push({to:s,from:o,index:a}),a++)}}catch(u){l.e(u)}finally{l.f()}}}catch(u){n.e(u)}finally{n.f()}this.edges=e(this.edges),this.changeDetector.markForCheck()}},{key:"outerHeight",get:function(){return this.nodes.length*$n}}]),n}();Vn.\u0275fac=function(e){return new(e||Vn)(s.cc(s.k))},Vn.\u0275cmp=s.Wb({type:Vn,selectors:[["vdr-order-process-graph"]],viewQuery:function(e,t){var c;1&e&&s.bd(Xn,!0),2&e&&s.Hc(c=s.qc())&&(t.nodeComponents=c)},hostVars:2,hostBindings:function(e,t){2&e&&s.Rc("height",t.outerHeight,"px")},inputs:{states:"states",initialState:"initialState"},features:[s.Pb],decls:2,vars:2,consts:[[4,"ngFor","ngForOf"],[3,"node","index","active","mouseenter","mouseleave"],[3,"from","to","index"]],template:function(e,t){1&e&&(s.Uc(0,Qc,3,5,"ng-container",0),s.Uc(1,Hc,2,3,"ng-container",0)),2&e&&(s.yc("ngForOf",t.nodes),s.Rb(1),s.yc("ngForOf",t.edges))},directives:[$.n,Xn,qn],pipes:[$.b],styles:["[_nghost-%COMP%]{border:1px #ff69b4;display:block;margin:20px;padding:12px;position:relative}.state-row[_ngcontent-%COMP%]{display:flex}"],changeDetection:0}),Vn.ctorParameters=function(){return[{type:s.k}]},Vn.propDecorators={states:[{type:s.D}],initialState:[{type:s.D}],nodeComponents:[{type:s.fb,args:[Xn]}],outerHeight:[{type:s.w,args:["style.height.px"]}]};var Qn=function(){function e(){p(this,e),this.orderLineCustomFieldsVisible=!1}return h(e,[{key:"ngOnInit",value:function(){this.orderLineCustomFieldsVisible=this.orderLineCustomFields.length<2}},{key:"toggleOrderLineCustomFields",value:function(){this.orderLineCustomFieldsVisible=!this.orderLineCustomFieldsVisible}},{key:"getLineDiscounts",value:function(e){return e.discounts.filter((function(e){return e.type===b.h.PROMOTION}))}},{key:"getPromotionLink",value:function(e){return["/marketing","promotions",e.adjustmentSource.split(":")[1]]}},{key:"getCouponCodeForAdjustment",value:function(e,t){var c=t.adjustmentSource.split(":")[1],n=e.promotions.find((function(e){return e.id===c}));if(n)return n.couponCode||void 0}},{key:"visibleOrderLineCustomFields",get:function(){return this.orderLineCustomFieldsVisible?this.orderLineCustomFields:[]}},{key:"showElided",get:function(){return!this.orderLineCustomFieldsVisible&&0<this.orderLineCustomFields.length}}]),e}();Qn.\u0275fac=function(e){return new(e||Qn)},Qn.\u0275cmp=s.Wb({type:Qn,selectors:[["vdr-order-table"]],inputs:{order:"order",orderLineCustomFields:"orderLineCustomFields"},decls:68,vars:69,consts:[[1,"order-table","table"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","order-line",3,"is-cancelled",4,"ngFor","ngForOf"],["class","surcharge",4,"ngFor","ngForOf"],["class","order-adjustment",4,"ngFor","ngForOf"],[1,"sub-total"],[1,"left","clr-align-middle"],[1,"clr-align-middle"],[1,"net-price",3,"title"],[1,"shipping"],[1,"total"],[1,"order-line-custom-field"],[1,"custom-field-header-button",3,"title","click"],["shape","ellipsis-horizontal",1,"custom-field-ellipsis"],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","unit-price"],[1,"align-middle","quantity"],[3,"line"],[3,"line","orderState"],[1,"align-middle","total"],[3,"src"],[1,"order-line-custom-field","align-middle"],[3,"ngSwitch"],[3,"ngSwitchCase"],["ngSwitchDefault",""],[3,"title"],[3,"ngIf"],["shape","check"],["shape","times"],["vdrDropdownTrigger","",1,"promotions-label"],["class","line-promotion",4,"ngFor","ngForOf"],[1,"line-promotion"],[1,"promotion-name",3,"routerLink"],[1,"promotion-amount"],[1,"surcharge"],["colspan","2",1,"align-middle","name","left"],[1,"align-middle"],[1,"order-adjustment"],[3,"routerLink"]],template:function(e,t){1&e&&(s.ic(0,"table",0),s.ic(1,"thead"),s.ic(2,"tr"),s.dc(3,"th"),s.ic(4,"th"),s.Wc(5),s.sc(6,"translate"),s.hc(),s.ic(7,"th"),s.Wc(8),s.sc(9,"translate"),s.hc(),s.ic(10,"th"),s.Wc(11),s.sc(12,"translate"),s.hc(),s.ic(13,"th"),s.Wc(14),s.sc(15,"translate"),s.hc(),s.Uc(16,Bc,6,6,"ng-container",1),s.Uc(17,Gc,5,3,"ng-container",2),s.ic(18,"th"),s.Wc(19),s.sc(20,"translate"),s.hc(),s.hc(),s.hc(),s.ic(21,"tbody"),s.Uc(22,ln,28,34,"tr",3),s.Uc(23,sn,15,15,"tr",4),s.Uc(24,pn,9,9,"tr",5),s.ic(25,"tr",6),s.ic(26,"td",7),s.Wc(27),s.sc(28,"translate"),s.hc(),s.dc(29,"td"),s.dc(30,"td"),s.Uc(31,mn,2,0,"ng-container",2),s.ic(32,"td",8),s.Wc(33),s.sc(34,"localeCurrency"),s.ic(35,"div",9),s.sc(36,"translate"),s.Wc(37),s.sc(38,"localeCurrency"),s.hc(),s.hc(),s.hc(),s.ic(39,"tr",10),s.ic(40,"td",7),s.Wc(41),s.sc(42,"translate"),s.hc(),s.ic(43,"td",8),s.Wc(44),s.hc(),s.dc(45,"td"),s.Uc(46,hn,2,0,"ng-container",2),s.ic(47,"td",8),s.Wc(48),s.sc(49,"localeCurrency"),s.ic(50,"div",9),s.sc(51,"translate"),s.Wc(52),s.sc(53,"localeCurrency"),s.hc(),s.hc(),s.hc(),s.ic(54,"tr",11),s.ic(55,"td",7),s.Wc(56),s.sc(57,"translate"),s.hc(),s.dc(58,"td"),s.dc(59,"td"),s.Uc(60,bn,2,0,"ng-container",2),s.ic(61,"td",8),s.Wc(62),s.sc(63,"localeCurrency"),s.ic(64,"div",9),s.sc(65,"translate"),s.Wc(66),s.sc(67,"localeCurrency"),s.hc(),s.hc(),s.hc(),s.hc(),s.hc()),2&e&&(s.Rb(5),s.Xc(s.tc(6,29,"order.product-name")),s.Rb(3),s.Xc(s.tc(9,31,"order.product-sku")),s.Rb(3),s.Xc(s.tc(12,33,"order.unit-price")),s.Rb(3),s.Xc(s.tc(15,35,"order.quantity")),s.Rb(2),s.yc("ngForOf",t.visibleOrderLineCustomFields),s.Rb(1),s.yc("ngIf",t.showElided),s.Rb(2),s.Xc(s.tc(20,37,"order.total")),s.Rb(3),s.yc("ngForOf",t.order.lines),s.Rb(1),s.yc("ngForOf",t.order.surcharges),s.Rb(1),s.yc("ngForOf",t.order.discounts),s.Rb(3),s.Xc(s.tc(28,39,"order.sub-total")),s.Rb(3),s.Sb("colspan",3+t.visibleOrderLineCustomFields.length),s.Rb(1),s.yc("ngIf",t.showElided),s.Rb(2),s.Yc(" ",s.uc(34,41,t.order.subTotalWithTax,t.order.currencyCode)," "),s.Rb(2),s.yc("title",s.tc(36,44,"order.net-price")),s.Rb(2),s.Yc(" ",s.uc(38,46,t.order.subTotal,t.order.currencyCode)," "),s.Rb(4),s.Xc(s.tc(42,49,"order.shipping")),s.Rb(3),s.Xc(null==t.order.shippingLines[0]||null==t.order.shippingLines[0].shippingMethod?null:t.order.shippingLines[0].shippingMethod.name),s.Rb(1),s.Sb("colspan",3+t.visibleOrderLineCustomFields.length),s.Rb(1),s.yc("ngIf",t.showElided),s.Rb(2),s.Yc(" ",s.uc(49,51,t.order.shippingWithTax,t.order.currencyCode)," "),s.Rb(2),s.yc("title",s.tc(51,54,"order.net-price")),s.Rb(2),s.Yc(" ",s.uc(53,56,t.order.shipping,t.order.currencyCode)," "),s.Rb(4),s.Xc(s.tc(57,59,"order.total")),s.Rb(3),s.Sb("colspan",3+t.visibleOrderLineCustomFields.length),s.Rb(1),s.yc("ngIf",t.showElided),s.Rb(2),s.Yc(" ",s.uc(63,61,t.order.totalWithTax,t.order.currencyCode)," "),s.Rb(2),s.yc("title",s.tc(65,64,"order.net-price")),s.Rb(2),s.Yc(" ",s.uc(67,66,t.order.total,t.order.currencyCode)," "))},directives:[$.n,$.o,X.o,Mn,kn,$.q,$.r,$.s,b.T,b.W,b.V,y.h,b.C],pipes:[Y.d,b.Ab,b.I,b.r,b.Bb],styles:[".order-table[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200);text-decoration:line-through}.order-table[_ngcontent-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%], .order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px}.order-table[_ngcontent-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);cursor:pointer;font-size:11px;margin-top:6px;text-decoration:underline dotted var(--color-text-200);text-transform:lowercase}.order-table[_ngcontent-%COMP%]   .line-promotion[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:6px 12px}.order-table[_ngcontent-%COMP%]   .line-promotion[_ngcontent-%COMP%]   .promotion-amount[_ngcontent-%COMP%]{margin-left:12px}.custom-field-header-button[_ngcontent-%COMP%]{background:none;border:none;color:var(--color-primary-600);cursor:pointer;margin:0;padding:0}"],changeDetection:0}),Qn.propDecorators={order:[{type:s.D}],orderLineCustomFields:[{type:s.D}]};var Hn=function e(){p(this,e)};Hn.\u0275fac=function(e){return new(e||Hn)},Hn.\u0275cmp=s.Wb({type:Hn,selectors:[["vdr-payment-detail"]],inputs:{payment:"payment",currencyCode:"currencyCode"},decls:13,vars:19,consts:[[3,"label"],[3,"value"]],template:function(e,t){1&e&&(s.ic(0,"vdr-labeled-data",0),s.sc(1,"translate"),s.Wc(2),s.hc(),s.ic(3,"vdr-labeled-data",0),s.sc(4,"translate"),s.Wc(5),s.sc(6,"localeCurrency"),s.hc(),s.ic(7,"vdr-labeled-data",0),s.sc(8,"translate"),s.Wc(9),s.hc(),s.ic(10,"vdr-labeled-data",0),s.sc(11,"translate"),s.dc(12,"vdr-object-tree",1),s.hc()),2&e&&(s.yc("label",s.tc(1,8,"order.payment-method")),s.Rb(2),s.Yc(" ",t.payment.method,"\n"),s.Rb(1),s.yc("label",s.tc(4,10,"order.amount")),s.Rb(2),s.Yc(" ",s.uc(6,12,t.payment.amount,t.currencyCode),"\n"),s.Rb(2),s.yc("label",s.tc(8,15,"order.transaction-id")),s.Rb(2),s.Yc(" ",t.payment.transactionId,"\n"),s.Rb(1),s.yc("label",s.tc(11,17,"order.payment-metadata")),s.Rb(2),s.yc("value",t.payment.metadata))},directives:[b.vb,b.Fb],pipes:[Y.d,b.Ab],styles:[""],changeDetection:0}),Hn.propDecorators={payment:[{type:s.D}],currencyCode:[{type:s.D}]};var Bn=function(){function e(){p(this,e)}return h(e,[{key:"chipColorType",get:function(){switch(this.state){case"Authorized":return"warning";case"Settled":return"success";case"Declined":return"error"}}}]),e}();Bn.\u0275fac=function(e){return new(e||Bn)},Bn.\u0275cmp=s.Wb({type:Bn,selectors:[["vdr-payment-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(e,t){1&e&&(s.ic(0,"vdr-chip",0),s.sc(1,"translate"),s.Uc(2,gn,1,0,"clr-icon",1),s.Wc(3),s.sc(4,"translate"),s.sc(5,"stateI18nToken"),s.hc()),2&e&&(s.yc("title",s.tc(1,4,"order.payment-state"))("colorType",t.chipColorType),s.Rb(2),s.yc("ngIf","Settled"===t.state),s.Rb(1),s.Yc(" ",s.tc(4,6,s.tc(5,8,t.state)),"\n"))},directives:[b.C,$.o,X.o],pipes:[Y.d,b.Qb],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0}),Bn.propDecorators={state:[{type:s.D}]};var Gn=function(){function e(){p(this,e)}return h(e,[{key:"chipColorType",get:function(){switch(this.state){case"Pending":return"warning";case"Settled":return"success";case"Failed":return"error"}}}]),e}();Gn.\u0275fac=function(e){return new(e||Gn)},Gn.\u0275cmp=s.Wb({type:Gn,selectors:[["vdr-refund-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(e,t){1&e&&(s.ic(0,"vdr-chip",0),s.sc(1,"translate"),s.Uc(2,yn,1,0,"clr-icon",1),s.Wc(3),s.sc(4,"translate"),s.sc(5,"stateI18nToken"),s.hc()),2&e&&(s.yc("title",s.tc(1,4,"order.payment-state"))("colorType",t.chipColorType),s.Rb(2),s.yc("ngIf","Settled"===t.state),s.Rb(1),s.Yc(" ",s.tc(4,6,s.tc(5,8,t.state)),"\n"))},directives:[b.C,$.o,X.o],pipes:[Y.d,b.Qb],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0}),Gn.propDecorators={state:[{type:s.D}]};var zn=function e(){p(this,e)};zn.\u0275fac=function(e){return new(e||zn)},zn.\u0275cmp=s.Wb({type:zn,selectors:[["vdr-simple-item-list"]],inputs:{items:"items"},decls:3,vars:1,consts:[[1,"items-list"],[3,"title",4,"ngFor","ngForOf"],[3,"title"],[1,"quantity"],["shape","times","size","12"]],template:function(e,t){1&e&&(s.ic(0,"div",0),s.ic(1,"ul"),s.Uc(2,vn,5,3,"li",1),s.hc(),s.hc()),2&e&&(s.Rb(2),s.yc("ngForOf",t.items))},directives:[$.n,X.o],styles:[".items-list[_ngcontent-%COMP%]{font-size:12px}.items-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style-type:none;margin-left:2px;margin-top:6px}.items-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{line-height:14px;overflow:hidden;text-overflow:ellipsis}.items-list[_ngcontent-%COMP%]   .quantity[_ngcontent-%COMP%]{display:inline-block;min-width:16px}"],changeDetection:0}),zn.propDecorators={items:[{type:s.D}]};var Zn=function(e){a(c,e);var t=d(c);function c(e,n){return p(this,c),t.call(this,e,{__typename:"Order",id:"",code:"",createdAt:"",updatedAt:"",total:0},(function(e){return n.order.getOrder(e).mapStream((function(e){return e.order}))}))}return c}(b.w);Zn.\u0275fac=function(e){return new(e||Zn)(s.mc(y.e),s.mc(b.L))},Zn.\u0275prov=Object(s.Yb)({factory:function(){return new Zn(Object(s.mc)(y.e),Object(s.mc)(b.L))},token:Zn,providedIn:"root"}),Zn.ctorParameters=function(){return[{type:y.e},{type:b.L}]};var Jn={breadcrumb:Object(g.a)("breadcrumb.orders")},Kn={breadcrumb:cr},er={breadcrumb:nr},tr=[{path:"",component:En,data:Jn},{path:":id",component:jn,resolve:Object(b.Yb)(Zn),canDeactivate:[b.y],data:Kn},{path:":id/modify",component:An,resolve:Object(b.Yb)(Zn),data:er}];function cr(e,t){return Object(b.ac)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.orders",getName:function(e){return e.code},route:""})}function nr(e,t){return cr(e,t).pipe(Object(_.a)((function(e){var t=e.slice();return t[0].link[0]="../",t[1].link[0]="../orders",t.concat({label:Object(g.a)("breadcrumb.modifying"),link:[""]})})))}var rr=function e(){p(this,e)};rr.\u0275mod=s.ac({type:rr}),rr.\u0275inj=s.Zb({factory:function(e){return new(e||rr)},imports:[[b.Nb,y.i.forChild(tr)]]})}}])}();
//# sourceMappingURL=12-es5.4e6c56b7abb81a36f583.js.map